(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{"4e/K":function(e,t,s){"use strict";s.r(t),s.d(t,"TypeaheadInput",(function(){return x})),s.d(t,"styles",(function(){return j}));var o=s("KEM+"),r=s.n(o),i=s("3EFP"),a=s("ERkP"),n=s.n(a),d=s("ZUOq"),c=s("+Kfv"),h=s("woHV"),l=s("3XMw"),u=s.n(l),p=s("VwDm"),m=s("WPfJ"),f=s("N5qz"),y=s("Es6L"),_=s("OEYw"),w=s("GZwR"),I=s("MWbm"),b=s("v6aA"),D=s("rHpw"),g=s("xoZN"),C=s("6OUF"),R=s("pf9B"),E=s("cHvH"),v=s("oEoC");const T=u.a.f065ba8c,S=e=>f.a.isTwoColumnNormalLayout(e)?{width:d.a.columnWidths.secondary.normal+D.a.theme.spacesPx.space24,left:-D.a.theme.spacesPx.space24/2}:f.a.isTwoColumnSmallLayout(e)?{width:d.a.columnWidths.secondary.small+D.a.theme.spacesPx.space16,left:-D.a.theme.spacesPx.space16/2}:void 0;let O=1;class x extends n.a.Component{constructor(e,t){super(e,t),r()(this,"_shouldUseHeightOnDropdown",this.context.featureSwitches.isTrue("responsive_web_app_bar_scroll_enabled")),r()(this,"_withNewTypeaheadUI",!1),r()(this,"_render",(({windowWidth:e})=>{const{alwaysOpen:t,disableClearButton:s,forceVdlDisable:o,inputStyle:r,isCompact:i,isOnHomepage:a,placeholder:d,renderInSearchField:l,rounded:u,shouldAutoFocus:m,shouldFocusOnClear:f,style:y,testID:_}=this.props,w=this.state.showTypeaheadDropdown||t;return n.a.createElement(c.a,{viewType:"typeahead_input"},n.a.createElement(I.a,{onLayout:this._handleLayout,ref:this._setRootContainerNode,style:[j.root,y]},n.a.createElement(g.a,{onKeyDown:this._handleKeyDown,style:j.keydownInputListener},n.a.createElement(h.a,{accessibilityLabel:d,accessibilityRole:"search",onSubmit:this._handleFormSubmit,style:j.wrapper},n.a.createElement(I.a,{ref:this._setInputContainerNode,style:r},n.a.createElement(C.a,{Icon:p.a,ariaActiveDescendant:this.state.ariaDescendantId,ariaAutocomplete:"list",ariaExpanded:w,ariaLabel:T,ariaOwns:this._dropdownDomId,ariaRole:"combobox",autoComplete:"off",autoCorrect:!1,autoFocus:m,contentBelow:l&&l(),focusOnClear:f,isCompact:i,leftAligned:a,onChange:this._handleInputChange,onClear:this._handleInputClear,onFocus:this._handleInputFocus,onLayout:this._handleInputLayoutChanged,placeholder:d,ref:this._setInputRef,returnKeyType:"search",spellCheck:"false",styleType:o?"legacyPill":u?"pill":"selection",testID:_,value:this.state.query,withClearButton:!s&&this.state.showTypeaheadDropdown})),n.a.createElement(I.a,{style:[j.typeaheadContainer,!u&&j.topBorder]},w?this._renderDropdown(e):null)))))})),r()(this,"_renderDropdown",(e=>{const{communityId:t,filter:s,getItemDisabledMessage:o,getItemIsDisabled:r,getTopicExactMatch:i,getUserExactMatch:a,injectedItems:d,isInSidebar:c,isModal:h,isOnHomepage:l,maxEvents:u,maxTopics:p,onItemsChanged:m,orderResults:f,renderCallout:w,renderEmptyState:I,renderHeader:b,renderNoResultsState:g,renderUserDecoration:C,selectedItems:R,shouldDeferPrefetch:E,source:T,withFixedPositioning:O,withSectionDivider:x}=this.props,N=e>=D.a.theme.breakpoints.medium||Object(y.a)(),{dropdownOffset:F,query:U}=this.state,P=h?j.modalDropdown:[j.dropdown,!N&&O&&F?[Object(v.d)(F),this._shouldUseHeightOnDropdown&&{height:`calc(100vh - ${F}px)`}]:null,(N||l)&&j.wideModeDropdown,this._withNewTypeaheadUI&&c&&S(e),l&&j.shortModeDropdown,!N&&l&&j.shortModeDropdownMobile],q={ariaDescendantId:this.state.ariaDescendantId,domId:this._dropdownDomId,onDismiss:this._handleOnEmptyStateDismiss,onItemFocusChanged:this._handleItemFocusChanged,ref:this._handleDropdownRef,style:P};return I&&!U?I(q):n.a.createElement(_.a,{ariaDescendantId:this.state.ariaDescendantId,communityId:t,domId:this._dropdownDomId,filter:s,getItemDisabledMessage:o,getItemIsDisabled:r,getTopicExactMatch:i,getUserExactMatch:a,injectedItems:d,maxEvents:u,maxTopics:p,onItemClick:this._handleItemClick,onItemFocusChanged:this._handleItemFocusChanged,onItemsChanged:m,orderResults:f,query:U,ref:this._handleDropdownRef,renderCallout:w,renderHeader:b,renderNoResultsState:g,renderUserDecoration:C,selectedItems:R,shouldDeferPrefetch:E,source:T,style:P,withSectionDivider:x})})),r()(this,"_dismissDropdown",(()=>{this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss()})),r()(this,"_handleOnEmptyStateDismiss",(()=>{this._dismissDropdown(),this._inputRef&&this._inputRef.blur()})),r()(this,"_handleLayout",(()=>{this._updatePosition()})),r()(this,"_handleInputLayoutChanged",(()=>{this._updatePosition()})),r()(this,"_updatePosition",(()=>{if(!this._inputContainerNode)return;const{bottom:e}=this._inputContainerNode.getBoundingClientRect();e!==this.state.dropdownOffset&&this.setState({dropdownOffset:e})})),r()(this,"_handleDropdownRef",(e=>{this._dropdownRef=e})),r()(this,"_setRootContainerNode",(e=>{this._rootContainerNode=e||null})),r()(this,"_setInputRef",(e=>{this._inputRef=e})),r()(this,"_setInputContainerNode",(e=>{this._inputContainerNode=e||null,this._inputContainerNode&&this._updatePosition()})),r()(this,"_handleFocusChange",(e=>{const t=R.a.getCount()>0;this._rootContainerNode&&this._rootContainerNode.contains(e.target)||t||this.state.showTypeaheadDropdown&&this._dismissDropdown()})),r()(this,"_handleKeyDown",(e=>{const{key:t}=e,{showTypeaheadDropdown:s}=this.state;if(Object(v.g)(e)){if(t===i.a)return this._focusNext(),void e.preventDefault();if(t===i.b)return this._focusPrevious(),void e.preventDefault();if(t===i.d)return this._dismissDropdown(),void e.preventDefault();if(t!==i.f)return t===i.c&&this._hasFocusedItem()?(this._selectFocusedItem(),void e.preventDefault()):void(s||this.setState({showTypeaheadDropdown:!0}));this._dismissDropdown()}})),r()(this,"_handleItemFocusChanged",(()=>{this.setState({ariaDescendantId:Object(v.b)()})})),r()(this,"_handleInputClear",(()=>{this.setQuery("")})),r()(this,"_handleInputFocus",(()=>{this.setState({showTypeaheadDropdown:!0}),this._updatePosition(),this.props.onFocus&&this.props.onFocus()})),r()(this,"_handleInputChange",(e=>{this.setQuery(e.target.value),this._updatePosition()})),r()(this,"_handleFormSubmit",(e=>{e.preventDefault(),e.stopPropagation(),this._inputRef&&this._inputRef.blur(),this.setState({showTypeaheadDropdown:!1}),this.props.onDismiss&&this.props.onDismiss(),this.props.onSubmit&&this.props.onSubmit()})),r()(this,"_handleItemClick",((e,t)=>{const{onDismiss:s,onItemClick:o,shouldClearOnSelect:r,shouldFocusOnClear:i}=this.props,a=r?"":this.state.query;this.setState({showTypeaheadDropdown:!1}),this._inputRef&&(r&&i?this._inputRef.focus():this._inputRef.blur()),this.setQuery(a),s&&s(),o&&o(e,t)})),r()(this,"_hasFocusedItem",(()=>this._dropdownRef&&this._dropdownRef.hasFocusedItem())),r()(this,"_selectFocusedItem",(()=>{this._dropdownRef&&this._dropdownRef.selectFocusedItem()})),r()(this,"_focusNext",(()=>{this._dropdownRef&&this._dropdownRef.focusNext()})),r()(this,"_focusPrevious",(()=>{this._dropdownRef&&this._dropdownRef.focusPrevious()})),this.state={ariaDescendantId:Object(v.b)(),query:e.initialValue,showTypeaheadDropdown:!1},this._dropdownDomId=`typeaheadDropdown-${O}`,O+=1,this._withNewTypeaheadUI=this.context.featureSwitches.isTrue("responsive_web_account_search_readability_enabled")}UNSAFE_componentWillReceiveProps(e){this.props.initialValue!==e.initialValue&&this.setQuery(e.initialValue)}componentDidMount(){window.document.addEventListener("click",this._handleFocusChange,!0)}componentWillUnmount(){window.document.removeEventListener("click",this._handleFocusChange,!0)}render(){return n.a.createElement(E.a,null,this._render)}focus(){this._inputRef&&this._inputRef.focus()}setQuery(e){this.setState({query:e}),this.props.onQueryChange&&this.props.onQueryChange(e)}}r()(x,"defaultProps",{disableClearButton:!1,filter:[w.a.Users,w.a.Topics],isInSidebar:!1,initialValue:"",withSectionDivider:!0}),r()(x,"contextType",b.a);const j=D.a.create((e=>({root:{flex:1,flexDirection:"column",position:"relative",zIndex:m.d+1},typeaheadContainer:{flex:1,position:"relative"},keydownInputListener:{flexShrink:1},dropdown:{backgroundColor:e.colors.cellBackground,left:0,right:0,overflowY:"auto",overscrollBehavior:"contain",position:"absolute",top:0,WebkitOverflowScrolling:"touch"},modalDropdown:{backgroundColor:e.colors.cellBackground,flex:1,minHeight:300,position:"relative",overflowY:"auto",overscrollBehavior:"auto",WebkitOverflowScrolling:"touch"},wideModeDropdown:{borderRadius:e.borderRadii.medium,boxShadow:e.boxShadows.medium,minHeight:100,maxHeight:`calc(80vh - ${e.componentDimensions.appBarHeight})`},shortModeDropdown:{minHeight:100,maxHeight:"35vh",paddingBottom:"0"},shortModeDropdownMobile:{position:"absolute",height:"40vh",top:0},wrapper:{alignItems:"stretch",flex:1},topBorder:{borderTopColor:e.colors.gray200,borderTopStyle:"solid",borderTopWidth:e.borderWidths.small}})));t.default=x},OEYw:function(e,t,s){"use strict";var o=s("97Jx"),r=s.n(o),i=s("KEM+"),a=s.n(i),n=s("ERkP"),d=s.n(n),c=s("hqKg"),h=s("oEoC"),l=s("o52z"),u=s("kGix"),p=s("M0jS"),m=s("Qyxo"),f=s("lnti"),y=s("rxPX"),_=s("0KEI"),w=(s("MvUL"),s("/kEJ")),I=s("oEOe"),b=s("vy4g"),D=s("3A2y"),g=s("Y6L+"),C=s("9EWH"),R=s("Ssj5"),E=s("GZwR");const v="typeaheadV2",T=[],S=Object.freeze({REQUEST:"rweb/typeaheadV2/FETCH_REQUEST",SUCCESS:"rweb/typeaheadV2/FETCH_SUCCESS",FAILURE:"rweb/typeaheadV2/FETCH_FAILURE"}),O=({q:e,result_type:t,src:s},o)=>{let r=t;return null!=o&&o.communityId&&(r=`${t}_${o.communityId}`),`${e}_${r}_${s}`},x={remoteResults:{},cachedIds:[]};const j=e=>e.map((({rounded_score:e,tokens:t,...s})=>{const{topic:o,topic_type:r}=s,i=r||E.b.Topic;return{id:`${i}_${o.replace(" ","_")}`,type:i,tokens:t,rounded_score:e,data:s}})),N=e=>e.map((({rounded_score:e,tokens:t,...s})=>{var o;const r=s.topic_type||E.b.Event,i=null==s||null===(o=s.url)||void 0===o?void 0:o.match(g.A.id);return{id:(null==i?void 0:i[0])||"",type:r,tokens:t,rounded_score:e,data:s}})),F=(e,t)=>e.typeaheadV2.remoteResults[t],U=(e,t)=>(s,o)=>{const r=F(o(),O(e,t)),i=r&&r.timestamp;return i&&Date.now()-i<=3e5?Promise.resolve():s(P(e,t))},P=(e,t)=>(s,o,{api:r})=>{if(!e||!e.q||""===e.q.trim())return Promise.resolve();const i={queryId:O(e,t)},{communityId:a}=t||{},n=e.result_type.split(","),d={actionTypes:S,context:"FETCH_TYPEAHEAD",meta:i};if(n.includes(E.a.CommunityUsers)&&a){const t=e=>{const{entities:t}=(null==e?void 0:e.invite_action_results)||{};return t?[Object(w.c)(t)]:void 0};return Object(I.b)(s,{params:{communityId:a,prefix:e.q},request:r.Typeahead.fetchCommunityInviteUsers})(d,t)}return Object(I.b)(s,{params:e,request:r.Typeahead.fetch})(d)};R.a.register({[v]:function(e=x,t){switch(t.type){case S.REQUEST:{const{meta:{queryId:s}}=t;return Object(C.a)(e,(e=>{e.remoteResults[s]||(e.remoteResults[s]={fetchStatus:u.a.NONE}),e.remoteResults[s].fetchStatus=u.a.LOADING}))}case S.SUCCESS:{const{meta:{queryId:s},payload:o}=t;if(!o)return e;const r=o.users.map((e=>Object(b.a)(e,E.c.Remote))),i={fetchStatus:u.a.LOADED,id:s,orderedSections:o.ordered_sections,events:N(o.events),topics:j(o.topics),users:Object(E.g)(r),timestamp:Date.now()};return Object(C.a)(e,(e=>{e.cachedIds=e.cachedIds.filter((e=>e!==s)),e.cachedIds.push(s),e.cachedIds.length>=25&&(e.remoteResults=Object(D.a)(e.remoteResults,e.cachedIds.splice(0,1))),e.remoteResults[s]=i}))}case S.FAILURE:{const{meta:{queryId:s}}=t;return Object(C.a)(e,(e=>{e.remoteResults[s].fetchStatus=u.a.FAILED}))}default:return e}}});var q=s("UQTn");const L=[E.a.Users],k=e=>{const{communityId:t,filter:s,query:o,source:r}=e;return O({q:o,result_type:(s||L).join(","),src:r},{communityId:t})},A=(e,t)=>((e,t)=>{const s=F(e,t);return s&&s.fetchStatus})(e,k(t)),H=(e,t)=>((e,t)=>{const s=F(e,t);return s&&s.users||T})(e,k(t)),M=(e,t)=>((e,t)=>{const s=F(e,t);return s&&s.topics||T})(e,k(t)),V=(e,t)=>((e,t)=>{const s=F(e,t);return s&&s.events||T})(e,k(t)),W=(e,t)=>(t.rounded_graph_weight||0)-(e.rounded_graph_weight||0),B=()=>Object(c.createSelector)(H,Object(c.createSelector)(((e,t)=>t.query),((e,t)=>t.filter),q.d,q.e,((e,t,s,o)=>{if(!e||!t||t.indexOf(E.a.Users)<0)return Object(l.a)();const r=Object(q.f)(s,e);return Object(E.g)(r.map((e=>o[e])).sort(W).slice(0,10))})),A,((e,t)=>t.injectedItems),((e,t)=>t.query),((e,t)=>t.getUserExactMatch),((e,t)=>t.userLimit),((e,t,s,o,r,i,a)=>{const n=Object(m.a)(o||[],(e=>e.type===E.b.User?e.data.id_str:void 0)),d=t.filter((e=>n.indexOf(e.id)<0)),c=e.filter((e=>n.indexOf(e.id)<0)),p=Object(h.a)(d,c).slice(0,a||10),f=s===u.a.LOADED,y=i&&i({query:r,hasResults:!!e.length,isLoaded:f}),_=y?[...p,y]:p;return _.length?_:Object(l.a)()})),Q=()=>Object(c.createSelector)(B(),Object(c.createSelector)(M,A,((e,t)=>t.query),((e,t)=>t.maxTopics),((e,t)=>t.getTopicExactMatch),((e,t,s,o,r)=>{const i=t===u.a.LOADED,a=r&&r({query:s,hasResults:!!e.length,isLoaded:i}),n=e.slice(0,o||3);return a&&n.push(a),n.length?n:Object(l.a)()})),Object(c.createSelector)(V,A,((e,t)=>t.query),((e,t)=>t.maxEvents),((e,t)=>t.filter),((e,t,s,o,r)=>{const i=s&&r&&r.indexOf(E.a.Events)>=0,a=e.slice(0,o||1);return a.length&&i?a:Object(l.a)()})),((e,t)=>t.injectedItems),((e,t)=>t.orderResults),((e,t,s,o,r)=>{const i=o&&o.length?o:null,a=r?r(i,e,t,s):Object(f.a)([i,s.length?s:void 0,t.length?t:void 0,e.length?e:void 0]);return t.length||e.length||s.length?a:i?[i]:Object(l.a)()}));var K=Object(y.a)().propsFromState((()=>({fetchStatus:A,items:Q()}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(_.createLocalApiErrorHandlerWithContextFactory)("TYPEAHEAD_DROPDOWN_CONTAINER_CONTEXT"),fetchTypeaheadIfNeeded:U,fetchUsersPresenceIfNeeded:p.b.fetchManyIfNeeded,prefetchTypeaheadUsersIfNeeded:q.b}))).withAnalytics({element:"typeahead"}),$=s("8UdT"),Y=s("kIAd"),z=s("Rp9C"),J=s("tAeL"),G=s("v6aA"),Z=s("VY6S"),X=s("w6IS");class ee extends d.a.Component{constructor(e,t){super(e,t),a()(this,"_fetchTypeaheadResultsIfNeeded",(e=>{e.query&&e.fetchTypeaheadIfNeeded({q:e.query,src:e.source,result_type:e.filter.join(","),context_text:e.contextText,topic_type:e.topicType},{communityId:e.communityId}).catch(e.createLocalApiErrorHandler({}))})),a()(this,"_handleItemClick",((e,t)=>{const{analytics:s,onItemClick:o,query:r}=this.props;o(e,t);const i=z.a.forTypeaheadResult(e,t),a=i?[i]:void 0;s.scribe({action:"click",data:{search_details:{query:r},targets:a}})})),a()(this,"_scribeResults",(()=>{const{analytics:e,items:t,query:s}=this.props;e.scribe({action:"impression",data:{items:z.a.forTypeaheadResults(t),search_details:{query:s}}})})),this._debouncedFetchTypeaheadResultsIfNeeded=Object(Z.a)(this._fetchTypeaheadResultsIfNeeded,250),this.state={shouldShowPrefetchResults:!0}}componentDidMount(){const{createLocalApiErrorHandler:e,prefetchTypeaheadUsersIfNeeded:t}=this.props;this._debouncedFetchTypeaheadResultsIfNeeded(this.props),t().catch(e({}))}componentWillUnmount(){clearTimeout(this._prefetchResultsTimer)}componentDidUpdate(e){const{createLocalApiErrorHandler:t,fetchUsersPresenceIfNeeded:s,filter:o,items:r,onItemsChanged:i,query:a,shouldDeferPrefetch:n,source:d}=this.props,{filter:c,query:h,source:l}=e,{loggedInUserId:p}=this.context,m=this.context.featureSwitches.isTrue("voice_rooms_typeahead_audiospace_ring_enabled")&&p;if(null!=r&&r.length&&r!==e.items&&(this._scribeResults(),i&&i(r),m)){const e=Object(X.a)(r).filter((e=>e.type===$.b.User)).map((e=>e.id));e&&s(e).catch(t({}))}a===h&&o===c&&d===l||(this._debouncedFetchTypeaheadResultsIfNeeded(this.props),n&&(clearTimeout(this._prefetchResultsTimer),this.setState({shouldShowPrefetchResults:!1}),this._prefetchResultsTimer=setTimeout((()=>{this.props.query&&this.props.fetchStatus!==u.a.LOADED&&this.setState({shouldShowPrefetchResults:!0})}),Y.a)))}render(){const{analytics:e,communityId:t,contextText:s,createLocalApiErrorHandler:o,dropdownRef:i,fetchStatus:a,fetchTypeaheadIfNeeded:n,fetchUsersPresenceIfNeeded:c,filter:h,getTopicExactMatch:l,getUserExactMatch:p,injectedItems:m,items:f,maxEvents:y,maxTopics:_,onItemClick:w,onItemsChanged:I,orderResults:b,prefetchTypeaheadUsersIfNeeded:D,query:g,shouldDeferPrefetch:C,topicType:R,userLimit:E,...v}=this.props,T=g&&a!==u.a.LOADED,S=T&&!this.state.shouldShowPrefetchResults?m:f;return d.a.createElement(J.a,r()({},v,{isLoading:!!T,items:S,onItemClick:this._handleItemClick,query:g,ref:i}))}}a()(ee,"contextType",G.a),a()(ee,"defaultProps",{filter:[E.a.Users],injectedItems:[],maxEvents:3,maxTopics:1});const te=d.a.forwardRef(((e,t)=>d.a.createElement(ee,r()({},e,{dropdownRef:t})))),se=K.forwardRef(te);t.a=se},o52z:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s("VPAj");const r=Object(o.a)([]);Object(o.a)({})}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.Typeahead~bundle.Communities.2e8f9a75.js.map