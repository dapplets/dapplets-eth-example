(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"+0pD":function(e,t){var i="[object Arguments]"==function(){return Object.prototype.toString.call(arguments)}();function a(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function s(e){return e&&"object"==typeof e&&"number"==typeof e.length&&Object.prototype.hasOwnProperty.call(e,"callee")&&!Object.prototype.propertyIsEnumerable.call(e,"callee")||!1}(t=e.exports=i?a:s).supported=a,t.unsupported=s},"06eB":function(e,t,i){var a=Array.prototype.slice,s=i("kgfz"),n=i("+0pD"),r=e.exports=function(e,t,i){return i||(i={}),e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():!e||!t||"object"!=typeof e&&"object"!=typeof t?i.strict?e===t:e==t:function(e,t,i){var l,d;if(o(e)||o(t))return!1;if(e.prototype!==t.prototype)return!1;if(n(e))return!!n(t)&&(e=a.call(e),t=a.call(t),r(e,t,i));if(c(e)){if(!c(t))return!1;if(e.length!==t.length)return!1;for(l=0;l<e.length;l++)if(e[l]!==t[l])return!1;return!0}try{var p=s(e),h=s(t)}catch(e){return!1}if(p.length!=h.length)return!1;for(p.sort(),h.sort(),l=p.length-1;l>=0;l--)if(p[l]!=h[l])return!1;for(l=p.length-1;l>=0;l--)if(d=p[l],!r(e[d],t[d],i))return!1;return typeof e==typeof t}(e,t,i))};function o(e){return null==e}function c(e){return!(!e||"object"!=typeof e||"number"!=typeof e.length)&&("function"==typeof e.copy&&"function"==typeof e.slice&&!(e.length>0&&"number"!=typeof e[0]))}},"180P":function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));const a=e=>{const t=(JSON.stringify(e)||"").split("");t.sort();const i=t.join("");return s(i,0).toString()},s=(e,t)=>{const i="string"==typeof e?e:String(e);let a=t;for(let e=0;e<i.length;e++){a=(a<<5)-a+i.charCodeAt(e),a&=a}return a}},"33Kz":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r}));const a=e=>e.getArrayValue("dm_reactions_config_active_reactions"),s=e=>{const t=e.getArrayValue("dm_reactions_config_inactive_reactions");return[...a(e),...t]},n=(e,t)=>{const i=s(t).find((t=>t.endsWith(e)));if(i)return i.split(":")[0]},r=(e,t={includeInactive:!1})=>t.includeInactive?s(e).map((e=>e.split(":")[1])):a(e).map((e=>e.split(":")[1]))},"3AAD":function(e,t,i){"use strict";const a={...i("7n04").a,pinToNewestWhenAtNewest:!0};t.a=a},"64vW":function(e,t,i){"use strict";var a=i("ERkP");const s=i.n(a).a.createContext({heightsReady:!0});t.a=s},"883S":function(e,t,i){"use strict";i.d(t,"a",(function(){return y})),i.d(t,"c",(function(){return E})),i.d(t,"b",(function(){return S}));var a=i("k49u"),s=i("3XMw"),n=i.n(s),r=i("fs1G");const o=n.a.c3752568,c=n.a.f78aa3e9,l=n.a.f9690dc0,d=n.a.i859a9d3,p=n.a.b1d35407,h=n.a.g539cca6,u=n.a.bbac0019,m=n.a.a1d2a68d,g=n.a.d4f2d9d8,b=n.a.hf383be4,_=n.a.b25c5b2a,v=n.a.c4fdbd16,f=n.a.hf3e7e38,y={[a.a.DirectMessageConversationNotFound]:{customAction:()=>!1}},E={defaultToast:{text:c},showToast:!0},S={defaultToast:{text:o},[a.a.CurrentUserSuspended]:{toast:{text:h,action:{label:d,link:"https://support.twitter.com/articles/15790"}}},[a.a.DirectMessageCannotDmOtherUser]:{toast:{text:l}},[a.a.DirectMessageDuplicate]:{toast:{text:_}},[a.a.DirectMessageOtherUserNotFollowing]:{toast:{text:m,action:{label:d,link:"https://support.twitter.com/articles/14606"}}},[a.a.DirectMessagesSenderBlocksRecipient]:{toast:{text:v}},[a.a.DirectMessageTooLongError]:{toast:{text:u}},[a.a.DirectMessageTweetNotFound]:{toast:{text:g}},[a.a.GenericBadRequest]:{customAction:r.a},[a.a.MessageSendError]:{toast:{text:f}},[a.a.OverStatusUpdateLimit]:{toast:{action:{label:d,link:"https://support.twitter.com/articles/15364"},text:p}},[a.a.TargetUserNotFound]:{toast:{text:b}},showToast:!0}},"89tF":function(e,t,i){"use strict";function a(e){const t={};return Object.keys(e).forEach((e=>{t[e]=e})),Object.freeze(t)}i.d(t,"a",(function(){return a}))},"8W85":function(e,t,i){"use strict";i("ERkP");var a=i("zb92");t.a=Object(a.a)({loader:()=>Promise.all([i.e(24),i.e(166)]).then(i.bind(null,"u2Vg")).then((e=>({default:e.__DANGEROUS_IMPORT__})))})},AQOc:function(e,t,i){"use strict";i.d(t,"b",(function(){return c})),i.d(t,"a",(function(){return l}));var a=i("lnti"),s=i("aWyx");const n={entries:{},entryIdsByConversationId:{},reactionsByMessageId:{}},r=(e=[],t={})=>e.reduce(((e,i)=>{const a=i.user_id,s=t[a]||{id_str:a};return e[a]={...i,user:s},e}),{});function o(e,t){const{entries:i,entryIdsByConversationId:a}=t;return(a[e]||[]).map((e=>i[e]&&i[e].data)).filter(Boolean)}const c=(e,t=n,i)=>{const{conversation_id:a,participants:s,...o}=e;return{conversation_id:a,...o,entries:t.entryIdsByConversationId[a]||[],participants:r(s,i)}},l=(e,t,i)=>{const{conversation_id:n,participants:c,social_proof:l,...d}=e,p={conversation_id:n,...d,entries:o(n,t),participants:r(c,i),social_proof:void 0};return l&&(p.social_proof=((e=[],t={})=>e.map((e=>{if(e.proof_type===s.d.MUTUAL_FRIENDS){const{users:i,...s}=e;return{...s,users:Object(a.a)(i.map((e=>t[e])))}}return e})))(l,i)),p}},GSsg:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var a=i("B5iK");class s{constructor(e,t=Object.freeze({})){const{interval:i=6e4,burstInterval:s=3e3,burstDuration:n=3e5}=t;this.pollTimer=new a.b(i).interval(e),this.burstTimer=new a.a(this.pollTimer,s,n)}start(e){return this.pollTimer.start(),e&&this.burstTimer.requestBurst(),this}stop(){return this.burstTimer.stopBurst(),this.pollTimer.stop(),this}restart(){return this.stop(),this.start(),this}}},H4nC:function(e,t,i){"use strict";var a=i("ERkP"),s=i.n(a),n=i("3XMw"),r=i.n(n),o=i("MWbm"),c=i("rHpw"),l=i("t62R");const d=c.a.create((e=>({root:{paddingBottom:e.spaces.space20}}))),p=r.a.d84b485d,h=r.a.be0c83d7;t.a=({entry:e,isCompact:t})=>{const i="follow"===e.reason?p:h;return t?s.a.createElement(l.b,{color:"gray700"},i):s.a.createElement(o.a,{style:d.root},s.a.createElement(l.b,{align:"center",color:"gray700",size:"subtext2"},i))}},"I2k/":function(e,t,i){"use strict";i.d(t,"a",(function(){return r}));var a=i("k49u"),s=i("lRnM"),n=i("LVU8");const r=e=>({[a.a.ClientNotPermitted]:{customAction:()=>(Object(n.d)("/messages/",{statusCode:401}),Object(s.t)(e))}})},J2UM:function(e,t,i){"use strict";var a=i("0JOx");t.a=()=>Object(a.h)().then((({inputDetect:e})=>e))},JD1h:function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return o}));var a=Object.freeze({MOVEMENT:"movement",LIST_UPDATE:"list_update",INITIAL_POSITION:"initial_position"});const s={nearTop:e=>(t,i)=>i.getTop()-t.getTop()<=e,nearBottom:e=>(t,i)=>t.getBottom()-i.getBottom()<=e,nearTopRatio:e=>(t,i)=>{const a=i.getHeight()*e;return i.getTop()-t.getTop()<=a},nearBottomRatio:e=>(t,i)=>{const a=i.getHeight()*e;return t.getBottom()-i.getBottom()<=a}},n=Object.freeze({INSIDE:"inside",OUTSIDE:"outside"}),r=(e,t,i,s)=>((e,t)=>!e&&t===n.INSIDE)(e,i)?a.INITIAL_POSITION:((e,t)=>e===n.OUTSIDE&&t===n.INSIDE)(e,i)?a.MOVEMENT:((e,t)=>e===n.INSIDE&&t===n.INSIDE)(e,i)&&s!==t?a.LIST_UPDATE:null;class o{constructor(e){this._handlers=e.map((e=>({zone:e,state:{}})))}handlePositioningUpdate(e){this._handlers.forEach((({state:t,zone:i})=>{const{callback:a,condition:s}=i,{listLength:o,proximity:c}=t,l=((e,t)=>e(t.getForList(),t.getForViewport())?n.INSIDE:n.OUTSIDE)(s,e),d=e.getListLength(),p=r(c,o,l,d);t.proximity=l,t.listLength=d,p&&a({triggerCause:p})}))}}},OhSZ:function(e,t,i){"use strict";i.d(t,"a",(function(){return _}));var a=i("ERkP"),s=i.n(a),n=i("aWyx"),r=i("XnpN"),o=i("3XMw"),c=i.n(o),l=i("jV+4"),d=i("pjBI"),p=i("t62R"),h=i("rHpw"),u=i("p9G8");const m=c.a.cfd94063,g=(e=[])=>e.map((({data:e})=>e)),b=h.a.create((e=>({title:{maxWidth:"50%"}}))),_=({conversation:e,newConversationParticipants:t,perspective:i})=>{if(e){if(e.type===n.a.ONE_TO_ONE){const[t]=Object(r.a)(e,i).map((({user:e})=>e));return t.name}return Object(u.a)(e,i)}{const e=g(t);return Object(u.b)(e,i)}};t.b=({conversation:e,isConversationSearchTitle:t=!1,isMessageSearchTitle:i=!1,newConversationParticipants:a,perspective:o,renderTimestamp:c,textColor:h="normal",titleWeight:_="bold",withScreenName:v=!0,withVDLRefresh:f=!1})=>{if(e){const a=c?c():null;if(e.type===n.a.ONE_TO_ONE){const[n]=Object(r.a)(e,o).map((({user:e})=>e)),c=s.a.createElement(l.a,{color:h,isProtected:n.protected,isVerified:n.verified,name:n.name,screenName:n.screen_name,weight:_,withLink:!1,withScreenName:v});return f&&!t||i?s.a.createElement(d.a,null,c,a):c}{const{participants:n}=e,r=Object.keys(n).length;if(t)return s.a.createElement(d.a,{color:h},s.a.createElement(p.b,{color:h,numberOfLines:1,style:b.title,weight:_},Object(u.a)(e,o,t)),f?null:s.a.createElement(p.b,{color:"gray700",numberOfLines:1,weight:"normal"},m({peopleCount:r})));const c=s.a.createElement(p.b,{color:h,numberOfLines:1,weight:_},Object(u.a)(e,o,t));return f&&!t||i?s.a.createElement(d.a,null,c,a):c}}{const e=g(a);return s.a.createElement(p.b,{color:h,numberOfLines:1,weight:_},Object(u.b)(e,o))}}},Oi4X:function(e,t,i){"use strict";var a=i("KEM+"),s=i.n(a),n=(i("MvUL"),i("ERkP")),r=i.n(n),o=i("0JOx"),c=i("zh9S"),l=i("MMRb"),d=i("CDB5"),p=i("RqPI"),h=i("1YZw"),u=i("hqKg"),m=i("kGix"),g=i("AQOc"),b=i("UhuB"),_=i("pNZL"),v=i("G6rE"),f=i("oEGd"),y=i("X/yg"),E=i("0KEI"),S=i("P1r1");const R=(e,t)=>t.conversationId,C=Object(u.createSelector)(l.selectFetchStatus,((e,t)=>l.selectConversationFetchStatus(e,R(0,t))),((e,t)=>e===m.a.LOADED?t:e)),w=Object(u.createSelector)(((e,t)=>l.selectEntriesForConversation(e,R(0,t))),p.q,((e,t)=>t?Object(y.d)(e,t):void 0)),x=Object(u.createSelector)(((e,t)=>l.selectConversation(e,R(0,t))),l.selectEntries,y.l,p.q,y.m,y.n,v.e.selectAll,C,((e,t)=>d.g(e,R(0,t))),((e,t)=>d.j(e,R(0,t))),((e,t)=>d.i(e,R(0,t))),((e,t)=>d.k(e,R(0,t))),((e,t)=>d.h(e,R(0,t))),((e,t)=>d.l(e,R(0,t))),S.k,b.n,w,S.n,((e,t)=>{const i=R(0,t);return l.selectInboxTypeByConversation(e,i)}),((e,t,i,a,s,n,r,o,c,l,d,p,h,u,m,b,_,v,f)=>{const y=e&&e.data;return{conversation:y&&Object(g.a)(y,t,r)||void 0,dataSaverMode:m,draftText:u,dtabBarInfo:v,fetchStatus:o,gifMetadata:h,inboxType:f,isDmReceiptSettingEnabled:b,cardUrl:c,isNewGroupConversation:i,isUploading:l,media:d,mediaUploadProgress:p,newConversationParticipants:s,perspective:a,quickReplyOptions:_,tweetAttachment:n}}));var A=Object(f.d)(x,(e=>{return{acceptConversation:l.acceptConversation,addMedia:(t=e.conversationId,(e,i)=>d.a(t,e,i)),saveText:d.f,addToast:h.b,addWelcomeMessageToConversation:l.addWelcomeMessageToConversation,cancelUpload:Object(y.a)(e.conversationId),createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),fetchConversationHistory:l.fetchConversationHistory,fetchConversationIfNeeded:l.fetchConversationIfNeeded,fetchInboxIfNeeded:l.fetchInboxIfNeeded,fetchUpdatesIfNeeded:l.fetchUpdatesIfNeeded,googleAnalyticsPageView:c.a,leaveConversation:l.leaveConversation,removeMedia:Object(y.b)(e.conversationId),removeText:d.d,scribeAction:c.c,scribePageImpression:c.d,sendMessage:d.m,updateConversationReadState:l.updateConversationReadState,updateTweetDetailNav:_.b,updateTyping:l.updateTyping,removeConversation:l.removeConversation,popOutConversation:l.popOutConversation};var t})),T=i("I2k/"),I=i("ejT/"),O=i("7n04"),M=i("Myq3"),k=i("VPAj");const P=(e,t)=>e.getForItem(t).doesIntersectWith(e.getForViewport()),D=e=>e.getForList().getBottom()-e.getForViewport().getBottom();var L=({isOwnMessage:e,typingIndicatorId:t})=>{const i=e=>Object(M.a)(e.getList(),(e=>e.id!==t));return{...O.a,initialScrollHeadroom:Object(k.a)(0),scrollHeadroom:Object(k.a)(0),offsetCorrection:(a,s)=>{const n=i(a),r=i(s),o=r&&(!n||n.id!==r.id),c=r&&e(r.data.data),l=n&&P(a,n.id);return o&&(c||l)||l&&((e,i)=>{const a=e.getForItem(t),s=i.getForItem(t);return!a||s&&s.getHeight()>a.getHeight()})(a,s)?Math.max(0,D(s)):O.a.offsetCorrection(a,s)}}},F=i("gbD7"),B=i("b9JY");var j=(e,t)=>{if(e&&e.message_data&&t&&t.message_data&&Object(B.b)(e)&&Object(B.b)(t)){const{sender_id:i,time:a}=e.message_data,{sender_id:s,time:n}=t.message_data,r=parseInt(n,10)-parseInt(a,10);return i===s&&r>=0&&r<=6e4}return!1},N=i("jat/"),U=i("v6aA"),H=i("XnpN"),W=i("LhSm"),V=i("I4+6"),z=i("rHpw"),q=i("PbQQ"),G=i("cm6r"),K=i("jV+4"),Q=i("pBrB"),$=i("wCd/");const Y=(e,t)=>{const i=Object(H.a)(e,t).map((({user:e})=>e)),a=i&&i[0];return{userDescription:a.description,userEntities:a.entities,userWithheldDescription:a.withheld_description,userWithheldEntities:a.withheld_entities,userFollowerCount:a&&a.followers_count,userFriendsCount:a&&a.friends_count,userIdStr:a&&a.id_str,userJoinDate:a&&a.created_at,userName:a&&a.name,userScreenName:a&&a.screen_name,userIsVerified:a&&a.verified}},J=z.a.create((e=>({root:{flexDirection:"column",alignItems:"center",marginBottom:e.spaces.space16,paddingVertical:e.spaces.space20,paddingHorizontal:e.spaces.space16,borderRadius:e.borderRadii.xSmall},profileInfoItemMargin:{marginBottom:e.spaces.space4},borderBottom:{borderBottomWidth:e.borderWidths.small,borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid"},description:{width:"100%",textAlign:"center"}})));var X=({conversation:e,withBottomBorder:t=!0})=>{const{loggedInUserId:i}=r.a.useContext(U.a);if(!e)return null;const{userDescription:a,userEntities:s,userFollowerCount:n,userFriendsCount:o,userIdStr:c,userIsVerified:l,userJoinDate:d,userName:p,userScreenName:h,userWithheldDescription:u,userWithheldEntities:m}=Y(e,i||""),g=!!(p&&h&&(n&&o||d)),b=V.a.generate({color:z.a.theme.colors.text,backgroundColor:z.a.theme.colors.transparent,customFocusBackgroundColor:z.a.theme.colors.gray0,customHoverBackgroundColor:z.a.theme.colors.gray0,customPressedBackgroundColor:z.a.theme.colors.activeFaintGray});return r.a.createElement(q.a.Consumer,null,(e=>r.a.createElement(G.a,{interactiveStyles:b,link:e.withAnchorless(`https://twitter.com/${h||""}`),style:[J.root,t&&g&&J.borderBottom]},r.a.createElement(K.a,{isVerified:l,name:p,screenName:h,style:J.profileInfoItemMargin,weight:"bold",withHoverCard:!0,withLink:!0}),a&&s&&c?r.a.createElement(Q.a,{description:a,entities:s,style:[J.profileInfoItemMargin,J.description],userId:c,withheldDescription:u,withheldEntities:m}):null,n&&o?r.a.createElement($.a,{followersCount:n,friendsCount:o,screenName:h||"",style:J.profileInfoItemMargin,withLink:!1}):null,d?r.a.createElement(W.a,{joinDate:d}):null)))},Z=i("V/6K"),ee=i("cFyg"),te=i("g54k"),ie=i("aA19"),ae=i("aWyx"),se=i("mN6z"),ne=i("MWbm"),re=i("t62R"),oe=i("jhWN"),ce=i("MAI/"),le=i("zQEV");const de=({children:e,link:t,style:i})=>r.a.createElement(re.b,{align:"center",color:"gray700",link:t,size:"subtext2",style:i},e);class pe extends r.a.Component{constructor(...e){super(...e),s()(this,"_renderContents",(()=>{const{conversation:e,entry:t,entryType:i,perspective:a,users:s}=this.props,n=Object(le.a)(t,i,a,s);switch(i){case ae.b.CONVERSATION_AVATAR_UPDATE:{const i=e.avatar_image_https===t.conversation_avatar_image_https;return r.a.createElement(r.a.Fragment,null,this._isValidImageSource(e.avatar_image_https)&&i?r.a.createElement(ne.a,{style:he.conversationAvatarContainer},r.a.createElement(ie.a,{conversation:e,perspective:a})):null,r.a.createElement(de,null,n))}case ae.b.JOIN_CONVERSATION:{const e=this._getAddedYouMessageWithProfileInfo(n),t=this._getParticipantsFromEntry(),i=r.a.createElement(re.b,{align:"center",color:"gray700",size:"subtext2"},this._getParticipantsFromEntryText(t)),a=this._getJoinConversationDetailsWithFacepile(t,i);return r.a.createElement(r.a.Fragment,null,e,a)}default:return r.a.createElement(de,null,n)}})),s()(this,"_getAddedYouMessageWithProfileInfo",(e=>{const{entry:t,users:i}=this.props,a=t.sender_id?i[t.sender_id]:void 0,s=a?{pathname:`https://twitter.com/${a.screen_name}`}:void 0;return r.a.createElement(G.a,{interactiveStyles:null,link:s,style:he.userAddedYouContainer},a?r.a.createElement(oe.a,{accessibilityLabel:a.screen_name,screenName:a.screen_name,size:"medium",uri:a.profile_image_url_https,withHoverCard:!0,withLink:!0}):null,r.a.createElement(de,{link:s,style:he.userAddedYouText},e))})),s()(this,"_getJoinConversationDetailsWithFacepile",((e,t)=>{const{conversation:i}=this.props,a=e.slice(0,20).map((({profile_image_url_https:e})=>e));return r.a.createElement(G.a,{interactiveStyles:null,link:{pathname:`/messages/${i.conversation_id}/participants`},style:he.joinConversationDetails},t,r.a.createElement(ce.a,{style:he.userAvatarFacepile,userAvatarSize:"xLarge",userAvatarUrls:a}))}))}shouldComponentUpdate(e){return!Object(se.a)(this.props,e)}render(){return r.a.createElement(ne.a,{style:he.root},this._renderContents())}_isValidImageSource(e){return e&&""!==e&&e.indexOf("MEDIA_NOT_FOUND")<0}_getParticipantsFromEntry(){const{entry:e,perspective:t,users:i}=this.props;return e.participants?e.participants.filter((({user_id:e})=>t!==e)).map((({user_id:e})=>i[e])).filter(Boolean):[]}_getParticipantsFromEntryText(e){const{conversation:{conversation_id:t}}=this.props;return Object(le.b)(e.length,t)}}const he=z.a.create((e=>({root:{paddingBottom:e.spaces.space20},conversationAvatarContainer:{alignSelf:"center",height:e.spaces.space64,marginBottom:e.spaces.space12,width:e.spaces.space64},userAddedYouContainer:{flexDirection:"row",justifyContent:"center"},userAddedYouText:{flexShrink:1,marginLeft:e.spaces.space12},joinConversationDetails:{marginTop:e.spaces.space4},userAvatarList:{marginTop:e.spaces.space4},userAvatarFacepile:{marginTop:e.spaces.space4,justifyContent:"center"}})));var ue=Object(te.a)(pe),me=i("oQhu");var ge=Object(me.a)((function(e){const t=z.a.theme.spacesPx.space40;return{DMUserAvatarSizeType:"xLarge",DMUserAvatarSizePx:t,DMUserAvatarSpacerPx:t+z.a.theme.spacesPx.space12}})),be=i("shC7"),_e=i("38/B");const ve=function(e){return fe(e,_e.a.reducedMotionEnabled)},fe=Object(me.a)((function(e,t){const i=function(){const{DMUserAvatarSizePx:e,DMUserAvatarSpacerPx:t}=ge(z.a.theme.scale),i=Se[z.a.theme.scale],a=ye/i,s=Ee/e,n=Ee/2,r=Ee-n,o=Ee-n-t;return{cssTransition:_e.a.reducedMotionEnabled?{}:{transition:`transform ${Ce}, opacity ${Ce}`},messageContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(be.a.getConstants().isRTL?1:-1)*r}]},received:{transform:[{translateX:(be.a.getConstants().isRTL?-1:1)*o}]}}},actionsContainer:{base:{transform:[{translateX:0}]},active:{sent:{transform:[{translateX:(be.a.getConstants().isRTL?1:-1)*Re[z.a.theme.scale]}]},received:{transform:[{translateX:(be.a.getConstants().isRTL?-1:1)*(Re[z.a.theme.scale]+o)-n}]}}},voiceMessage:{container:{base:{height:i},active:{height:ye}},base:{height:i,transform:[{scale:1}]},active:{base:{transform:[{scale:a}]},sent:{paddingRight:n/a,transformOrigin:be.a.getConstants().isRTL?"bottom left":"bottom right"},received:{paddingLeft:n/a,transformOrigin:be.a.getConstants().isRTL?"bottom right":"bottom left"}}},userAvatar:{base:{transform:[{scale:1}]},sent:{transformOrigin:be.a.getConstants().isRTL?"bottom left":"bottom right"},received:{transformOrigin:be.a.getConstants().isRTL?"bottom right":"bottom left"},active:{opacity:1,pointerEvents:"all",transform:[{scale:s}]},visuallyHidden:{opacity:0,pointerEvents:"none"}}}}();return{actionsContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.actionsContainer.base];return t&&a.push(e?i.actionsContainer.active.sent:i.actionsContainer.active.received),a},messageContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.messageContainer.base];return t&&a.push(e?i.messageContainer.active.sent:i.messageContainer.active.received),a},voiceMessageContainer:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.voiceMessage.container.base];return t&&a.push(i.voiceMessage.container.active),a},voiceMessage:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.voiceMessage.base];return t&&(a.push(i.voiceMessage.active.base),a.push(e?i.voiceMessage.active.sent:i.voiceMessage.active.received)),a},userAvatar:function({isSent:e,isVoiceMessageActive:t}){const a=[i.cssTransition,i.userAvatar.base,e?i.userAvatar.sent:i.userAvatar.received];return t?a.push(i.userAvatar.active):e&&a.push(i.userAvatar.visuallyHidden),a}}}));const ye=60,Ee=ye,Se={xSmall:42,small:42,normal:47,large:47,xLarge:47},Re={xSmall:72.26,small:165.61-89.3,normal:158.22-94.4,large:166.64-100.58,xLarge:181.55-111.81},Ce="0.2s 0s ease-in-out";var we=i("+Kfv");const xe={scribeAction:c.c},Ae=Object(u.createSelector)(((e,t)=>v.e.select(e,t.senderId)),S.l,S.r,((e,t,i)=>({user:e,displaySensitiveMedia:t,isDmNsfwMediaFilterEnabled:i})));var Te=Object(f.g)(Ae,xe);const Ie={addToast:h.b,createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_OVERFLOW_ACTIONS"),deleteEntry:l.deleteEntry};var Oe=Object(f.b)(Ie),Me=i("k49u"),ke=i("LVU8"),Pe=i("3XMw"),De=i.n(Pe);const Le=De.a.f58dff33,Fe=De.a.ad5a8e8e,Be={[Me.a.MissingParameter]:{toast:Object(ke.a)(Le)},[Me.a.DirectMessageDestroyPermissionsError]:{toast:{text:Fe}},showToast:!0};var je=i("xCUF"),Ne=i("uKEd");const Ue=[],He=Object(u.createSelector)((e=>Object(Ne.l)(e).entries),((e,t)=>Object(Ne.p)(e,t.entry.id)||Ue),((e,t)=>t.perspective),((e,t,i)=>({selectedReactions:t.filter((t=>{const a=e[t]&&e[t].data;return a&&a.sender_id===i})).map((t=>e[t].data.reaction_key))}))),We={createReaction:Ne.d,createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS_POPOVER"),fetchUpdatesIfNeeded:je.d,removeReaction:Ne.k};var Ve=Object(f.g)(He,We),ze=i("33Kz"),qe=i("wTX1");var Ge=({accessibilityLabelFormatter:e,count:t,emojiSize:i,emotion:a,enableHoverStyle:s,focusable:n,onPress:o,style:c})=>{const{featureSwitches:l}=r.a.useContext(U.a),d=Object(ze.b)(a,l),p=e&&d?e({emoji:d,count:t}):void 0,h=V.a.generate({backgroundColor:z.a.theme.colors.gray50,color:z.a.theme.colors.gray700});return r.a.createElement(G.a,{accessibilityLabel:p,focusable:n,interactiveStyles:s?h:null,onPress:o,style:[Ke.container,...c||[]]},r.a.createElement(re.b,{size:i,style:Ke.unsetLineHeight},d),t?r.a.createElement(qe.a,{color:"gray700",containerStyle:Ke.count,count:t,size:"subtext3"},t):null)};const Ke=z.a.create((e=>({container:{flexDirection:"row"},count:{alignSelf:"center",minWidth:e.spaces.space16,paddingLeft:e.spaces.space2},unsetLineHeight:{lineHeight:"unset"}})));var Qe=i("pHkl"),$e=i("Irs7");const Ye=De.a.ca7a2214,Je=De.a.fc0e94b7;class Xe extends r.a.Component{constructor(...e){super(...e),s()(this,"_handleReactionScribing",((e,t)=>{const{analytics:i,entry:a,isGroupDM:s,participantsCount:n}=this.props,r=t?"delete_reaction":"create_reaction",o=Object(y.c)(a);i.scribe({section:"twitter_service",component:"direct_messages",element:r,action:"success",data:{conversation_id:a.conversation_id,conversation_participant_count:n,conversation_type:s?Qe.g.GROUP:Qe.g.ONE_TO_ONE,message_type:o,reaction_emotion:e}})})),s()(this,"_reactionClickHandler",((e,t)=>()=>{const{createLocalApiErrorHandler:i,createReaction:a,dismiss:s,entry:n,fetchUpdatesIfNeeded:r,perspective:o,removeReaction:c}=this.props,l={reaction_key:e,conversation_id:n.conversation_id,dm_id:n.id,perspective:o};(t?c:a)(l).then(this._handleReactionScribing(e,t)).then((()=>r())).catch(i()),s()}))}render(){const{selectedReactions:e}=this.props,t=Object(ze.a)(this.context.featureSwitches).map((t=>{const i=e.includes(t);return r.a.createElement(Ge,{accessibilityLabelFormatter:i?Ye:Je,emojiSize:"title4",emotion:t,enableHoverStyle:!0,focusable:!0,key:t,onPress:this._reactionClickHandler(t,i),style:[et.reaction,i&&et.selectedReaction]})}));return r.a.createElement(ne.a,{style:et.reactions},t)}}s()(Xe,"contextType",U.a);var Ze=Object($e.a)(Ve(Xe));const et=z.a.create((e=>({reactions:{cursor:"pointer",flexDirection:"row",padding:e.spaces.space12},reaction:{borderRadius:e.borderRadii.small,padding:e.spaces.space4},selectedReaction:{backgroundColor:e.colors.gray50}})));var tt=i("OiMc");class it extends r.a.Component{constructor(...e){super(...e),s()(this,"_renderDMReactionPickerContent",(e=>{const{entry:t,isGroupDM:i,participantsCount:a,perspective:s}=this.props;return r.a.createElement(Ze,{dismiss:e,entry:t,isGroupDM:i,participantsCount:a,perspective:s})}))}render(){const{children:e,onDismiss:t}=this.props;return r.a.createElement(tt.a,{enableEnterKeyToggle:!0,onDismiss:t,preferredVerticalOrientation:"up",renderContent:this._renderDMReactionPickerContent,withArrow:!0,withFixedPosition:this.context.isDrawer},e)}}s()(it,"contextType",Z.a);var at=i("fz3c"),st=i("TnY3"),nt=i("mjJ+"),rt=i("Q0VY"),ot=i("eb3s"),ct=i("/yvb"),lt=i("ZToW"),dt=i("CaKu"),pt=i("i4Oy"),ht=i("4w6w");const ut=(e,t)=>{if(null==e)return!1;const[i,a]=t||[0,0];return!((0===i||1===i)&&e.length===a)},mt=e=>{const{message_data:t}=e;if(!t)return!1;const{attachment:i}=t;if(!i)return!0;if(i.sticker)return!1;const a=i.tweet||i.photo||i.animated_gif||i.video||void 0;if(a)return ut(t.text,a.indices);if(i.card){var s;const e=((null===(s=t.entities)||void 0===s?void 0:s.urls)||[]).find((e=>e.url===i.card));return ut(t.text,e&&e.indices)}return!0},gt=e=>{var t;const i=null==e||null===(t=e.message_data)||void 0===t?void 0:t.attachment;return!(!i||!(i.card||i.tweet||i.photo||i.animated_gif||i.video))},bt=e=>{var t;const i=null==e||null===(t=e.message_data)||void 0===t?void 0:t.attachment;return!(!i||!i.fleet)},_t=(e,t,i)=>{const a=1.25*z.a.theme.fontSizesPx.body;return{compositeRendered:e?void 0!==t&&void 0!==i:void 0!==t,isTextSquared:void 0!==t&&void 0!==i&&(i===t||i<=t-a),isAttachmentSquared:void 0!==i&&void 0!==t&&(t===i||t<=i-a)}};var vt=i("hiGS"),ft=i("zIWA"),yt=i("Lsrn"),Et=i("k/Ka");const St=(e={})=>Object(Et.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[yt.a.root,e.style],viewBox:"0 0 24 24"},r.a.createElement("g",null,r.a.createElement("path",{d:"M16.925 9.5H14.5V7.075c0-.414-.336-.75-.75-.75s-.75.336-.75.75V9.5h-2.425c-.414 0-.75.336-.75.75s.336.75.75.75H13v2.425c0 .414.336.75.75.75s.75-.336.75-.75V11h2.425c.414 0 .75-.336.75-.75s-.336-.75-.75-.75zm-.3 11H4.25c-.413 0-.75-.337-.75-.75V8.402c0-.414-.336-.75-.75-.75s-.75.336-.75.75V19.75C2 20.99 3.01 22 4.25 22h12.375c.414 0 .75-.336.75-.75s-.336-.75-.75-.75z"}),r.a.createElement("path",{d:"M19.75 2h-12C6.51 2 5.5 3.01 5.5 4.25v12c0 1.24 1.01 2.25 2.25 2.25h12c1.24 0 2.25-1.01 2.25-2.25v-12C22 3.01 20.99 2 19.75 2zm.75 14.25c0 .413-.337.75-.75.75h-12c-.413 0-.75-.337-.75-.75v-12c0-.413.337-.75.75-.75h12c.413 0 .75.337.75.75v12z"})));St.metadata={width:24,height:24};var Rt=St,Ct=i("DlVf"),wt=i("ACHU"),xt=i("UgB4");const At=De.a.ba60339a,Tt=De.a.j4bfee22,It=De.a.d96cf7cd,Ot=De.a.faddd3a2,Mt=De.a.eb497e08,kt=De.a.b170974a,Pt=De.a.i202bd22,Dt=De.a.f2e5491a,Lt=De.a.f88553c8,Ft=De.a.ifea3114,Bt=De.a.cac14829,jt=De.a.h63a5c3b;class Nt extends r.a.Component{constructor(e,t){super(e,t),s()(this,"_renderOverflowMenu",(e=>{const{analytics:t,entry:i,isSent:a}=this.props,s=t.contextualScribeNamespace,n=[{text:At,Icon:vt.a,isEmphasized:!0,onClick:this._handleShowDeleteConfirmation(e)}];return a||n.push({text:Pt,Icon:ft.a,link:{pathname:`/i/report/${at.a.DMMessage}/${i.id}`,state:{clientReferer:window.location.pathname,conversationId:i.conversation_id,scribeNamespace:s}},onClick:this.props.onReportMessage}),dt.a.isAvailable()&&n.push({text:Dt,Icon:Rt,onClick:this._handleCopyMessageText}),r.a.createElement(nt.a,{isFixed:this.context.isDrawer,items:n,onCloseRequested:this._handleHideActionsAndMenus(e),preferredHorizontalOrientation:"right"})})),s()(this,"_handleCopyMessageText",(e=>{const{addToast:t}=this.props,i=this._replaceMessageUrls();i&&(dt.a.setString(i),t({text:Lt})),e&&e()})),s()(this,"_handleForwardButton",(()=>{var e,t;const{entry:i,history:a}=this.props;if(null!=i&&null!==(e=i.message_data)&&void 0!==e&&null!==(t=e.attachment)&&void 0!==t&&t.tweet){const{tweet:e}=i.message_data.attachment;a.push({pathname:"/messages/compose",state:{tweetAttachment:{...e,id_str:e.status}}})}})),s()(this,"_handleSetActionsActive",(()=>{const{setShouldFreezeUpdates:e}=this.props;this.setState({actionsAreActive:!0}),e(!0)})),s()(this,"_handleDelete",(()=>{const{analytics:e,createLocalApiErrorHandler:t,deleteEntry:i,entry:a,inboxType:s,isGroupDM:n,participantsCount:r}=this.props,o=Object(y.c)(a);e.scribe({action:"delete",data:{conversation_id:a.conversation_id,conversation_type:n?1:0,conversation_participant_count:r,message_type:o,inbox_type:Object(y.h)(s)}}),i({conversationId:a.conversation_id,id:a.id}).catch(t(Be))})),s()(this,"_handleHideDeleteConfirmation",(()=>{this.setState({showDeleteConfirmation:!1})})),s()(this,"_handleHideActionsAndMenus",(e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e&&e(),this.setState({actionsAreActive:!1}),t(!1)})),s()(this,"_handlePressReactionPickerButton",(()=>{const{analytics:e,entry:t}=this.props;e.scribe({component:"reaction_button",element:Object(y.c)(t),action:"click"}),this._handleSetActionsActive()})),s()(this,"_handleShowDeleteConfirmation",(e=>()=>{const{setShouldFreezeUpdates:t}=this.props;e(),this.setState({actionsAreActive:!1,showDeleteConfirmation:!0}),t(!1)})),s()(this,"_replaceMessageUrls",(()=>{const{entry:e}=this.props,t=e&&e.message_data&&e.message_data.entities;let i=e&&e.message_data&&e.message_data.text||"";return rt.a.tweetTextParts(i,[0,i.length],t).forEach((e=>{"url"===e.entityType&&(i=i.replace(e.url,e.expandedUrl))})),i})),this.state={actionsAreActive:!1,showDeleteConfirmation:!1},this._hasMedia=gt(this.props.entry),this._isNarrow=pt.a.get("screen").width<z.a.theme.breakpoints.xSmall}render(){var e,t;const{entry:i,isSent:a,shouldShowReactionButton:s,style:n,withVDLRefresh:o}=this.props,c=this._areActionsVisible();return r.a.createElement(ne.a,{pointerEvents:c?"auto":"none",style:[Ht.messageActions,a?Ht.messageActionsLeft:Ht.messageActionsRight,c?Ht.visible:Ht.invisible,o&&Ht.vdlMessageActions,this._isNarrow&&(this._hasMedia?Ht.messageActionsMediaNarrow:Ht.messageActionsNarrow),n]},(null==i||null===(e=i.message_data)||void 0===e||null===(t=e.attachment)||void 0===t?void 0:t.tweet)&&o&&this._renderForwardButton(),s&&this._renderReactionButton(),this._renderOverflowButton(),this._renderDeleteConfirmation())}_renderDeleteConfirmation(){return this.state.showDeleteConfirmation?r.a.createElement(ot.a,{confirmButtonLabel:It,confirmButtonType:"destructiveFilled",headline:Tt,onCancel:this._handleHideDeleteConfirmation,onConfirm:this._handleDelete,text:Ot}):null}_renderForwardButton(){return r.a.createElement(ct.a,{accessibilityLabel:Ft,hoverLabel:{label:Ft},icon:Wt,onPress:this._handleForwardButton,size:this._isNarrow?"small":"medium",type:"brandText"})}_renderReactionButton(){const{entry:e,isGroupDM:t,participantsCount:i,perspective:a,withVDLRefresh:s}=this.props,{actionsAreActive:n}=this.state,o=r.a.createElement(Ct.a,{style:s?Ht.vdlActionIcon:Ht.actionIcon});return r.a.createElement(it,{entry:e,isGroupDM:t,onDismiss:this._handleHideActionsAndMenus(),participantsCount:i,perspective:a},r.a.createElement(ct.a,{accessibilityExpanded:!!n,accessibilityHasPopup:"menu",accessibilityLabel:kt,hoverLabel:{label:Bt},icon:o,onPress:this._handlePressReactionPickerButton,size:this._isNarrow?"small":"medium",type:"brandText"}))}_renderOverflowButton(){const{withVDLRefresh:e}=this.props,t=r.a.createElement(wt.a,{style:e?Ht.vdlActionIcon:Ht.actionIcon});return r.a.createElement(ct.a,{accessibilityLabel:Mt,hoverLabel:{label:jt},icon:t,onPress:this._handleSetActionsActive,renderMenu:this._renderOverflowMenu,size:this._isNarrow?"small":"medium",type:"brandText"})}_areActionsVisible(){const{containerIsActive:e,containerIsFocused:t,containerIsHovered:i,isDraft:a}=this.props,{actionsAreActive:s}=this.state,n=(r=this.props.entry,!mt(r)&&gt(r)&&!lt.a.isEnabled);var r;return!a&&(n||e&&!lt.a.isEnabled||t||i||s)}}s()(Nt,"contextType",Z.a);var Ut=Object(st.a)(Object($e.a)(Oe(Nt)));const Ht=z.a.create((e=>({invisible:{opacity:0},messageActions:{alignSelf:"flex-end",flexDirection:"row"},messageActionsMediaNarrow:{flexDirection:"column"},messageActionsNarrow:{flexShrink:1,flexWrap:"wrap",minWidth:e.spaces.space32},messageActionsLeft:{justifyContent:"flex-end",paddingRight:e.spaces.space4},messageActionsRight:{justifyContent:"flex-start",paddingLeft:e.spaces.space4},vdlMessageActions:{alignSelf:"center"},actionIcon:{color:e.colors.gray700},vdlActionIcon:{color:e.colors.gray600},visible:{opacity:1}}))),Wt=r.a.createElement(xt.a,{style:Ht.vdlActionIcon});var Vt=i("97Jx"),zt=i.n(Vt),qt=i("rxPX");var Gt=Object(qt.a)().propsFromActions((()=>({createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_CONVERSATION"),removeEntry:l.removeEntry,sendMessage:d.m}))).withAnalytics();const Kt="87.5%";var Qt=i("wrlS");const $t=[],Yt=(e,t)=>Object(Ne.p)(e,t.entryId)||$t,Jt=e=>Object(Ne.l)(e).entries,Xt={createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTIONS")};var Zt=Object(f.e)((()=>Object(u.createSelector)(Jt,Yt,p.q,Qt.d,((e,t,i,a)=>{const s=Object(ze.a)(a,{includeInactive:!0});let n,r=0;return{reactionsWithCounts:t.reduceRight(((t,a)=>{const o=e[a]&&e[a].data;if(!o)return t;if(!s.includes(o.reaction_key))return t;const c=(t.get(o.reaction_key)||0)+1;return t.set(o.reaction_key,c),(null==o?void 0:o.sender_id)===i&&(n=o.reaction_key),r+=1,t}),new Map),selectedReactionKey:n,totalReactionCount:r}}))),Xt);const ei=[],ti=(e,t)=>t.entryId,ii=e=>Object(Ne.l)(e).entries,ai=(e,t)=>Object(Ne.p)(e,ti(0,t))||ei,si=(e,t)=>v.e.selectMany(e,((e,t)=>Object(Ne.q)(e,ti(0,t)))(e,t)),ni={removeReaction:Ne.k,fetchUpdatesIfNeeded:je.d,createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DIRECT_MESSAGES_REACTION_SUMMARY_CONTEXT")};var ri=Object(f.e)((()=>Object(u.createSelector)(ii,ai,p.q,si,Qt.d,((e,t,i,a,s)=>{const n=Object(ze.a)(s,{includeInactive:!0}),r=[];t.forEach((t=>{const s=e[t]&&e[t].data;if(!(s&&n.includes(s.reaction_key)))return;const o=a.find((e=>e&&e.id_str===s.sender_id)),c=o&&{avatarUri:o.profile_image_url_https,userId:o.id_str,reactionKey:s.reaction_key,isLoggedInUser:o.id_str===i,screenName:o.screen_name,name:o.name,isProtected:o.protected,isVerified:o.verified,time:s.time};c&&r.push(c)})),r.sort(((e,t)=>t.time-e.time));const o=r.findIndex((e=>e.userId===i));return o>-1&&r.push(...r.splice(0,o)),{loggedInUserId:i,usersWithReactions:r}}))),ni),oi=i("TIdA"),ci=i("htQn");const li=De.a.gf5e9ea6,di=De.a.a2d48778,pi=oi.a.createLayoutCache();const hi=z.a.create((e=>({bodyColumn:{flexShrink:1,flexGrow:1,justifyContent:"center",marginHorizontal:e.spaces.space4},body:{alignItems:"center",flexDirection:"row",justifyContent:"space-between"},bottomBorder:{borderBottomColor:e.colors.borderColor,borderBottomStyle:"solid",borderBottomWidth:e.borderWidths.small},column:{alignItems:"center",justifyContent:"center",marginRight:e.spaces.space4},reactionColumn:{alignItems:"center",justifyContent:"center",marginRight:e.componentDimensions.gutterHorizontal},root:{flexDirection:"row",minHeight:"56px",paddingHorizontal:e.componentDimensions.gutterHorizontal,paddingVertical:e.componentDimensions.gutterVertical}})));var ui=function(e){const{featureSwitches:t}=r.a.useContext(U.a),{onUndoPress:i,renderUndo:a,user:s,withBottomBorder:n}=e,{avatarUri:o,isProtected:c,isVerified:l,name:d,screenName:p}=s,h=r.a.useMemo((()=>function(e){e.stopPropagation(),i()}),[i]),u=r.a.createElement(oe.a,{imageLayoutCache:pi,screenName:p,size:"xxLarge",uri:o}),m=r.a.createElement(Ge,{emojiSize:"title4",emotion:s.reactionKey,focusable:!1}),g=r.a.createElement(K.a,{badgeContext:"content",isProtected:c,isVerified:l,name:d,screenName:p,withHoverCard:!0,withStackedLayout:!0});return r.a.createElement(ci.a,{link:{pathname:`/${p}`,anchorless:!0},style:[hi.root,n&&hi.bottomBorder]},r.a.createElement(ne.a,{style:hi.reactionColumn},m),r.a.createElement(ne.a,{style:hi.column},u),r.a.createElement(ne.a,{style:hi.bodyColumn},r.a.createElement(ne.a,{style:hi.body},g)),a?r.a.createElement(ne.a,{style:hi.column},r.a.createElement(ct.a,{accessibilityLabel:di({emoji:Object(ze.b)(s.reactionKey,t)}),onClick:h,size:"small",type:"brandText"},li)):null)},mi=i("xKuM"),gi=i("efqG");const bi=De.a.b772cd65,_i=De.a.c0098d49,vi=De.a.j85999eb;class fi extends r.a.PureComponent{constructor(...e){super(...e),s()(this,"_renderContent",((e,t)=>r.a.createElement(ne.a,null,this._renderHeader(e,t),this._renderUsers(e,t),this._renderDoneButton(e,t)))),s()(this,"_renderHeader",((e,t)=>"sheet"===t?r.a.createElement(mi.a,{title:_i,withBottomBorder:!0}):r.a.createElement(re.b,{visuallyHidden:!0},_i))),s()(this,"_renderUsers",((e,t)=>r.a.createElement(ne.a,{accessibilityLabel:vi,style:[yi.container,"sheet"===t?yi.sheet:yi.popover]},this._renderUserCells(e)))),s()(this,"_renderDoneButton",((e,t)=>"sheet"===t&&r.a.createElement(ct.a,{key:"button_done",onPress:e,style:yi.cancelButton,type:"primaryOutlined"},bi))),s()(this,"_renderUserCells",(e=>this.props.usersWithReactions.filter(Boolean).map(((t,i)=>r.a.createElement(ui,{history:this.props.history,key:t.userId,onUndoPress:this._reactionUndoHandler(t.reactionKey,e),renderUndo:t.isLoggedInUser,user:t,withBottomBorder:i!==this.props.usersWithReactions.length-1}))))),s()(this,"_reactionUndoHandler",((e,t)=>()=>{const{conversationId:i,createLocalApiErrorHandler:a,entryId:s,fetchUpdatesIfNeeded:n,loggedInUserId:r,removeReaction:o}=this.props,c={reaction_key:e,conversation_id:i,dm_id:s,perspective:r};t(),o(c).then(this._handleScribeRemoveReaction(e)).then(n).catch(a())})),s()(this,"_handleScribeRemoveReaction",(e=>()=>{const{analytics:t}=this.props;t.scribe({page:"app",section:"twitter_service",component:"direct_messages",element:"delete_reaction",action:"success",data:{reaction_emotion:e}})}))}render(){const{children:e}=this.props;return r.a.createElement(gi.a,{renderContent:this._renderContent,withFixedPosition:this.context.isDrawer},e)}}s()(fi,"contextType",Z.a);const yi=z.a.create((e=>({cancelButton:{marginHorizontal:e.spaces.space12,marginVertical:e.spaces.space12},container:{overflowY:"auto",paddingVertical:e.spaces.space12},popover:{maxHeight:"35vh",minWidth:"320px"},sheet:{maxHeight:"65vh"}})));var Ei=Object(st.a)(Object($e.a)(ri(fi)));const Si=De.a.h95f9e76;class Ri extends r.a.PureComponent{constructor(e){super(e),s()(this,"_handleScribeDMReactionSummary",(()=>{const{analytics:e}=this.props;e.scribe({component:"dm_reaction_summary",action:"show"})})),s()(this,"_onSetReactionsNode",(e=>{this._measureWidths(e||void 0)})),s()(this,"_renderReactions",(({isHovered:e})=>{const{reactionsWithCounts:t,selectedReactionKey:i}=this.props,a=this.state.emojiSize||"headline1",s=t.size-1;return Array.from(t,(([t,n],o)=>r.a.createElement(Ge,{count:n,emojiSize:a,emotion:t,enableHoverStyle:!1,focusable:!0,key:t,style:[o===s&&Ci.rightPadding,Ci.elementPadding,i===t?Ci.selfSelect:null,e&&Ci.isHoveredDMReaction]})))})),this.state={emojiSize:void 0}}render(){const{conversationId:e,entryId:t,isEndOfDM:i,isSent:a,totalReactionCount:s}=this.props,{emojiSize:n}=this.state;if(0===s)return null;const o=V.a.generate({backgroundColor:z.a.theme.colors.gray50,color:z.a.theme.colors.gray700}),c=Si({reactionCount:s});return r.a.createElement(ne.a,{style:[Ci.container,i?Ci.marginShort:Ci.marginLong,a?Ci.alignRight:Ci.alignLeft,n?Ci.visible:Ci.invisible]},r.a.createElement(Ei,{conversationId:e,entryId:t},r.a.createElement(G.a,{accessibilityLabel:c,focusable:!0,interactiveStyles:o,onPress:this._handleScribeDMReactionSummary,ref:this._onSetReactionsNode,style:Ci.content},this._renderReactions)))}_measureWidths(e){const t=e&&e.parentElement,i={emojiSize:"headline1"};if(t){const{width:a}=t.getBoundingClientRect(),{width:s=0}=e?e.getBoundingClientRect():{};s>a&&(i.emojiSize="subtext2")}this.setState({...i})}}const Ci=z.a.create((e=>({container:{boxSizing:"border-box"},content:{borderRadius:e.borderRadii.infinite,display:"flex",flexDirection:"row"},rightPadding:{paddingRight:e.spaces.space2},elementPadding:{borderColor:e.colors.transparent,borderWidth:e.borderWidths.small,paddingBottom:e.spaces.space2,paddingTop:e.spaces.space2,paddingLeft:`calc(${e.spaces.space2} * 2)`},selfSelect:{borderColor:z.a.theme.colors.gray50,borderRadius:e.borderRadii.infinite},alignLeft:{alignSelf:"flex-start"},alignRight:{alignSelf:"flex-end"},invisible:{opacity:0},visible:{opacity:1},marginShort:{marginBottom:e.spaces.space4},marginLong:{marginBottom:e.spaces.space12},isHoveredDMReaction:{borderColor:e.colors.transparent,cursor:"pointer"}})));var wi=Object($e.a)(Zt(Ri)),xi=i("Xrkv");const Ai=De.a.icd0bf34,Ti=De.a.e8bd8fec,Ii=De.a.b2d32fad,Oi=De.a.a763d33e;class Mi extends r.a.PureComponent{constructor(e){super(e),s()(this,"_handlePress",(e=>{e.stopPropagation(),this.setState({showFullList:!0})})),this.state={showFullList:!1}}render(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return r.a.createElement(ne.a,{style:ki.root},r.a.createElement(re.b,{align:"right",color:"gray700",size:"subtext2",style:ki.seenLabel},this._renderSeenLabel()),!t&&e&&i.length?this._renderNameList():null)}_renderSeenLabel(){const{isGroupDM:e,isSeenByEveryone:t,namesToDisplay:i}=this.props;return t?e?Ii:Ai:i.length?Oi({count:i.length}):Ti}_renderNameList(){let{namesToDisplay:e}=this.props;const{showFullList:t}=this.state,i=!t&&e.length>10,a=e.length-10,s=({namesList:e,othersCount:t})=>r.a.createElement(De.a.I18NFormatMessage,{$i18n:"f6464106"},r.a.createElement(re.b,null,e),r.a.createElement(re.b,{color:"link",onPress:this._handlePress},De.a.d7a0722f({othersCount:t})));i&&(e=e.slice(0,10));const n=Object(xi.a)(e,i);return r.a.createElement(re.b,{align:"right",color:"gray700",size:"subtext2",style:ki.namesList},i?r.a.createElement(s,{namesList:n,othersCount:a}):r.a.createElement(re.b,null,n))}}const ki=z.a.create((e=>({root:{alignItems:"flex-end",width:`calc(100% - ${e.spaces.space2})`},seenLabel:{cursor:"pointer"},namesList:{marginBottom:e.spaces.space2,whiteSpace:"pre-line"}})));var Pi=Mi,Di=i("t0aI");const Li=({entryId:e,participants:t,user:i})=>{const a=Object.keys(t),s=Fi({entryId:e,participants:t,user:i});return{namesToDisplay:s,isSeenByEveryone:s.length===a.length-1}},Fi=({entryId:e,participants:t,user:i})=>Object.keys(t).reduce(((a,s)=>{const{join_conversation_event_id:n,last_read_event_id:r,user:{name:o}}=t[s],c=s!==i.id_str,l=r&&1!==Object(Di.a)(e,r),d=!n||1!==Object(Di.a)(n,e);return c&&l&&d&&a.push(o),a}),[]);var Bi=i("IMYl"),ji=i("21zW"),Ni=i("gmpV");const Ui=De.a.fad48ee9,Hi=De.a.ba60339a,Wi=De.a.d338f53e,Vi=De.a.ae7d7a24,zi=De.a.d725a288,qi=De.a.bbe74f3f,Gi=De.a.h0e4cdf4,Ki=De.a.bfbc051c;class Qi extends r.a.PureComponent{constructor(...e){super(...e),s()(this,"_handleRemove",(()=>{const{conversationId:e,entryId:t,removeEntry:i}=this.props;i(e,null,{id:t})})),s()(this,"_handleTryAgain",(()=>{const{conversationId:e,entryText:t,localMediaId:i,sendMessage:a,user:s}=this.props;a({tweetAttachment:void 0,senderId:s.id_str,conversationId:e,text:t,localMediaId:i}),this._handleRemove()}))}render(){const{isSent:e,onPress:t}=this.props,i=this._renderSending(),a=this._renderError(),s=this._renderTimestamp(),n=this._renderReadReceipt(),o=this._renderSentCheckmark(),c=this._renderReactions(),l=s||n||o,d=i||a||c||l,p=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled");return d&&r.a.createElement(ne.a,{style:[$i.root,p&&$i.vdlRootMargin,e&&$i.sentMessage]},i,a,c,l?r.a.createElement(G.a,{interactiveStyles:null,onPress:t,style:e&&$i.sentContainer},r.a.createElement(ne.a,{style:e&&$i.groupedItems},s,o),n):null)}_renderError(){const{isError:e}=this.props;return e&&r.a.createElement(ne.a,null,r.a.createElement(re.b,{align:"right",color:"gray700",size:"subtext2"},Vi),r.a.createElement(ne.a,{style:$i.groupedItems},r.a.createElement(re.b,{accessibilityRole:"button",color:"magenta500",onPress:this._handleRemove,size:"subtext2",withInteractiveStyling:!0},Hi),r.a.createElement(ji.a,null),r.a.createElement(re.b,{accessibilityRole:"button",color:"primary",onPress:this._handleTryAgain,size:"subtext2",withInteractiveStyling:!0},Wi)))}_renderReactions(){const{conversationId:e,entryId:t,isLastRapidFire:i,isRapidFire:a,isSent:s,withUserAvatar:n}=this.props,o=!a||i;return e?r.a.createElement(ne.a,{style:n&&$i.footerPadderWithAvatar},r.a.createElement(wi,{conversationId:e,entryId:t,isEndOfDM:o,isSent:s})):null}_renderReadReceipt(){const{entryId:e,isActive:t,isDraft:i,isError:a,isGroupDM:s,isSent:n,participants:o,user:c}=this.props;return t&&n&&!i&&!a?r.a.createElement(Pi,zt()({isGroupDM:s},Li({entryId:e,participants:o,user:c}))):null}_renderSending(){const{isDraft:e,isError:t}=this.props;return e&&!t&&r.a.createElement(re.b,{align:"right",color:"gray700",size:"subtext2"},Ui)}_renderSentCheckmark(){const{entryId:e,isDraft:t,isError:i,isLastRapidFire:a,isRapidFire:s,isSent:n,participants:o,user:c}=this.props,{isSeenByEveryone:l}=Li({entryId:e,participants:o,user:c});return!n||t||i||s&&!a?null:r.a.createElement(re.b,{color:l?"primary":"gray700",style:$i.checkmarkContainer},r.a.createElement(Bi.a,{style:$i.checkmark}))}_renderTimestamp(){const{entryTime:e,isDraft:t,isError:i,isGroupDM:a,isLastRapidFire:s,isRapidFire:n,isSent:o,user:{name:c},withUserAvatar:l}=this.props;if(t||i||n&&!s)return null;const d=new Date(Number(e));let p;p=Object(Ni.c)(d)?zi(d):Object(Ni.d)(d)?qi({time:zi(d)}):Object(Ni.e)(d)?Gi(d):Ki(d);const h=a&&!o,u=o?"right":"left";return r.a.createElement(ne.a,{style:[l&&$i.footerPadderWithAvatar,o&&$i.timestamp]},r.a.createElement(re.b,{align:u,color:"gray700",size:"subtext2",withInteractiveStyling:o||!lt.a.isEnabled},h&&r.a.createElement(De.a.I18NFormatMessage,{$i18n:"c8b914d4"},r.a.createElement(re.b,null,c)),h&&" ",p))}}s()(Qi,"contextType",U.a);const $i=z.a.create((e=>({root:{marginTop:e.spaces.space2,overflow:"hidden",width:Kt},vdlRootMargin:{marginTop:`calc(${e.spaces.space8} - ${e.spaces.space2})`},sentMessage:{alignSelf:"flex-end",justifyContent:"flex-end"},sentContainer:{flexDirection:"column"},groupedItems:{justifyContent:"flex-end",flexDirection:"row"},timestamp:{cursor:"pointer"},checkmark:{cursor:"pointer",flexShrink:0,height:"1rem",paddingLeft:e.spaces.space2},checkmarkContainer:{lineHeight:"1"},footerPadderWithAvatar:{marginLeft:`calc(${e.spaces.space40} + ${e.spaces.space12})`}})));var Yi=Gt(Qi),Ji=i("jtO7");const Xi=z.a.create((e=>({root:{borderColor:e.colors.gray50,borderStyle:"solid",borderWidth:e.borderWidths.small,borderBottomWidth:e.borderWidths.none,boxSizing:"border-box",overflow:"hidden"},isLast:{borderBottomWidth:e.borderWidths.small},insideTopRoundedSent:{borderTopLeftRadius:e.borderRadii.xLarge},insideTopRoundedReceived:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedSent:{borderTopRightRadius:e.borderRadii.xLarge},outsideTopRoundedReceived:{borderTopLeftRadius:e.borderRadii.xLarge},sentLast:{borderBottomLeftRadius:e.borderRadii.xLarge},receivedLast:{borderBottomRightRadius:e.borderRadii.xLarge}})));var Zi=({insideTopRounded:e,isLast:t,isSent:i,label:a,onClick:s,outsideTopRounded:n,tcoUrl:o})=>{const c=[Xi.root,t&&Xi.isLast,t&&i&&Xi.sentLast,t&&!i&&Xi.receivedLast,e&&i&&Xi.insideTopRoundedSent,e&&!i&&Xi.insideTopRoundedReceived,n&&i&&Xi.outsideTopRoundedSent,n&&!i&&Xi.outsideTopRoundedReceived];return r.a.createElement(ne.a,{style:c},r.a.createElement(Ji.a,{align:"center",color:"primary",label:a,link:o,onClick:s}))},ea=i("fs1G");class ta extends r.a.Component{componentDidMount(){this.props.onImpression()}render(){const{callToActions:e,isSent:t,onCtaClick:i,withSticker:a,withUserText:s}=this.props,n=e.map(((n,o)=>{const c=0===o;return r.a.createElement(Zi,{insideTopRounded:c&&(a||!s),isLast:o===e.length-1,isSent:t,key:o,label:n.label,onClick:i,outsideTopRounded:c&&a,tcoUrl:n.tco_url})}));return r.a.createElement(ne.a,null,n)}}s()(ta,"defaultProps",{onCtaClick:ea.a,onImpression:ea.a});var ia=ta,aa=i("vjRr"),sa=i("EGrD");const na=(e,t)=>aa.a.createManyHydratedSelector([t.cardUrl])(e)[0];var ra=Object(qt.a)().propsFromState((()=>({adFreeArticleDomains:sa.c,card:na}))).propsFromActions((()=>({createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("DM_CARD_MESSAGE"),fetchAdFreeToken:sa.a,loadAdFreeArticleDomainsFromPersistence:sa.b,popOutConversation:l.popOutConversation})));const oa=z.a.create((e=>({root:{width:"100%"},invisible:{opacity:0},visible:{opacity:1}})));var ca=({attachmentContent:e,attachmentHeader:t,isVisible:i=!0,textContent:a})=>r.a.createElement(ne.a,{style:[i?oa.visible:oa.invisible,oa.root]},t,e,a),la=i("cTG8");const da=({excludeCardUrl:e,isActive:t=!1,isFailedDraft:i,isFirstRapidFire:a=!1,isRapidFire:s=!1,isSent:n,hasAssociatedAttachment:o,messageData:c={},rootStyle:l,tweetId:d,withCta:p,withMediaLinks:h,withMessageBubble:u})=>{const{featureSwitches:m}=r.a.useContext(U.a),g=m.isTrue("dm_vdl_enabled")&&m.isTrue("dm_vdl_chat_p0_enabled"),b=[l,u&&pa.messageTextContainer,u&&n&&pa.sent,u&&!n&&pa.received,i&&pa.failedDraft,s&&!a&&!n&&pa.rapidFireReceived,s&&!a&&n&&pa.rapidFireSent,o&&n&&pa.hasAssociatedAttachmentSent,o&&!n&&pa.hasAssociatedAttachmentReceived,u&&g&&n&&pa.vdlSent,u&&t&&n&&pa.activeSent,u&&g&&t&&n&&pa.vdlActiveSent,u&&t&&!n&&!lt.a.isEnabled&&pa.activeReceived,p&&pa.withCta],_=[pa.tweetText,u&&pa.textAlignLeft,!u&&n&&pa.textAlignRight],{gray0:v,magenta500:f,primary:y,text:E,white:S}=z.a.theme.colors,R=V.a.generate({color:n?S:E,backgroundColor:i?f:n?y:v}),C=c.text&&c.text.length||0;return r.a.createElement(G.a,{accessibilityRole:"none",interactive:n,interactiveStyles:u?R:null,style:b},r.a.createElement(la.a,{color:z.a.isDarkMode()||n?"whiteOnColor":void 0,displayTextRange:[0,C],entities:c.entities,excludeCardUrl:e,linkColor:u&&n||z.a.isDarkMode()?"whiteOnColor":"link",linkify:!0,quotedTweetId:d,size:u?void 0:"title2",style:_,text:c.text||"",underlineLinks:!0,withMediaLinks:h}))},pa=z.a.create((e=>({tweetText:{overflow:"hidden",wordBreak:"break-word"},messageTextContainer:{borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16},textAlignLeft:{textAlign:"left"},textAlignRight:{textAlign:"right"},sent:{alignSelf:"flex-end",backgroundColor:e.colors.primary,borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},received:{alignSelf:"flex-start",backgroundColor:e.colors.dmReceivedBubbleBackground,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},vdlSent:{backgroundColor:e.colors.blue600},activeSent:{backgroundColor:e.colors.lightPrimary},activeReceived:{backgroundColor:e.colors.gray200},vdlActiveSent:{backgroundColor:e.colors.blue700},failedDraft:{backgroundColor:e.colors.magenta500},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},withCta:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},hasAssociatedAttachmentSent:{borderTopRightRadius:e.borderRadii.none},hasAssociatedAttachmentReceived:{borderTopLeftRadius:e.borderRadii.none}})));da.defaultProps={withMediaLinks:!1};var ha=da;var ua=({isActive:e=!1,isFailedDraft:t,isFirstRapidFire:i=!1,isRapidFire:a=!1,isSent:s,messageData:n,withCta:o,withMessageBubble:c})=>r.a.createElement(ha,{isActive:e,isFailedDraft:t,isFirstRapidFire:i,isRapidFire:a,isSent:s,messageData:n,withCta:o,withMediaLinks:!0,withMessageBubble:c}),ma=i("LSr9"),ga=i("aX4+"),ba=i("/Ikv");const{CardNames:_a}=ba.a;class va extends r.a.Component{constructor(...e){var t;super(...e),s()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),s()(this,"_hasClaimsForAdFreeArticles",null===(t=this.context.userClaims)||void 0===t?void 0:t.isTrueAndEnabled("subscriptions_feature_1006")),s()(this,"_handleAttachmentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}})),s()(this,"_handleOnClick",(e=>{const{card:{binding_values:t},conversationId:i,popOutConversation:a}=this.props;if(i&&a(i),this._hasClaimsForAdFreeArticles){const{adFreeArticleDomains:i,createLocalApiErrorHandler:a,fetchAdFreeToken:s}=this.props,[n,r]=new ma.a(s,a()).getAdFreeArticlesClickHandler({destinationUrl:ba.a.getBindingValue(t,"card_url"),linkDomain:ba.a.getBindingValue(t,"domain"),adFreeArticleDomains:i});n&&r(e)}})),s()(this,"_handleTextContentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}}))}componentDidMount(){this._hasClaimsForAdFreeArticles&&this.props.loadAdFreeArticleDomainsFromPersistence()}render(){const{card:e,hasUserText:t,isActive:i,isFailedDraft:a,isFirstRapidFire:s,isRapidFire:n,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:h}=this.state,u=!!Object.values(_a).includes(e.name),m=_t(t,p,h),g=m.isAttachmentSquared?"both":o?"right":"left",b=r.a.createElement(ne.a,{onClick:this._handleOnClick,onLayout:this._handleAttachmentLayout},r.a.createElement(ga.a,{card:{name:e.name,url:e.url,binding_values:e.binding_values,users:e.users},cardContext:{tweetUserId:c.sender_id},dmSentOrReceived:o?"sent":"received",withSquareBottomBorderRadius:g})),_=t?r.a.createElement(ne.a,{onLayout:this._handleTextContentLayout,style:o?fa.sentMessageWrapper:fa.receivedMessageWrapper},r.a.createElement(ha,{excludeCardUrl:e.url,hasAssociatedAttachment:!0,isActive:i,isFailedDraft:a,isFirstRapidFire:s,isRapidFire:n,isSent:o,messageData:c,rootStyle:m.isTextSquared?o?fa.textSentSquared:fa.textReceivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return u?r.a.createElement(ca,{attachmentContent:b,isVisible:m.compositeRendered,textContent:_}):r.a.createElement(ua,{isActive:i,isFailedDraft:a,isFirstRapidFire:s,isRapidFire:n,isSent:o,messageData:c,withCta:l,withMessageBubble:d})}}s()(va,"defaultProps",{hasUserText:!1}),s()(va,"contextType",U.a);const fa=z.a.create((e=>({attachmentReceivedSquared:{borderBottomRightRadius:e.borderRadii.none},attachmentSentSquared:{borderBottomLeftRadius:e.borderRadii.none},card:{marginBottom:e.spaces.space2},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none},textReceivedSquared:{borderTopRightRadius:e.borderRadii.none},textSentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var ya=ra(va);const Ea=De.a.f720438f;class Sa extends r.a.Component{constructor(...e){super(...e),s()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),s()(this,"_getSquareBottomStyles",(e=>{const{isSent:t}=this.props;let i="left";return e?i="both":t&&(i="right"),Ra[i]})),s()(this,"_handleAttachmentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;i!==t&&this.setState({attachmentWidth:t})})),s()(this,"_handleTextContentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;i!==t&&this.setState({textContentWidth:t})}))}render(){const{hasUserText:e,isActive:t,isFailedDraft:i,isFirstRapidFire:a,isRapidFire:s,isSent:n,messageData:o,withCta:c,withMessageBubble:l}=this.props,{attachmentWidth:d,textContentWidth:p}=this.state;if(!o||!o.attachment||!o.attachment.fleet)return null;const{compositeRendered:h,isAttachmentSquared:u,isTextSquared:m}=_t(e,d,p),g=[Ca.tombstoneWrapper,n?Ca.sentMessageWrapper:Ca.receivedMessageWrapper,this._getSquareBottomStyles(u)],b=r.a.createElement(ne.a,{onLayout:this._handleAttachmentLayout,style:g},r.a.createElement(re.b,{color:"gray700"},Ea)),_=e?r.a.createElement(ne.a,{onLayout:this._handleTextContentLayout,style:[n?Ca.sentMessageWrapper:Ca.receivedMessageWrapper,!l&&Ca.fleetReactionSpacing]},r.a.createElement(ha,{hasAssociatedAttachment:!0,isActive:t,isFailedDraft:i,isFirstRapidFire:a,isRapidFire:s,isSent:n,messageData:o,rootStyle:m?n?Ca.sentSquared:Ca.receivedSquared:void 0,withCta:c,withMessageBubble:l})):null;return r.a.createElement(ca,{attachmentContent:b,isVisible:h,textContent:_})}}const Ra=z.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),Ca=z.a.create((e=>({fleetReactionSpacing:{marginTop:e.spaces.space4},receivedMessageWrapper:{alignSelf:"flex-start"},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentMessageWrapper:{alignSelf:"flex-end"},sentSquared:{borderTopLeftRadius:e.borderRadii.none},tombstoneWrapper:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",flexDirection:"row",borderWidth:e.borderWidths.small,paddingHorizontal:e.spaces.space16,paddingVertical:e.spaces.space12,overflow:"auto"}})));var wa=Sa,xa=i("prG5"),Aa=i("RCZO"),Ta=i("A91F");const Ia=De.a.b327c129,Oa=e=>{e.stopPropagation()};var Ma=({media:e,mediaUrl:t})=>{const i=e.ext_alt_text||Ia,a=e.media_url_https,{height:s,width:n}=e.original_info||{},o=Object(Aa.b)(e).rgb,c=r.a.createElement(xa.a,{accessibilityLabel:i,aspectMode:Ta.a.withinRange(9/16,10),backgroundColor:o,image:{url:a,width:n,height:s},shouldShowAltLabel:!!e.ext_alt_text});return t?r.a.createElement(G.a,{interactiveStyles:null,link:t,onPress:Oa},c):c},ka=i("Modb"),Pa=i("lklz"),Da=i("XrEN"),La=i("ZvMt");var Fa=({media:e,messageId:t})=>{const i=e&&Da.a.extractVideoProps(Pa.b.forDm(t),e);return i?r.a.createElement(ka.a,zt()({},i,{aspectRatio:La.a.getAspectRatio(e.video_info),withPostPlayback:!0})):null},Ba=Object(qt.a)().withAnalytics();class ja extends r.a.PureComponent{constructor(e,t){super(e,t),s()(this,"_handleLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e;this.state.width!==t&&this.setState({width:t})})),s()(this,"_getElement",(()=>{const{contentType:e,isSensitive:t}=this.props;return`${t?"sensitive":"untrusted"}_${e}_interstitial`})),s()(this,"_handleClick",(()=>{const{analytics:e}=this.props;this.setState({hide:!1}),e.scribe({element:this._getElement(),action:"reveal"})})),this.state={hide:!0,width:0}}componentDidMount(){const{analytics:e}=this.props;e.scribe({element:this._getElement(),action:"impression"})}render(){const{children:e,ctaText:t,description:i,withSquareBottomBorderRadius:a}=this.props,{hide:s,width:n}=this.state,o=n<z.a.theme.breakpoints.micro;return s?r.a.createElement(ne.a,{focusable:!0,onLayout:this._handleLayout,style:[Ua.root,o?{flexDirection:"column"}:{flexDirection:"row",alignItems:"center"},a&&Na[a]]},r.a.createElement(ne.a,{style:Ua.description},r.a.createElement(re.b,null,i)),r.a.createElement(ne.a,{style:[Ua.button,o?Ua.breakButtonWrapper:void 0]},r.a.createElement(ct.a,{onClick:this._handleClick,size:"small",style:Ua.buttonElement,type:"brandText"},t))):e}}s()(ja,"defaultProps",{isSensitive:!1});const Na=z.a.create((e=>({both:{borderBottomRightRadius:e.borderRadii.none,borderBottomLeftRadius:e.borderRadii.none},left:{borderBottomLeftRadius:e.borderRadii.none},right:{borderBottomRightRadius:e.borderRadii.none}}))),Ua=z.a.create((e=>({breakButtonWrapper:{marginTop:z.a.theme.spaces.space4,marginLeft:`calc(-1 * ${e.spaces.space12})`},button:{flexGrow:1,alignItems:"flex-start"},buttonElement:{paddingHorizontal:e.spaces.space12},description:{flexGrow:1,flexShrink:1},root:{backgroundColor:e.colors.gray0,borderColor:e.colors.gray50,borderRadius:e.borderRadii.xLarge,boxSizing:"border-box",borderWidth:e.borderWidths.small,maxWidth:"100%",paddingLeft:e.spaces.space16,paddingTop:e.spaces.space16,paddingBottom:e.spaces.space16,paddingRight:e.spaces.space4,overflow:"auto",display:"flex"}})));var Ha=Object($e.a)(Ba(ja)),Wa=i("CoGJ");const Va=r.a.createElement(Wa.a,null),za=De.a.d9de7b57,qa=De.a.f2879f4d,Ga=De.a.b518221e,Ka=De.a.eeaa9f90,Qa=De.a.g2b43663,$a=De.a.f277e949;class Ya extends r.a.Component{constructor(...e){super(...e),s()(this,"state",{attachmentWidth:void 0,textContentWidth:void 0}),s()(this,"_renderAttachment",(()=>{const{entry:e,hasUserText:t,isFirstRapidFire:i,isRapidFire:a,isSent:s,isTrusted:n,messageData:o}=this.props,{attachmentWidth:c,textContentWidth:l}=this.state,{attachment:d}=o||{},p=e.is_draft,h=_t(t,c,l),u=[Ja.mediaAttachment,s&&Ja.isSent,!s&&Ja.received,s&&h.isAttachmentSquared&&Ja.equalComponentDimensionsSent,!s&&h.isAttachmentSquared&&Ja.equalComponentDimensionsReceived,a&&!i&&s&&Ja.rapidFireSent,a&&!i&&!s&&Ja.rapidFireReceived];let m,g,b=null;if(!p&&e.conversation_id&&(b=`/messages/${e.conversation_id}/media/${e.id}`),d)if(d.photo)m=d.photo,g=r.a.createElement(Ma,{media:m,mediaUrl:b});else if(d.animated_gif)m=d.animated_gif,g=r.a.createElement(Fa,{media:m,messageId:e.id});else if(d.video){if(m=d.video,Object(y.k)(d,this.context.featureSwitches))throw new Error("DMMediaMessage should not be used to render voice messages");g=r.a.createElement(Fa,{media:m,messageId:e.id})}const _=h.isAttachmentSquared?"both":s?"right":"left",v=m&&g&&(s?g:this._getMediaContentWithGuard(m,n,g,_));return{attachmentContent:r.a.createElement(ne.a,{onLayout:this._handleAttachmentLayout,style:u},v),media:m}})),s()(this,"_handleAttachmentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{attachmentWidth:i}=this.state;if(i!==t){const e={attachmentWidth:t};this.setState(e)}})),s()(this,"_handleTextContentLayout",(e=>{const{nativeEvent:{layout:{width:t}}}=e,{textContentWidth:i}=this.state;if(i!==t){const e={textContentWidth:t};this.setState(e)}}))}render(){const{entry:e,hasUserText:t,isActive:i,isFailedDraft:a,isFirstRapidFire:s,isRapidFire:n,isSent:o,messageData:c,withCta:l,withMessageBubble:d}=this.props,{attachmentWidth:p,textContentWidth:h}=this.state,u=e.is_draft,m=_t(t,p,h),{attachmentContent:g,media:b}=this._renderAttachment(),_=t?r.a.createElement(ne.a,{onLayout:this._handleTextContentLayout,style:o?Ja.sentMessageWrapper:Ja.receivedMessageWrapper},r.a.createElement(ha,{hasAssociatedAttachment:!0,isActive:!!i,isFailedDraft:a,isFirstRapidFire:!!s,isRapidFire:!!n,isSent:o,messageData:u?c:this._parseMessageData(c,b),rootStyle:m.isTextSquared?o?Ja.sentSquared:Ja.receivedSquared:void 0,withCta:l,withMessageBubble:d})):null;return r.a.createElement(ca,{attachmentContent:g,isVisible:m.compositeRendered,textContent:_})}_getMediaContentWithGuard(e,t,i,a){const{displaySensitiveMedia:s,isDmNsfwMediaFilterEnabled:n}=this.props;if(e.possibly_sensitive&&this.context.featureSwitches.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(n){const t="animated_gif"===e.type&&Qa||"video"===e.type&&Ka||Ga;return r.a.createElement(Ha,{contentType:e.type,ctaText:t,description:qa,isSensitive:!0,withSquareBottomBorderRadius:a},i)}}else if(!s&&e.possibly_sensitive)return r.a.createElement(Ha,{contentType:e.type,ctaText:$a,description:Va,isSensitive:!0,withSquareBottomBorderRadius:a},i);return t?i:r.a.createElement(Ha,{contentType:e.type,ctaText:$a,description:za,withSquareBottomBorderRadius:a},i)}_parseMessageData(e,t){var i;const a=null!=e&&null!==(i=e.entities)&&void 0!==i&&i.urls&&t?e.entities.urls.filter((e=>e.display_url!==t.display_url)):null;return e&&a?{...e,entities:{...e.entities,urls:a,media:t?[t]:[]}}:void 0}}s()(Ya,"contextType",U.a),s()(Ya,"defaultProps",{hasUserText:!1});const Ja=z.a.create((e=>({equalComponentDimensionsSent:{borderBottomLeftRadius:e.borderRadii.none},equalComponentDimensionsReceived:{borderBottomRightRadius:e.borderRadii.none},invisible:{opacity:0},isSent:{borderBottomRightRadius:e.borderRadii.none},mediaAttachment:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},rapidFireReceived:{borderTopLeftRadius:e.borderRadii.none},rapidFireSent:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none},visible:{opacity:1}})));var Xa=Ya,Za=Object(qt.a)().propsFromActions((()=>({markSpamStatus:l.markSpamStatus})));const es=De.a.fd07947f,ts=De.a.c7a92dc9,is=De.a.f277e949,as=De.a.fb3ccb55;class ss extends r.a.PureComponent{constructor(...e){super(...e),s()(this,"_handlePress",(e=>()=>{const{conversationId:t,dmId:i,markSpamStatus:a}=this.props;a({conversationId:t,dmId:i,markSpam:e})}))}render(){const{children:e}=this.props;return r.a.createElement(Ha,{contentType:"dm",ctaText:is,description:as},e,this._renderButtons())}_renderButtons(){return r.a.createElement(ne.a,{style:rs.buttons},r.a.createElement(ct.a,{onPress:this._handlePress(!1),style:rs.leftButton,type:"brandOutlined"},ts),r.a.createElement(ct.a,{onPress:this._handlePress(!0),type:"brandOutlined"},es))}}var ns=Za(ss);const rs=z.a.create((e=>({buttons:{flexDirection:"row",paddingTop:e.spaces.space4},leftButton:{marginRight:e.spaces.space12}})));var os=i("U+bB");const cs=e=>{const t=e.images,i=t.svg||t.size_1x;if(i)return i.url},ls=z.a.create((e=>({stickerItem:{height:`calc(3 * ${e.fontSizes.title2})`,width:`calc(3 * ${e.fontSizes.title2})`}})));var ds=({sticker:e})=>r.a.createElement(os.a,{accessibilityLabel:e.display_name,source:cs(e),style:ls.stickerItem}),ps=i("XOJV");const hs=(e,t)=>{var i;const a=null===(i=t.messageData)||void 0===i?void 0:i.attachment;if(a&&a.tweet)return a.tweet.status};var us=Object(qt.a)().propsFromState((()=>({tweet:ps.a.createHydratedTweetSelector(hs)}))).propsFromActions((()=>({popOutConversation:l.popOutConversation}))),ms=i("b5s6");const gs=r.a.createElement(re.b,{link:"/settings/safety"});var bs=e=>r.a.createElement(De.a.I18NFormatMessage,{$i18n:"j3c7dd33"},r.a.cloneElement(gs,null,De.a.adcf07b5));const _s=De.a.e4df0ad7,vs=De.a.f277e949,fs=De.a.b5b91d58,ys=De.a.bb594d7b,Es=r.a.createElement(bs,null);const Ss=z.a.create((e=>({attachment:{marginBottom:0},receivedMessageWrapper:{alignSelf:"flex-start"},sentMessageWrapper:{alignSelf:"flex-end"},received:{borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200},receivedAttachmentSquared:{borderBottomRightRadius:e.borderRadii.none},receivedSquared:{borderTopRightRadius:e.borderRadii.none},sent:{borderBottomRightRadius:e.borderRadii.none,borderColor:e.colors.primary},sentAttachmentSquared:{borderBottomLeftRadius:e.borderRadii.none},sentSquared:{borderTopLeftRadius:e.borderRadii.none}})));var Rs=us((function(e){const{featureSwitches:t}=r.a.useContext(U.a),{conversationId:i,displaySensitiveMedia:a,hasUserText:s=!1,isActive:n=!1,isDmNsfwMediaFilterEnabled:o,isFailedDraft:c,isFirstRapidFire:l=!1,isRapidFire:d=!1,isSent:p,isTrusted:h,messageData:u,popOutConversation:m,tweet:g,withCta:b,withMessageBubble:_}=e,[v,f]=r.a.useState(void 0),[y,E]=r.a.useState(void 0),S=r.a.useMemo((()=>function(){i&&m(i)}),[i,m]),R=r.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;v!==t&&f(t)}),[v]),C=r.a.useMemo((()=>function(e){const{nativeEvent:{layout:{width:t}}}=e;y!==t&&E(t)}),[y]);if(!u||!u.attachment||!u.attachment.tweet)return null;const w=u.attachment.tweet,x=p?"sent":"received",A=_t(s,v,y),T=r.a.createElement(ms.a,{onPress:S,style:[Ss[x],s&&Ss.attachment,A.isAttachmentSquared?p?Ss.sentAttachmentSquared:Ss.receivedAttachmentSquared:void 0],tweetId:w.status}),I=A.isAttachmentSquared?"both":p?"right":"left",O=(()=>{if(!g)return null;if(p)return T;if(g.possibly_sensitive&&t.isTrue("dm_conversations_nsfw_media_filter_enabled")){if(o||void 0===o)return r.a.createElement(Ha,{contentType:"photo",ctaText:ys,description:fs,withSquareBottomBorderRadius:I},T)}else if(!a&&g.possibly_sensitive)return r.a.createElement(Ha,{contentType:"photo",ctaText:vs,description:Es,withSquareBottomBorderRadius:I},T);return h?T:r.a.createElement(Ha,{contentType:"tweet",ctaText:vs,description:_s,withSquareBottomBorderRadius:I},T)})(),M=r.a.createElement(ne.a,{onLayout:R,style:Ss.attachment},O),k=s?r.a.createElement(ne.a,{onLayout:C,style:p?Ss.sentMessageWrapper:Ss.receivedMessageWrapper},r.a.createElement(ha,{hasAssociatedAttachment:!0,isActive:n,isFailedDraft:c,isFirstRapidFire:l,isRapidFire:d,isSent:p,messageData:u,rootStyle:A.isTextSquared?p?Ss.sentSquared:Ss.receivedSquared:void 0,tweetId:w.status,withCta:b,withMediaLinks:!0,withMessageBubble:_})):null;return r.a.createElement(ca,{attachmentContent:M,isVisible:A.compositeRendered,textContent:k})})),Cs=i("8W85");function ws(){const e=r.a.useContext(Ls),[t,i]=e.activeVoiceMessage,[,a]=e.playerApi,[,s]=e.playerState,[,n]=t;const o={media:n,onEnded:function(){i([null,null]),e.scribeAction&&e.scribeAction.complete()},onPlayerApi:a,onPlayerState:s};return r.a.createElement(Cs.a,o)}var xs=i("89tF"),As=i("k89r");function Ts(e){const t=function(){const e=r.a.useState(Ms.activeVoiceMessage),t=r.a.useState(Ms.playerApi),i=r.a.useState(Ms.playerState),a=function(){const e=Object(As.a)();return r.a.useMemo((()=>{const t={page:"messages",section:"thread",component:"message",element:"voice"};function i({action:e,component:i=t.component}){const{element:a,page:s,section:n}=t;return{page:s,section:n,component:i,element:a,action:e}}const a=(t,a)=>a?a.data?e.scribe({...i({action:t}),data:a.data}):e.scribe({...i({action:t,component:Os(a)})}):e.scribe({...i({action:t})});return{impression:e=>a("impression",e),report:e=>a("report",e),play:e=>a("play",e),pause:()=>a("pause"),complete:()=>a("complete")}}),[e])}();return{activeVoiceMessage:e,playerApi:t,playerState:i,scribeAction:a}}();return r.a.createElement(ks.Provider,{value:t},e.children)}const Is={Timelines:Object(xs.a)({message:!0,inbox_timeline:!0,low_quality_timeline:!0,requests_timeline:!0})};function Os({isLowQuality:e,isTrusted:t}){return t?Is.Timelines.inbox_timeline:e?Is.Timelines.low_quality_timeline:Is.Timelines.requests_timeline}const Ms={activeVoiceMessage:[null,null],playerApi:null,playerState:null,scribeAction:null},ks=r.a.createContext({activeVoiceMessage:[Ms.activeVoiceMessage,Ps],playerApi:[Ms.playerApi,Ps],playerState:[Ms.playerState,Ps],scribeAction:null});function Ps(){throw new Error("DMVoiceContext is not initialized")}function Ds(e){const{featureSwitches:t}=r.a.useContext(U.a);return Object(y.j)(t)?r.a.createElement(Ts,null,e.children,r.a.createElement(ws,null)):e.children}const Ls=ks;var Fs=i("MH+I"),Bs=i("5Ixf"),js=i("AtEG");function Ns(e){var t,i;const a=r.a.useContext(Ls),{isLowQuality:s,isSent:n,isTrusted:o}=e;if(null===(t=e.media)||void 0===t||!t.video_info)return null;const[c,l]=a.activeVoiceMessage,[d]=a.playerApi,[p]=a.playerState,{scribeAction:h}=a,[u]=c,m=e.messageId===u;if(!h)return null;const g=Hs(p),b=(null===(i=e.media)||void 0===i?void 0:i.video_info.duration_millis)||0,_={durationMs:b,isActive:m,isSent:n,playerApi:null,playerState:null,onImpression:()=>h.impression({isLowQuality:s,isTrusted:o}),onPlayRequest:()=>l([e.messageId,e.media]),onPlay:()=>h.play({data:{duration_ms:b}}),onPause:()=>h.pause()};return m&&g&&g.contentId===e.media.id_str&&(_.playerApi=d,_.playerState=p,null!=g&&g.durationMs&&(_.durationMs=null==g?void 0:g.durationMs)),r.a.createElement(Us,_)}function Us(e){const{isActive:t,isSent:i,playerApi:a,playerState:s}=e,n=null==s?void 0:s.isPlaying,o=Hs(s),c=(null==o?void 0:o.currentTimeMs)||0,l=(null==o?void 0:o.durationMs)||e.durationMs,d=Math.max(t?l-c:l,0);r.a.useLayoutEffect((()=>{e.onImpression()}),[]),r.a.useEffect((()=>{a&&0===c&&(a.play(),e.onPlay())}),[a]);const p=z.a.isDarkMode()||i,h={color:p?"whiteOnColor":"normal"},u=[zs.voiceMessage,qs({isSent:i,squared:t}),i?zs.voiceMessageSent:zs.voiceMessageReceived,ve(z.a.theme.scale).voiceMessage({isVoiceMessageActive:t,isSent:i})],m=n?Bs.a:js.a;return r.a.createElement(ne.a,{style:[zs.container,ve(z.a.theme.scale).voiceMessageContainer({isVoiceMessageActive:t,isSent:i})]},r.a.createElement(ne.a,{style:u},r.a.createElement(ne.a,{style:zs.startSpacer}),r.a.createElement(ct.a,{accessibilityLabel:n?Vs:Ws,icon:r.a.createElement(m,{style:p?zs.iconColorDark:zs.iconColorDefault}),onPress:()=>{a?n?(a.pause(),e.onPause()):(a.play(),e.onPlay()):e.onPlayRequest()},type:"onMediaText"}),r.a.createElement(ne.a,{style:zs.durationSpacer}),r.a.createElement(ne.a,{style:i?zs.durationOpacity:void 0},r.a.createElement(Fs.a,zt()({countdown:!0,timeMs:d},h,{color:"gray700",size:"subtext2",style:i?zs.durationDark:void 0,weight:"bold",withCountdownSymbol:t}))),r.a.createElement(ne.a,{style:zs.endSpacer})))}const Hs=e=>e?e.tracks[e.currentTrackId]:null,Ws=De.a.c94b7d89,Vs=De.a.eb6f9582,zs=z.a.create((e=>({displayNone:{display:"none"},container:{flexDirection:"row",alignSelf:"flex-end",alignItems:"center",justifyContent:"center"},voiceMessage:{alignSelf:"flex-end",flexDirection:be.a.getConstants().isRTL?"row-reverse":"row",alignItems:"center",justifyContent:"center"},voiceMessageSent:{backgroundColor:e.colors.primary},voiceMessageReceived:{backgroundColor:e.colors.dmReceivedBubbleBackground},durationSpacer:{width:e.spaces.space4},durationOpacity:{opacity:.75},durationDark:{color:e.colors.whiteOnColor},iconColorDark:{color:e.colors.whiteOnColor},iconColorDefault:{color:e.colors.gray1100},startSpacer:{width:e.spaces.space4},endSpacer:{width:e.spaces.space16}})));function qs({isSent:e,squared:t}){return[Gs.base,e?Gs.sent:Gs.received,t?e?Gs.sentSquared:Gs.receivedSquared:void 0]}const Gs=z.a.create((e=>({base:{borderRadius:e.borderRadii.xLarge,WebkitMaskImage:"url(data:image/png;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICRAEAOw==)"},sent:{borderBottomRightRadius:e.borderRadii.none},sentSquared:{borderTopRightRadius:e.borderRadii.none},received:{borderBottomLeftRadius:e.borderRadii.none},receivedSquared:{borderTopLeftRadius:e.borderRadii.none}})));class Ks extends r.a.Component{render(){const{entry:e,isSent:t,onCtaClick:i,onCtaImpression:a}=this.props,{message_data:s}=e,n=s&&s.attachment?s.attachment:{},o=e.marked_as_spam,c=gt(e),l=!!s&&!!s.ctas,d=mt(e),p=(e=>{const{message_data:t}=e;if(!t)return!1;if(gt(e)&&!bt(e))return!1;if(!t.text)return!1;const i=Object(ht.parse)(t.text);if(!i||0===i.length)return!1;const a=i.sort(((e,t)=>t.indices[1]-e.indices[1])).reduce(((e,t)=>`${e.slice(0,t.indices[0])}${e.slice(t.indices[1])}`),t.text).trim();return i.length<=10&&0===a.length})(e),h=!(d&&p),u=bt(e);let m;m=n.sticker?r.a.createElement(ds,{sticker:n.sticker}):this._renderDMMessage(d,l,h);const g=o?r.a.createElement(ns,{conversationId:e.conversation_id,dmId:e.id},m):m,b=c&&!u&&!Object(y.k)(null==s?void 0:s.attachment,this.context.featureSwitches),_=[t?Qs.isSent:Qs.isReceived,l&&Qs.withCta,b?Qs.mediaRoot:Qs.flexShrink,this.props.style];return r.a.createElement(ne.a,{style:_},g,s&&s.ctas?r.a.createElement(ia,{callToActions:s.ctas,isSent:t,onCtaClick:i,onImpression:a,withSticker:!!n.sticker||p,withUserText:d}):null)}_renderDMMessage(e,t,i){const{displaySensitiveMedia:a,entry:s,isActive:n,isDmNsfwMediaFilterEnabled:o,isFirstRapidFire:c,isLowQuality:l,isRapidFire:d,isSent:p,isTrusted:h}=this.props,{error:u,message_data:m}=s,g=m&&{...m,entities:m&&m.entities||void 0,error:u},b=null==g?void 0:g.attachment,_={isActive:n,isFailedDraft:!!u,isFirstRapidFire:c,isRapidFire:d,isSent:p,withCta:t,withMessageBubble:i};if(g&&b){if(b.tweet)return r.a.createElement(Rs,zt()({conversationId:s.conversation_id,displaySensitiveMedia:a,hasUserText:e,isDmNsfwMediaFilterEnabled:o,isTrusted:h,messageData:g},_));if(b.photo||b.animated_gif||b.video)return b.video&&Object(y.k)(b,this.context.featureSwitches)?r.a.createElement(Ns,{isLowQuality:l,isSent:!!p,isTrusted:h,media:b.video,messageId:s.id}):r.a.createElement(Xa,zt()({displaySensitiveMedia:a,entry:s,hasUserText:e,isDmNsfwMediaFilterEnabled:o,isTrusted:h,messageData:g},_));if(b.card)return r.a.createElement(ya,zt()({cardUrl:b.card,conversationId:s.conversation_id,hasUserText:e,messageData:g},_));if(b.fleet)return r.a.createElement(wa,zt()({entry:s,hasUserText:e,messageData:g},_))}return r.a.createElement(ua,zt()({},_,{messageData:g}))}}s()(Ks,"contextType",U.a);const Qs=z.a.create((e=>({flexShrink:{flexShrink:1},mediaRoot:{flex:1},isSent:{alignItems:"flex-end"},isReceived:{alignItems:"flex-start"},withCta:{alignItems:"stretch"}})));var $s=Ks;const Ys=z.a.create((e=>({avatar:{borderRadius:e.borderRadii.infinite}})));var Js=({showAvatar:e,size:t="xLarge",user:i})=>e?r.a.createElement(oe.a,{accessibilityLabel:i.name,link:{pathname:`/${i.screen_name}`},size:t,uri:i.profile_image_url_https}):r.a.createElement(ne.a,{style:[Ys.avatar,oe.a.getSizeStyle(t)]}),Xs=i("B3eJ");function Zs({color:e,isActive:t,size:i,...a}){const s=r.a.useContext(Ls),[n,o]=r.a.useState(.5),[c]=s.playerState;r.a.useEffect((()=>{t&&c&&c.isPlaying&&o(Math.random())}),[t,c]);const l=t&&(null==c?void 0:c.isPlaying),d=i+2*en,p=[tn.container,a.style,{width:i,height:i}];return r.a.createElement(ne.a,{style:p},r.a.createElement(ne.a,{style:[tn.container,tn.transitionOpacity,l?tn.show:tn.hide]},_e.a.reducedMotionEnabled?null:r.a.createElement(Xs.a,{audioLevel:n,color:e,paused:!l,size:i})),r.a.createElement(ne.a,{style:[tn.border,{width:d,height:d},tn.transitionOpacity,t?tn.show:tn.hide]}))}const en=parseInt(z.a.theme.spaces.space2,10),tn=z.a.create((e=>({container:{alignItems:"center",justifyContent:"center",pointerEvents:"none"},border:{position:"absolute",top:-1*en,left:-1*en,backgroundColor:e.colors.navigationBackground,borderRadius:e.borderRadii.infinite},transitionOpacity:{transition:"opacity 0.2s 0s ease-in-out"},hide:{opacity:0},show:{opacity:1}})));var an=i("uArA"),sn="messageEntry";const nn={element:"cta_dm"},rn={isGroupDM:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1};class on extends r.a.Component{constructor(...e){super(...e),s()(this,"_handleClick",Object(an.a)((()=>{const{entry:{error:e,id:t,is_draft:i},isActive:a,setActiveEntry:s}=this.props;i||e||(s(a?null:t),this._handleScribeMessageEntryClick())}))),s()(this,"_handleScribeMessageEntryClick",(()=>{const{isActive:e}=this.props;if(!lt.a.isEnabled&&!e){const{entry:e}=this.props,t={component:"message",element:Object(y.c)(e),action:"click"};this._scribeAction(t)}})),s()(this,"_handleCtaImpression",(()=>{this._scribeAction({...nn,action:"show"})})),s()(this,"_handleCtaClick",(()=>{this._scribeAction({...nn,action:"click"})})),s()(this,"_isDMVoiceMessage",(()=>{var e;return Object(y.k)(null===(e=this.props.entry.message_data)||void 0===e?void 0:e.attachment,this.context.featureSwitches)}))}shouldComponentUpdate(e){return!Object(se.a)(this.props,e)}render(){const{isActive:e,isGroupDM:t,isSent:i,user:a}=this.props,s=this._getRapidFireProps(),n=!s.isRapidFire||s.isLastRapidFire,o=this.context.featureSwitches.isTrue("dm_vdl_enabled")&&this.context.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),c=[ln.root.base,o&&ln.root.vdlPadding,n&&ln.root.contentSpacing,n&&o&&ln.root.vdlContentSpacing],l=this._isDMVoiceMessage(),d=o?t&&!i:!i||l;if(!a)return null;const p=!lt.a.isEnabled||i;return r.a.createElement(we.a,{viewType:"message"},r.a.createElement(ne.a,{style:c},r.a.createElement(G.a,{accessibilityExpanded:!(!p||!e),focusable:!0,interactiveStyles:null,onPress:p?this._handleClick:void 0,style:i?ln.root.sent:ln.root.received,testID:sn},(({isFocused:e,isHovered:t})=>this._renderMessage({isFocused:e,isHovered:t,rapidFireProps:s,withVDLRefresh:o,withUserAvatar:d}))),this._renderFooter(s,d)))}_renderMessage({isFocused:e,isHovered:t,rapidFireProps:i,withUserAvatar:a,withVDLRefresh:s}){var n;const{displaySensitiveMedia:o,entry:c,inboxType:l,isActive:d,isDmNsfwMediaFilterEnabled:p,isGroupDM:h,isLowQuality:u,isReadOnly:m,isSent:g,isTrusted:b,isVoiceMessageActive:_,isWide:v,participants:f,perspective:y,scribeVoiceMessage:E,setShouldFreezeUpdates:S}=this.props,{isFirstRapidFire:R,isRapidFire:C}=i,w=[g?ln.messageContainer.sent:ln.messageContainer.received,v?ln.messageContainer.wide:ln.messageContainer.narrow,g&&v&&ln.messageContainer.sentWide,!g&&v&&ln.messageContainer.receivedWide],x=b&&!m,A=this._isDMVoiceMessage(),T=null===(n=Object.keys(f))||void 0===n?void 0:n.length;return r.a.createElement(ne.a,{style:w},c.error?null:r.a.createElement(Ut,{containerIsActive:d,containerIsFocused:e,containerIsHovered:t,entry:c,inboxType:l,isDraft:!!c.is_draft,isGroupDM:h,isSent:g,onReportMessage:A&&E?()=>E.report({isLowQuality:u,isTrusted:b}):void 0,participantsCount:T,perspective:y,setShouldFreezeUpdates:S,shouldShowReactionButton:x,style:A&&ve(z.a.theme.scale).actionsContainer({isSent:g,isVoiceMessageActive:_}),withVDLRefresh:s}),r.a.createElement($s,{displaySensitiveMedia:o,entry:c,isActive:d,isDmNsfwMediaFilterEnabled:p,isFirstRapidFire:R,isLowQuality:u,isRapidFire:C,isSent:g,isTrusted:b,key:c.id,onCtaClick:this._handleClick,onCtaImpression:this._handleCtaImpression,style:A&&ve(z.a.theme.scale).messageContainer({isSent:g,isVoiceMessageActive:_})}),this._possiblyRenderUserAvatar(i,a))}_renderFooter({isLastRapidFire:e,isRapidFire:t},i){var a,s;const{entry:n,isActive:o,isGroupDM:c,isSent:l,participants:d,user:p}=this.props;return p?r.a.createElement(Yi,{conversationId:n.conversation_id,entryId:n.id,entryText:null===(a=n.message_data)||void 0===a?void 0:a.text,entryTime:n.time,isActive:o,isDraft:!!n.is_draft,isError:!!n.error,isGroupDM:c,isLastRapidFire:e,isRapidFire:t,isSent:l,localMediaId:null===(s=n.message_data)||void 0===s?void 0:s.localMediaId,onPress:this._handleClick,participants:d,user:p,withUserAvatar:i}):null}_possiblyRenderUserAvatar({isLastRapidFire:e,isRapidFire:t},i){const{isSent:a,isVoiceMessageActive:s,user:n}=this.props,o=this._isDMVoiceMessage();if(!n||!i&&!s)return null;const{DMUserAvatarSizePx:c,DMUserAvatarSizeType:l}=ge(z.a.theme.scale),d={showAvatar:!!o||(!t||!!e),size:l,user:n},p=[ln.userAvatar.base,a?ln.userAvatar.sent:ln.userAvatar.received,o&&ve(z.a.theme.scale).userAvatar({isVoiceMessageActive:s,isSent:a})];return r.a.createElement(ne.a,{style:ln.userAvatar.container},a?null:r.a.createElement(ne.a,{style:ln.userAvatar.spacer}),o?r.a.createElement(Zs,{color:a?z.a.theme.colors.primary:z.a.theme.colors.text,isActive:!!s,size:c,style:p}):null,r.a.createElement(ne.a,{style:p},r.a.createElement(Js,d)))}_scribeAction(e){const{analytics:t}=this.props;t.scribe({...e})}_getRapidFireProps(){return{isFirstRapidFire:this.props.isFirstRapidFire,isLastRapidFire:this.props.isLastRapidFire,isRapidFire:this.props.isRapidFire}}}s()(on,"contextType",U.a),s()(on,"defaultProps",rn);var cn=Object($e.a)(Te(function(e){function t(t){const{entry:i}=t,a=r.a.useContext(Ls),[s]=a.activeVoiceMessage,{scribeAction:n}=a,[o]=s,c=o===i.id,l={...t,isVoiceMessageActive:c,scribeVoiceMessage:n};return r.a.createElement(e,l)}return t.defaultProps=rn,t}(on)));const ln={root:z.a.create((e=>({base:{flexDirection:"column",paddingBottom:e.spaces.space2},vdlPadding:{paddingBottom:"0px"},received:{cursor:"default",alignItems:"flex-start"},sent:{cursor:"pointer",alignItems:"flex-end"},contentSpacing:{paddingBottom:e.spaces.space20},vdlContentSpacing:{paddingBottom:e.spaces.space24}}))),messageContainer:z.a.create((e=>({sent:{flexDirection:"row",justifyContent:"flex-end"},received:{flexDirection:"row-reverse",justifyContent:"flex-end"},narrow:{width:"100%"},wide:{width:Kt},receivedWide:{paddingRight:e.spaces.space12},sentWide:{paddingLeft:e.spaces.space12}}))),userAvatar:z.a.create((e=>({container:{flexDirection:"row",alignItems:"flex-end"},base:{position:"absolute"},sent:{right:0},received:{left:0},spacer:{width:ge(e.scale).DMUserAvatarSpacerPx}})))};var dn=i("H4nC");const pn=e=>{const{conversation:t,entry:i,inboxType:a,isActive:s,isFirstRapidFire:n,isLastRapidFire:o,isRapidFire:c,isWide:d,perspective:p,scribeNamespace:h,setActiveEntry:u,setShouldFreezeUpdates:m}=e;if(Object(B.b)(i)||Object(B.e)(i)){const{conversation_id:e,low_quality:g,participants:b,read_only:_,trusted:v,type:f}=t,{message_data:{sender_id:y}={}}=i,E=void 0===e||v;return r.a.createElement(cn,{entry:i,inboxType:a,isActive:s,isFirstRapidFire:n,isGroupDM:f===l.CONVERSATION_TYPE.GROUP,isLastRapidFire:o,isLowQuality:!!g,isRapidFire:c,isReadOnly:_,isSent:y===p,isTrusted:!!E,isWide:d,participants:b,perspective:p,scribeNamespace:h,senderId:y,setActiveEntry:u,setShouldFreezeUpdates:m})}return Object(B.a)(i)?r.a.createElement(ue,{conversation:t,entry:i,entryType:i.type,perspective:p}):Object(B.d)(i)?r.a.createElement(dn.a,{entry:i,isCompact:!1}):null},hn=Object(u.createSelector)(((e,t)=>{const i=Object(Ne.o)(e,t.conversationId),a=i&&Object(N.a)(i);return a&&Object(l.selectEntry)(e,a)}),(e=>({lastEntry:e})));var un=Object(f.c)(hn),mn=i("uDfI");const gn=Object(u.createSelector)(((e,t)=>v.e.selectMany(e,t.userIds||[])),(e=>({users:e})));var bn=Object(mn.b)(gn),_n=i("Enqy"),vn=i("+/1j");const fn="overflow",yn=(e,t)=>e.id_str<t.id_str?-1:e.id_str>t.id_str?1:0,En={stiffness:1e3,damping:70},Sn=140,Rn={scale:Object(_n.spring)(1,En),translateY:Object(_n.spring)(0,En)},Cn=(e,t)=>({key:e.id_str,data:e,style:Rn}),wn=Object(k.a)({translateY:Sn,scale:0}),xn=Object(k.a)({scale:Object(_n.spring)(1,En),translateY:Object(_n.spring)(Sn,En)}),An=[{key:"bubble",style:{scale:Object(_n.spring)(1,En),translateY:Object(_n.spring)(0,En)}}],Tn=Object(k.a)({translateY:Sn,scale:0}),In=Object(k.a)({scale:Object(_n.spring)(1,En),translateY:Object(_n.spring)(Sn,En)}),On=e=>[isFinite(e.scale)&&{scale:e.scale.toFixed(3)},isFinite(e.translateY)&&{translateY:`${Math.round(e.translateY)}%`}].filter(Boolean);class Mn extends r.a.Component{constructor(...e){super(...e),s()(this,"state",{isHidden:!0}),s()(this,"_afterLeave",(()=>{const{users:e}=this.props;this.setState((t=>({isHidden:0===e.length})))}))}componentDidUpdate(e,t){this.state.isHidden&&this.props.users&&this.props.users.length&&this.setState({isHidden:!1})}shouldComponentUpdate(e,t){return!Object(se.a)(this.props,e)||!Object(se.a)(this.state,t)}render(){const{isHidden:e}=this.state,{users:t}=this.props,i=t.sort(yn).slice(0,5).map(Cn);return t.length>5&&i.push({key:fn,style:Rn}),r.a.createElement(ne.a,{style:[kn.root,e&&kn.hidden]},r.a.createElement(ne.a,{style:kn.avatarRow},r.a.createElement(_n.TransitionMotion,{styles:i,willEnter:wn,willLeave:xn},(e=>r.a.createElement(r.a.Fragment,null,e.map(((e,i)=>{if(e.style.scale<=.05)return null;const a=On(e.style);return e.key===fn?r.a.createElement(ne.a,{key:e.key,style:[kn.avatar,kn.avatarSpacer,kn.overflowAvatar,{transform:a}]},r.a.createElement(vn.a,{style:kn.overflowAvatarText},"+",t.length-5)):r.a.createElement(ne.a,{key:e.key,style:[kn.avatar,{transform:a}]},r.a.createElement(oe.a,{accessibilityLabel:e.data&&e.data.name,size:"xLarge",uri:e.data&&e.data.profile_image_url_https}))})))))),r.a.createElement(_n.TransitionMotion,{didLeave:this._afterLeave,styles:t.length>0?An:[],willEnter:Tn,willLeave:In},(e=>r.a.createElement(r.a.Fragment,null,e.map((e=>r.a.createElement(ne.a,{key:e.key,style:[kn.messageBubble,{transform:On(e.style)}]},r.a.createElement(ne.a,{style:kn.dot}),r.a.createElement(ne.a,{style:[kn.dot,kn.dot1]}),r.a.createElement(ne.a,{style:[kn.dot,kn.dot2]}))))))))}}const kn=z.a.create((e=>({root:{flexDirection:"row",paddingBottom:e.spaces.space20,paddingRight:e.spaces.space12,width:"calc(100% * 7/8)",position:"relative",transitionProperty:"height, padding-bottom",transitionDuration:"0.2s",overflow:"hidden"},hidden:{paddingBottom:0,paddingRight:0,height:0,width:0},avatarRow:{display:"inline-flex",alignItems:"flex-start",flexDirection:"row"},avatar:{marginEnd:e.spaces.space12,transformOrigin:"50% 100%"},avatarSpacer:{height:e.spaces.space40,width:e.spaces.space40},overflowAvatar:{borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.primary,alignItems:"center",justifyContent:"center"},overflowAvatarText:{color:"white"},messageBubble:{alignItems:"center",borderRadius:e.borderRadii.infinite,maxWidth:"100%",paddingVertical:e.spaces.space12,paddingHorizontal:e.spaces.space16,backgroundColor:e.colors.gray50,borderBottomLeftRadius:e.borderRadii.none,borderColor:e.colors.gray200,flexDirection:"row",height:e.spaces.space40,overflow:"hidden",transformOrigin:"0% 100%"},dot:{display:"flex-inline",position:"relative",width:e.spaces.space12,height:e.spaces.space12,overflow:"hidden",borderRadius:e.borderRadii.infinite,backgroundColor:e.colors.gray700,marginEnd:e.spaces.space4,animationDuration:"1.2s",animationIterationCount:"infinite",animationTimingFunction:"linear",animationKeyframes:[{"15%":{transform:[{scale:1.4}],backgroundColor:e.colors.primary},"30%":{transform:[{scale:1}]}}]},dot1:{animationDelay:"0.1s"},dot2:{animationDelay:"0.2s"}})));var Pn=bn(Mn),Dn=i("tn7R");class Ln extends r.a.PureComponent{constructor(...e){super(...e),s()(this,"_timers",{}),s()(this,"state",{forceHide:!1,userIds:[]}),s()(this,"_handleLivePipelineUpdate",(e=>{const{user_id:t}=e.dm_typing;t!==this.context.loggedInUserId&&(this._timers[t]&&clearTimeout(this._timers[t]),this._timers[t]=setTimeout((()=>this._removeAvatar(t)),4e3),this.setState((e=>({forceHide:!1,userIds:[...e.userIds.filter((e=>e!==t)),t]}))))})),s()(this,"_removeAvatar",((e,t=!1)=>{this.setState((i=>{const a=i.userIds.filter((t=>t!==e));return{forceHide:t&&0===a.length,userIds:a}}))}))}componentDidMount(){this._initializeLivePipeline()}componentDidUpdate(e,t){if(this.props.lastEntry){const{lastEntry:t={}}=e||{},{lastEntry:i}=this.props;t&&t.id!==i.id&&i.message_data&&this._removeAvatar(i.message_data.sender_id,!0)}e.conversationId!==this.props.conversationId&&(this._teardownLivePipeline(),this._initializeLivePipeline())}componentWillUnmount(){this._teardownLivePipeline()}render(){const{forceHide:e,userIds:t}=this.state;return!e&&r.a.createElement(Pn,{userIds:t})}_teardownLivePipeline(){Object(Dn.a)(this._timers).forEach((e=>clearTimeout(e))),this._livePipelineSubscription&&this._livePipelineSubscription.teardown()}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(o.h)().then((({LivePipeline:t})=>{t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_typing/${e}`,this._handleLivePipelineUpdate))}))}}s()(Ln,"contextType",U.a);var Fn=un(Ln),Bn=i("3AAD"),jn=i("iBK2"),Nn=i("Fz18"),Un=i("RJrc"),Hn=i("yw4N"),Wn=i("dPJJ"),Vn=i("zrc3"),zn=i("pQ3Z"),qn=i.n(zn),Gn=i("VY6S"),Kn=i("Resy");class Qn{constructor(e){s()(this,"_trackScroll",(()=>{this._programmaticScroll?this._programmaticScroll=!1:this._lastScrollTs=Date.now()})),s()(this,"_normalize",(()=>{this._wrapperNode&&0!==this._transform&&this._viewport&&(this._wrapperNode.style.transform="",this._viewport.scrollBy(-1*this._transform),this._transform=0)})),s()(this,"_normalizeIfNeeded",(()=>{if(!this._wrapperNode||!this._viewport||0===this._transform)return;const e=this._viewport,{height:t,top:i}=this._wrapperNode.getBoundingClientRect(),a=new Kn.a(i,t),s=a.translateBy(-1*this._transform),n=e.getRect();n.contains(s.getTop())||n.contains(s.getBottom())||n.contains(a.getTop())||n.contains(a.getBottom())?this._normalize():this._debouncedNormalize()})),this._transform=0,this._viewport=e,this._lastScrollTs=0,this._debouncedNormalize=Object(Gn.a)(this._normalize,500),this._removeScrollListener=e.addScrollListener(this._normalizeIfNeeded),this._removeScrollTracker=e.addScrollListener(this._trackScroll)}setWrapperNode(e){this._wrapperNode=e}teardown(){this._removeScrollListener(),this._removeScrollTracker(),delete this._viewport}offsetBy(e){if(Math.abs(e)<=.5)return;const t=this._wrapperNode,i=Date.now()-this._lastScrollTs;!t||i>=500?(this._programmaticScroll=!0,this._viewport&&this._viewport.scrollBy(e)):(this._transform=this._transform-e,t.style.transform=`translateY(${this._transform}px)`,this._normalizeIfNeeded())}}class $n extends r.a.Component{constructor(e,t){super(e,t),s()(this,"_updatesSuspended",!1),s()(this,"_handleHeightsUpdate",((e,t)=>{const{anchoring:i}=this.props;this._scrollBy(i.offsetCorrection(e,t))})),s()(this,"_receiveWrapperNode",(e=>this._offsetHandler.setWrapperNode(e))),s()(this,"_handleRefUpdate",(e=>{this._ref=e})),s()(this,"_handleEnterFullscreen",(()=>{this._updatesSuspended=!0,this._ref&&this._ref.freezeUpdates()})),s()(this,"_handleExitFullscreen",(()=>{this._updatesSuspended=!1,this.forceUpdate(),this._ref&&this._ref.resumeUpdates()}));const i=this._findInitialAnchor(e.initialAnchors||[]);this._initialItemIndex=i?i.anchorIndex:0,this._initialAnchor=i&&i.anchor,this._offsetHandler=new Qn(e.viewport)}UNSAFE_componentWillMount(){const{anchoring:e,viewport:t}=this.props;this.setState({scrollHeadroom:e.initialScrollHeadroom(t)})}shouldComponentUpdate(e,t){const i=!qn()(this.props,e)||!qn()(this.state,t);return!this._updatesSuspended&&i}componentDidMount(){this._initialAnchor&&this._scrollToAnchor(this._initialAnchor),this._requestAnimationFrame((()=>{const{list:e,onPositionRestored:t,retryPositionRestoration:i}=this.props;if(i&&this._initialAnchor){!!e.find((({id:e})=>this._initialAnchor&&e===this._initialAnchor.id))&&this._initialAnchor&&this._scrollToAnchor(this._initialAnchor)}t(),this._requestAnimationFrame((()=>{this._relaxScrollHeadroom()}))})),this._unlistenFullscreenEnter=Wn.a(this._handleEnterFullscreen),this._unlistenFullscreenExit=Wn.b(this._handleExitFullscreen)}getAnchors(e){const t=e||this._ref&&this._ref.getPositioning();return t?this.props.anchoring.anchorCandidates(t):[]}getPositioning(){return this._ref&&this._ref.getPositioning()}componentWillUnmount(){this._unmounted=!0,this._offsetHandler.teardown(),this._unlistenFullscreenEnter&&this._unlistenFullscreenEnter(),this._unlistenFullscreenExit&&this._unlistenFullscreenExit()}render(){const{list:e,renderItem:t,renderList:i}=this.props,{scrollHeadroom:a}=this.state;return r.a.createElement("div",{ref:this._receiveWrapperNode,style:{paddingBottom:a}},i({initialItemIndex:this._initialItemIndex,list:e,renderItem:t,ref:this._handleRefUpdate,onHeightsUpdate:this._handleHeightsUpdate}))}_scrollToAnchor(e){const{anchoring:t}=this.props,i=this._ref&&this._ref.getPositioning();i&&this._scrollBy(t.offsetToAnchor(i,e))}_findInitialAnchor(e){const{list:t}=this.props;return e.map((e=>{const i=Object(Vn.a)(t,(({id:t})=>t===e.id));return i>=0?{anchorIndex:i,anchor:e}:null})).find((e=>e))}_relaxScrollHeadroom(){const e=this._ref&&this._ref.getPositioning();if(e){const{anchoring:t}=this.props,i=t.scrollHeadroom(e),{scrollHeadroom:a}=this.state;i<a&&this.setState({scrollHeadroom:i})}}_scrollBy(e){this._offsetHandler.offsetBy(e)}_requestAnimationFrame(e){return window.requestAnimationFrame((()=>{this._unmounted||e()}))}}s()($n,"defaultProps",{anchoring:Bn.a});var Yn=i("AOWc"),Jn=i("180P"),Xn=i("Ey+e"),Zn=i("SrIh"),er=i("E6XO"),tr=i("06eB"),ir=i.n(tr),ar=i("aITJ");const sr=()=>window.performance?window.performance.now():Date.now();class nr extends r.a.Component{constructor(e,t){super(e,t),s()(this,"_perfReported",!1),s()(this,"_observeElement",(e=>{const t=this._resizeObserver;t&&(t.disconnect(),t.observe(e))})),s()(this,"_handleResize",(e=>{const{id:t,onHeightChanged:i}=this.props,[a]=e;this._isResizeObserverHeightUpdatesEnabled&&a&&a.contentRect.height!==this._currentHeight&&(this._currentHeight=a.contentRect.height,i(t,a.contentRect.height)),this._perfReported||(this.props.onVisible(t,sr()-this._perfStart),this._perfReported=!0)})),s()(this,"_setRef",(e=>{const{id:t,setAPI:i}=this.props;e?(this._element=e,i(t,this),this._observeElement(e)):(i(t,void 0),this._element=void 0)})),this._isResizeObserverHeightUpdatesEnabled=this.context.featureSwitches.isTrue("responsive_web_vs_config_resize_observer_enabled")&&ar.b.isDesktopOS()&&ar.b.isSafari(),this._resizeObserver=new window.ResizeObserver(this._handleResize),this._perfStart=sr()}shouldComponentUpdate(e){const{data:t,render:i}=this.props;return i!==e.render||!ir()(t,e.data)}componentWillUnmount(){this._resizeObserver&&this._resizeObserver.disconnect()}componentDidUpdate(e){const{id:t,setAPI:i}=this.props;e.id!==t&&(i(e.id,void 0),i(t,this))}measureHeight(){return this._currentHeight=this._element?this._element.getBoundingClientRect().height:0,this._currentHeight}render(){const{data:e,render:t}=this.props;return r.a.createElement("div",{ref:this._setRef},t(e))}}s()(nr,"contextType",U.a);var rr=i("+d3d"),or=i("iChn");class cr extends r.a.PureComponent{constructor(...e){super(...e),s()(this,"_cells",new Map),s()(this,"_heightUpdates",{}),s()(this,"_visibilityMeasurements",new Map),s()(this,"_handleItemVisible",((e,t)=>{this._visibilityMeasurements.has(e)||this._visibilityMeasurements.set(e,t)})),s()(this,"_reportVisibilityMeasurements",(()=>{if(!this._visibilityMeasurements.size)return;let e=0;this._visibilityMeasurements.forEach((t=>e+=t));const t=Math.round(e/this._visibilityMeasurements.size),i=ar.b.isDesktopOS()?"scroller_legacy":"scroller_legacy_mobile";er.c(`scroller:ttfv:${i}`,{duration_ms:t}),this._visibilityMeasurements.clear()})),s()(this,"_handleCellHeightChanged",((e,t)=>{this._heightUpdates[e]=t,this._flushHeightUpdates()})),s()(this,"_flushHeightUpdates",Object(rr.a)((()=>{const{onHeightsChange:e}=this.props;e(this._heightUpdates),this._heightUpdates={}}),100,{trailing:!0})),s()(this,"_setCellRef",((e,t)=>{t?this._cells.set(e,t):this._cells.delete(e)})),s()(this,"_handleDivRefUpdate",(e=>{this._div=e}))}getWrapperNode(){return this._div}getItemHeights(){const{list:e}=this.props;return Object(or.a)(e,(e=>e.id),(e=>{const t=this._cells.get(e.id);return t?t.measureHeight():0}))}componentWillUnmount(){this._reportVisibilityMeasurements()}render(){const{blankSpaceAbove:e,blankSpaceBelow:t}=this.props;return r.a.createElement("div",{ref:this._handleDivRefUpdate,style:{paddingTop:e,paddingBottom:t}},this._renderContent())}_renderContent(){const{list:e,renderItem:t}=this.props;return e.map((({data:e,id:i})=>r.a.createElement(nr,{data:e,id:i,key:i,onHeightChanged:this._handleCellHeightChanged,onVisible:this._handleItemVisible,render:t,setAPI:this._setCellRef})))}}var lr=i("oi7R"),dr=i("aWzz"),pr=i("JD1h"),hr=i("OeMK"),ur=i("jHwr"),mr=i("qdp+");class gr{constructor({list:e,rectangles:t,sliceEnd:i,sliceStart:a,viewportRectangle:s}){this._viewportRectangle=s,this._list=e,this._rectangles=t,this._sliceStart=a,this._sliceEnd=i}getForViewport(){return this._viewportRectangle}getForList(){const e=this._list;if(0===e.length)return new Kn.a(0,0);{const t=this._rectangles,i=e[0].id,a=e[e.length-1].id,s=t[i].getTop(),n=t[a].getBottom()-s;return new Kn.a(s,n)}}getForAllItems(){return this._list.map((({id:e})=>({id:e,rectangle:this._rectangles[e]})))}getList(){return this._list}getListLength(){return this._list.length}getForItem(e){return this._rectangles[e]}findVisibleItems(){const e=this._viewportRectangle,t=this._rectangles,i=Object(Vn.a)(this._list,(({id:i})=>t[i].doesIntersectWith(e)));if(i<0)return[];let a=Object(Vn.a)(this._list,(({id:i})=>!t[i].doesIntersectWith(e)),i);return-1===a&&(a=this._list.length),this._list.slice(i,a).filter((({id:e})=>this.isRendered(e))).map((({id:e})=>({id:e,rectangle:t[e]})))}getRenderedItems(){const e=this._rectangles;return this._list.slice(this._sliceStart,this._sliceEnd).map((({id:t})=>({id:t,rectangle:e[t]})))}findTopmostVisibleId(){return Object(mr.a)(this.getRenderedItems(),(e=>e.rectangle.getTop()>=this._viewportRectangle.getTop()?e.id:void 0))}isRendered(e){return this._getRenderedIdSet().hasOwnProperty(e)}_getRenderedIdSet(){if(!this._renderedIdSet){const e={};for(let t=this._sliceStart;t<this._sliceEnd;t++)e[this._list[t].id]=!0;this._renderedIdSet=e}return this._renderedIdSet}}var br=i("64vW");const _r=(e,t,i)=>{if(t<0||t>=e.length)return-1;if(i(e[t]))return t;for(let a=1;;a++){const s=t-a,n=t+a,r=s<0,o=n>=e.length;if(r&&o)break;if(!o&&i(e[n]))return n;if(!r&&i(e[s]))return s}return-1};var vr=({list:e,nextList:t,sliceEnd:i,sliceStart:a})=>{const s=t.reduce(((e,{id:t})=>(e[t]=!0,e)),{}),n=_r(e,a,(({id:e})=>!Object(hr.a)(e)&&s.hasOwnProperty(e)&&s[e]));if(-1===n)return null;let r=Object(Vn.a)(t,(({id:t})=>e[n].id===t));Object(Yn.a)(r>=0,"newSliceStart should be defined if we found a common item");return n>0&&Object(hr.a)(e[n-1].id)&&r>0&&Object(hr.a)(t[r-1].id)&&(r-=1),{sliceStart:r,sliceEnd:Math.min(t.length,r+i-a)}};const fr={heightsReady:!0};class yr extends r.a.PureComponent{constructor(e,t){super(e,t),s()(this,"_updatesSuspended",!1),s()(this,"freezeUpdates",(()=>{this._updatesSuspended=!0})),s()(this,"resumeUpdates",(()=>{this._updatesSuspended=!1,this._scheduleUpdate()})),s()(this,"_handleHeightsChange",(e=>{this._postRenderProcessing({hasListChanged:!1,newHeights:e})})),s()(this,"_handleRefUpdate",(e=>{this._ref=e})),s()(this,"_setNecessarySlice",((e,t)=>{const{sliceEnd:i,sliceStart:a}=this.state,s={start:a,end:i},n={start:e,end:t},{end:r,start:o}=((e,t)=>{if(t.start>=e.start&&t.end<=e.end)return e;if(t.start>=e.end||t.end<=e.start)return t;{const i=Math.max(e.start-t.start,t.end-e.end);return{start:Math.min(e.start+i,t.start),end:Math.max(e.end-i,t.end)}}})(s,n);this._setSlice(o,r)})),s()(this,"_setSlice",((e,t)=>{if(this._updatesSuspended)return;const{sliceEnd:i,sliceStart:a}=this.state;e===a&&t===i||this.setState({sliceStart:e,sliceEnd:t})}));const{initialItemIndex:i,list:a}=this.props;this._assumedItemHeight=e.assumedItemHeight,this._getSlice=()=>{const{list:e}=this.props,{sliceEnd:t,sliceStart:i}=this.state;return this._getMemoizedSlice(e,i,t)},this._getMemoizedSlice=Object(me.a)(((e,t,i)=>e.slice(t,i))),this._getRectangles=e=>{const t=e||this,{_assumedItemHeight:i,_heights:a}=t,{list:s}=t.props;return t._getMemoizedRectangles(s,a,i)},this._getMemoizedRectangles=Object(me.a)(((e,t,i)=>Er(e,t,i))),this._heights={};const{cacheKey:n,heightCache:r}=this.props;n&&r.hasOwnProperty(n)&&(this._heights=r[n]),this.state=this._getDefaultSlice(a,i);const o=Object(ur.a)((()=>this._criticalUpdate()),window.requestAnimationFrame);this._scheduleUpdate=window.requestIdleCallback?Object(ur.a)((()=>this._criticalUpdate()),window.requestIdleCallback):o,this._schedulePositioningNotification=Object(ur.a)((()=>this._notifyPositioning()),window.requestIdleCallback?e=>window.requestIdleCallback(e,{timeout:500}):window.requestAnimationFrame),this._handleScroll=Object(rr.a)(o,100,{trailing:!0}),this._scheduleDebouncedUpdate=Object(Gn.a)((()=>{window.requestAnimationFrame((()=>{this._debouncedUpdate()}))}),500),this._removeDebouncedListener=e.viewport.addScrollListener(this._scheduleDebouncedUpdate)}componentDidMount(){this._unlistenScroll=this.props.viewport.addScrollListener(this._handleScroll),this._postRenderProcessing({hasListChanged:!0})}componentWillUnmount(){this._unmounted=!0,this._unlistenScroll&&this._unlistenScroll(),this._removeDebouncedListener();const{cacheKey:e,heightCache:t}=this.props;e&&(t[e]=this._heights)}componentDidUpdate(e){this._postRenderProcessing({hasListChanged:e.list!==this.props.list})}UNSAFE_componentWillReceiveProps(e){const{list:t}=this.props,{sliceEnd:i,sliceStart:a}=this.state,s=e.list;if(s!==t){const e=vr({list:t,nextList:s,sliceStart:a,sliceEnd:i})||this._getDefaultSlice(s);this._setSlice(e.sliceStart,e.sliceEnd)}}UNSAFE_componentWillUpdate(){this._prevPositioning=this.getPositioning()}getPositioning(){const{sliceEnd:e,sliceStart:t}=this.state;return new gr({viewportRectangle:this._getRelativeViewportRect(),list:this.props.list,rectangles:this._getRectangles(),sliceStart:t,sliceEnd:e})}render(){const{renderItem:e,renderList:t}=this.props,{blankSpaceAbove:i,blankSpaceBelow:a}=this._computeBlankSpace();return r.a.createElement(br.a.Provider,{value:fr},t({ref:this._handleRefUpdate,list:this._getSlice(),blankSpaceAbove:i,blankSpaceBelow:a,renderItem:e,onHeightsChange:this._handleHeightsChange}))}_computeBlankSpace(){const{list:e}=this.props,{sliceEnd:t,sliceStart:i}=this.state,a=this._getRectangles(),s=0===e.length?0:a[e[i].id].getTop()-a[e[0].id].getTop(),n=Object(N.a)(e);return{blankSpaceAbove:s,blankSpaceBelow:t>=e.length||!n?0:a[n.id].getBottom()-a[e[t].id].getTop()}}_postRenderProcessing({hasListChanged:e,newHeights:t}){const{wasHeightChange:i}=this._recordHeights(t);if(i||e){const e=this._prevPositioning;if(e){const{onHeightsUpdate:t}=this.props;t(e,this.getPositioning())}}const{minimumOffscreenToViewportRatio:a,preferredOffscreenToViewportRatio:s}=this.props;e||!this._sliceIncludesScaledViewport(a)?this._scheduleUpdate():this._sliceIncludesScaledViewport(s)||this._scheduleDebouncedUpdate(),this._schedulePositioningNotification()}_sliceIncludesScaledViewport(e){const{sliceEnd:t,sliceStart:i}=this._computeSlice({offscreenToViewportRatio:e});return i>=this.state.sliceStart&&t<=this.state.sliceEnd}_recordHeights(e){if(!this._ref)return{heightDelta:0,wasHeightChange:!1};const t=e||this._ref.getItemHeights();let i=!1;const a=Object.keys(t).reduce(((e,a)=>{const s=this._heights.hasOwnProperty(a)?this._heights[a]:this._assumedItemHeight,n=t[a];return i=i||s!==n,e+(n-s)}),0);return i&&(this._heights=Object.assign({...this._heights},t)),{wasHeightChange:i,heightDelta:a}}_criticalUpdate(){const{sliceEnd:e,sliceStart:t}=this._computeSlice({offscreenToViewportRatio:this.props.minimumOffscreenToViewportRatio});"number"==typeof t&&"number"==typeof e&&this._setNecessarySlice(t,e)}_debouncedUpdate(){const{sliceEnd:e,sliceStart:t}=this._computeSlice({offscreenToViewportRatio:this.props.preferredOffscreenToViewportRatio});"number"==typeof t&&"number"==typeof e&&this._setSlice(t,e)}_computeSlice({offscreenToViewportRatio:e}){const{list:t}=this.props;if(this._unmounted||0===t.length)return{};const i=this._getRelativeViewportRect(),a=i.getHeight()*e,s=i.getTop()-a,n=i.getBottom()+a,r=this._getRectangles(),o=Object(Vn.a)(t,(({id:e})=>r[e].getBottom()>s)),c=o>=0?o:t.length-1,l=Object(Vn.a)(t,(({id:e})=>r[e].getTop()>=n),c),d=l>=0?l:t.length;return this._schedulePositioningNotification(),{sliceStart:c,sliceEnd:d}}_notifyPositioning(){if(!this._unmounted){const{onPositioningUpdate:e}=this.props;e(this.getPositioning())}}_getRelativeViewportRect(){if(!this._ref)return new Kn.a(0,0);const e=this._ref.getWrapperNode();if(!e)return new Kn.a(0,0);const t=Math.ceil(e.getBoundingClientRect().top);return this.props.viewport.getRect().translateBy(-t)}_getDefaultSlice(e,t=0){const{viewport:i}=this.props,a=i.getRect().getHeight(),s={...this,props:{...this.props,list:e},state:{...this.state},context:{...this.context},refs:null},n=this._getRectangles(s),{id:r}=e[t],o=n[r].getBottom(),c=Object(Vn.a)(e,(({id:e})=>n[e].getTop()-o>=a),t),l=c>=0?c:e.length;return{sliceStart:t,sliceEnd:Math.min(e.length,l)}}}s()(yr,"defaultProps",{assumedItemHeight:400,heightCache:{},initialItemIndex:0,minimumOffscreenToViewportRatio:.5,preferredOffscreenToViewportRatio:2.5});const Er=(e,t,i)=>{const a={};return e.reduce(((e,{id:s})=>{const n=t.hasOwnProperty(s)?t[s]:i,r=new Kn.a(e,n);return a[s]=r,r.getBottom()}),0),a};var Sr=yr;const Rr=e=>(Object(Zn.a)(`Fallback to slow hashing in VirtualScroller (type = ${e?e.type:""})`),Object(Jn.a)(e));class Cr extends r.a.Component{constructor(e,t){super(e,t),s()(this,"_onDemandRenderer",(e=>{const{assumedItemHeight:t,minimumOffscreenToViewportRatio:i,preferredOffscreenToViewportRatio:a}=this.props,s="function"==typeof t?t(""):t;return r.a.createElement(Sr,zt()({},e,{assumedItemHeight:s,cacheKey:this.props.cacheKey,minimumOffscreenToViewportRatio:i,onPositioningUpdate:this._handlePositioningUpdate,preferredOffscreenToViewportRatio:a,renderList:this._viewRenderer,viewport:this._viewport}))})),s()(this,"_viewRenderer",(e=>r.a.createElement(cr,e))),s()(this,"_getItemRenderer",(()=>this._getMemoizedItemRenderer(this.props.renderer))),s()(this,"_getMemoizedItemRenderer",Object(me.a)((e=>t=>t?t.presentational?t.renderNode():e(t.data):null))),s()(this,"_handleAnchorRendererRefUpdate",(e=>{this._anchorRenderer=e})),s()(this,"_handlePositionRestored",(()=>{const{onPositionRestored:e}=this.props;e(),this._edgeProximity=this._createEdgeProximity();const t=this._anchorRenderer&&this._anchorRenderer.getPositioning();t&&this._edgeProximity.handlePositioningUpdate(t)})),s()(this,"_handlePositioningUpdate",(e=>{this._edgeProximity&&this._edgeProximity.handlePositioningUpdate(e);const{onItemsRendered:t}=this.props;t&&t({positions:e.getRenderedItems(),viewport:e.getForViewport()})})),s()(this,"_getList",(()=>{const{footer:e,header:t,identityFunction:i,items:a}=this.props;return this._getMemoizedList(i,a,t,e)})),s()(this,"_getMemoizedList",Object(me.a)(((e,t,i,a)=>{const s={},n=t.reduce(((t,i)=>{const a=e(i)||i.id||Rr(i);return Object(Yn.a)("number"==typeof a||"string"==typeof a,"Item id must not be falsy"),s.hasOwnProperty(a)?Object(Zn.a)("Duplicate item id generated in VirtualScroller. Latter item will be discarded",{extra:{id:a}}):(t.push({data:{data:i},id:a}),s[a]=!0),t}),[]),r=i?{id:hr.c,data:{presentational:!0,renderNode:()=>i}}:null,o=a?{id:hr.b,data:{presentational:!0,renderNode:()=>a}}:null;return n.length?[...r?[r]:[],...n,...o?[o]:[]]:[]}))),this._viewport=e.viewport||t.viewport||lr.a.root()}scrollToNewest(e){this._viewport.scrollToTop()}isAtNewest(){const e=this._anchorRenderer&&this._anchorRenderer.getPositioning();return(e&&e.getForViewport().getTop()||0)<50}adjustFocusBy(e){}UNSAFE_componentWillMount(){this._isManualScrollRestoration=window.history&&"manual"===window.history.scrollRestoration,this._loadStoredPosition(this.props)}UNSAFE_componentWillReceiveProps(e){const{cacheKey:t}=this.props;t!==e.cacheKey&&(this._preservePosition(this._customLocation),this._loadStoredPosition(e))}componentWillUnmount(){this._preservePosition(this._customLocation)}render(){const{anchoring:e,cacheKey:t,items:i,noItemsRenderer:a}=this.props;return i.length?r.a.createElement($n,{anchoring:e,initialAnchors:this._initialAnchors||[],key:t,list:this._getList(),onPositionRestored:this._handlePositionRestored,ref:this._handleAnchorRendererRefUpdate,renderItem:this._getItemRenderer(),renderList:this._onDemandRenderer,retryPositionRestoration:!this._isManualScrollRestoration,viewport:this._viewport}):a()}_preservePosition(e){if(this._anchorRenderer&&e){const t=this._anchorRenderer.getAnchors();e.savePosition(t)}}_createEdgeProximity(){const{nearEndProximityRatio:e,nearStartProximityRatio:t}=this.props;return new pr.b([{condition:pr.a.nearTop(5),callback:e=>this.props.onAtStart(e)},{condition:pr.a.nearTopRatio(t),callback:e=>this.props.onNearStart(e)},{condition:pr.a.nearBottomRatio(e),callback:e=>this.props.onNearEnd(e)},{condition:pr.a.nearBottom(5),callback:e=>this.props.onAtEnd(e)}])}_loadStoredPosition(e){const{getCustomLocation:t}=this.context,{initialAnchor:i}=e;if(this._customLocation=t&&t(),this._initialAnchors=i?[i]:[],this._customLocation){const e=this._customLocation.getSavedPosition();e&&e.length?this._initialAnchors=e:this._initialAnchors=i?[i]:[],this._initialAnchors.length>0&&this._customLocation&&this._customLocation.claimScrollRestoration()}}}s()(Cr,"displayName","VirtualScroller"),s()(Cr,"contextTypes",{viewport:dr.object,getCustomLocation:dr.func}),s()(Cr,"defaultProps",{anchoring:$n.defaultProps.anchoring,assumedItemHeight:Sr.defaultProps.assumedItemHeight,identityFunction:Rr,minimumOffscreenToViewportRatio:Sr.defaultProps.minimumOffscreenToViewportRatio,nearEndProximityRatio:1.75,nearStartProximityRatio:.25,noItemsRenderer:()=>null,onPositionRestored:ea.a,onAtEnd:ea.a,onAtStart:ea.a,onNearEnd:ea.a,onNearStart:ea.a,onScrollEnd:ea.a,preferredOffscreenToViewportRatio:Sr.defaultProps.preferredOffscreenToViewportRatio,withKeyboardShortcuts:!1});var wr=Object(Xn.a)(Cr),xr=i("mw9i");const Ar=De.a.i859a9d3,Tr=De.a.i8ecae5b,Ir=e=>e.entry.id,Or=e=>e.entry.type===ae.b.MESSAGE;class Mr extends r.a.Component{constructor(e,t){super(e,t),s()(this,"_appBarScrollEnabled",this.context.featureSwitches.isTrue("responsive_web_app_bar_scroll_enabled")),s()(this,"_shouldUseNewScroller",this.context.featureSwitches.isTrue("responsive_web_dm_new_scroller_enabled")),s()(this,"_renderItem",(e=>{const{conversation:t}=this.props,i=t.conversation_id;switch(e.type){case ae.b.TYPING_INDICATOR:return i?r.a.createElement(Fn,{conversationId:i}):null;case ae.b.READ_ONLY_INDICATOR:return i?r.a.createElement(ne.a,{style:kr.readOnly},r.a.createElement(re.b,{align:"center",color:"gray700",size:"subtext2"},Tr,"",r.a.createElement(re.b,{link:"https://support.twitter.com/articles/14606#faq"},Ar))):null;case ae.b.CONVERSATION_PROFILE_INFO_HEADER:return r.a.createElement(X,{conversation:t});default:return this._renderDMEntry(e)}})),s()(this,"_setActiveEntry",(e=>{this.setState({activeEntryId:e})})),s()(this,"_setShouldFreezeUpdates",(e=>{this.setState({shouldFreezeUpdates:e})})),this._anchoring=L({isOwnMessage:e=>{var t,i;return(null===(t=e.entry)||void 0===t||null===(i=t.message_data)||void 0===i?void 0:i.sender_id)===this.props.perspective||!1},typingIndicatorId:F.a}),this.state={activeEntryId:null,shouldFreezeUpdates:!1}}shouldComponentUpdate(e,t){return!1===t.shouldFreezeUpdates}render(){const{conversation:e,drawerHeader:t,isWide:i,onHistoryRequest:a,style:s}=this.props,{activeEntryId:n}=this.state,o=(({activeEntryId:e,canInjectConversationProfileInfoHeader:t,conversation:i,footer:a,readOnlyEntry:s})=>{const n=i&&i.entries||[],r=n.reduce(((a,s,r)=>{t&&0===r&&a.push(F.b);const o=Object(N.a)(a),c=r===n.length-1;if(a.push({isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,entry:s,isActive:e===s.id,isTrusted:!(null==i||!i.trusted)}),o){const e=j(o.entry,s),t=a[a.length-2];e?(a[a.length-1].isRapidFire=!0,t.isRapidFire||(t.isFirstRapidFire=!0,t.isRapidFire=!0),c&&(a[a.length-1].isLastRapidFire=!0)):t.isRapidFire&&(t.isLastRapidFire=!0)}return a}),[]);return a&&r.push(a),i.read_only&&s&&r.push(s),r})({conversation:e,footer:F.d,readOnlyEntry:F.c,canInjectConversationProfileInfoHeader:e.status===ae.c.AT_END&&e.type===ae.a.ONE_TO_ONE,activeEntryId:n}),c=e.conversation_id,l=e=>e[e.length-1],d=e=>{for(let t=e.length-1;t>=0;t--){const i=e[t];if(i&&Or(i))return i}return l(e)},p=`dm-activity-${c}`;return r.a.createElement(Z.a.Consumer,null,(({isDrawer:n})=>{const c=this._appBarScrollEnabled?n?ee.b.drawerHeaderRadius:kr.scrollSpace:null;return r.a.createElement(ne.a,{style:[kr.scrollContainer,c]},r.a.createElement(Hn.a,{style:[kr.scrollContainer,i&&kr.conversationsPadding,c,s]},t||null,e.status&&e.status!==ae.c.AT_END?r.a.createElement(Un.a,null):null,r.a.createElement(xr.a,{style:[kr.content,kr.alignTop],withGutter:!0},this._shouldUseNewScroller?r.a.createElement(jn.b,{anchoring:Bn.a,assumedItemHeight:50,cacheKey:p,canBeAnchorFunction:Or,hasNewContentAtBottom:!0,identityFunction:Ir,initialAnchor:o.length>0?I.a(Ir(d(o))):void 0,items:o,nearStartProximityRatio:2,onNearStart:a,renderer:this._renderItem,withoutHeadroom:!1}):r.a.createElement(Nn.a,{identifier:p},r.a.createElement(wr,{anchoring:this._anchoring,assumedItemHeight:50,cacheKey:p,hasNewContentAtBottom:!1,identityFunction:Ir,initialAnchor:o.length>0?I.a(Ir(l(o))):void 0,items:o,nearStartProximityRatio:2,onNearStart:a,renderer:this._renderItem,withoutHeadroom:!0})))))}))}_renderDMEntry({entry:e,isActive:t,isFirstRapidFire:i,isLastRapidFire:a,isRapidFire:s}){const{conversation:n,inboxType:o,isWide:c,perspective:l,scribeNamespace:d}=this.props;return e&&o?r.a.createElement(pn,{conversation:n,entry:e,inboxType:o,isActive:t,isFirstRapidFire:i,isLastRapidFire:a,isRapidFire:s,isWide:c,key:e.id,perspective:l,scribeNamespace:d,setActiveEntry:this._setActiveEntry,setShouldFreezeUpdates:this._setShouldFreezeUpdates}):null}}s()(Mr,"contextType",U.a);const kr=z.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"},scrollContainer:{backgroundColor:e.colors.cellBackground,flexGrow:1,height:"100%",overflowX:"hidden",WebkitOverflowScrolling:"touch"},scrollSpace:{paddingTop:e.componentDimensions.appBarHeightPx,marginTop:-e.componentDimensions.appBarHeightPx},conversationsPadding:{paddingTop:e.spaces.space20},content:{flexGrow:1,transform:[{translate3d:"0,0,0"}]},alignTop:{justifyContent:"flex-start"},readOnly:{paddingBottom:e.spaces.space20}})));var Pr=i("uB9N"),Dr=i("v//M"),Lr=i("J2UM"),Fr=i("07FG"),Br=i("I8M8"),jr=i("7myi"),Nr=i("883S"),Ur=i("z0MJ"),Hr=i.n(Ur),Wr=i("Es6L"),Vr=i("LsPn"),zr=i("GSsg"),qr=i("EbOo"),Gr=i("tZH3");const Kr=De.a.ccf2f24e,Qr=De.a.ib3fe8a9;var $r=({isGroup:e,onBlockClick:t,onReportClick:i,requestorScreenName:a})=>{const s={type:"destructiveOutlined"},n=r.a.createElement(ct.a,zt()({},s,{accessibilityRole:"button"}),Qr),o=r.a.createElement(ct.a,zt()({},s,{onPress:i}),Kr),c=r.a.useCallback(((e,s)=>r.a.createElement(Gr.a,{dismiss:e,flatBorders:"sheet"===s,onBlockClick:t,onReportClick:i,requestorScreenName:a,showBlock:!0,showCancel:"sheet"===s})),[t,i,a]);return e?o:r.a.createElement(gi.a,{renderContent:c},n)};var Yr=Object(qt.a)().propsFromActions((()=>({addToast:h.b,block:v.e.block,createLocalApiErrorHandler:Object(E.createLocalApiErrorHandlerWithContextFactory)("UNTRUSTED_CONVERSATION_ACTIONS"),muteDMUser:l.muteDMUser,unmuteDMUser:l.unmuteDMUser,unblock:v.e.unblock}))),Jr=(i("AQ79"),i("u0B7")),Xr=i("cHvH"),Zr=i("lHOd"),eo=i("vMjK"),to=i("7JQg"),io=i("24HD"),ao=i("Ty5D");const so=De.a.da878dcf,no=De.a.d96cf7cd,ro=(De.a.gde6b424,De.a.e308019b,De.a.gf5e9ea6,De.a.hc52446b),oo=De.a.f7e1ad65,co={headline:De.a.gdf4b79f,text:De.a.bbf83d83,confirmButtonLabel:De.a.bb1d57b6},lo=z.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderTopStyle:"solid",borderTopWidth:"1px",paddingVertical:e.spaces.space20,paddingHorizontal:e.componentDimensions.gutterHorizontal},copy:{paddingBottom:e.spaces.space20},reportlink:{marginLeft:e.spaces.space4},actionsContainer:{display:"flex",flexWrap:"wrap",flexDirection:"row"},actionFullWidth:{width:"100%"},actionHalfWidth:{width:`calc(50% - ${e.spaces.space4})`},actionMarginRight:{marginRight:e.spaces.space4},actionMarginLeft:{marginLeft:e.spaces.space4},actionMarginTop:{marginTop:e.spaces.space12},actionMarginBottom:{marginBottom:e.spaces.space12}})));var po=Object(to.c)({element:"untrusted_interstitial"})(Yr((e=>{const{conversation:t,scribeAction:i,scribeNamespace:a}=e,s=r.a.useContext(U.a),n=Object(ao.g)(),o=Object(ao.h)(),[c,d]=r.a.useState(!1),[p,h]=r.a.useState(!1),u=r.a.useCallback((()=>({items:[{conversation_type:t.type===l.CONVERSATION_TYPE.GROUP?1:0}]})),[t.type]),m=r.a.useCallback(((e,t)=>{i({...a,action:e},t||u())}),[u,i,a]);r.a.useEffect((()=>{m("impression")}),[m]);const g=s.featureSwitches.isTrue("dm_vdl_enabled")&&s.featureSwitches.isTrue("dm_vdl_chat_p0_enabled"),b=()=>{const{conversationId:t,inboxType:i}=e;t&&(m("report"),n.push(Object(y.f)(t,window.location.pathname,a,i)))},_=()=>{d(!0),h(!1)},v=()=>{d(!1),h(!0)},f=()=>{d(!1)},E=()=>{h(!1)},S=()=>{var i;const{conversationId:a,inboxType:s,leaveConversation:n}=e,r=t.type===l.CONVERSATION_TYPE.GROUP?"leave_group":"delete_thread",c=null!=t&&t.participants?Object.keys(t.participants).length:0,p=(null==o||null===(i=o.state)||void 0===i?void 0:i.position)||0,h={conversation_type:(null==t?void 0:t.type)===l.CONVERSATION_TYPE.GROUP?1:0,conversation_id:a,conversation_participant_count:c,position:p,inbox_type:Object(y.h)(s),entry_point:Qe.b.REQUEST_ACTION_SHEET};d(!1),n({conversationId:a}),m(r,h),R()},R=()=>{const{inboxType:t}=e;n.push(Object(y.e)(t))},C=()=>{(()=>{var i;const{acceptConversation:a,conversationId:s,inboxType:n,scribeAction:r,scribeNamespace:c}=e,d=t.type===l.CONVERSATION_TYPE.GROUP,p=null!=t&&t.participants?Object.keys(t.participants).length:0,h=(null==o||null===(i=o.state)||void 0===i?void 0:i.position)||0;s&&(a(s),r({...c,action:"accept"},{conversation_id:s,conversation_type:d?1:0,conversation_participant_count:p,entry_point:Qe.b.REQUEST_ACTION_SHEET,inbox_type:Object(y.h)(n),position:h}))})()},w=t=>()=>{const{addToast:i,block:a,createLocalApiErrorHandler:s}=e;h(!1),a(t).then((()=>{i({action:{label:eo.c,onAction:x(t)},text:eo.a})}),s(qr.a)),m("block")},x=t=>()=>{const{createLocalApiErrorHandler:i,unblock:a}=e;a(t).catch(i(Jr.a)),m("unblock")},A=(t&&t.type)===l.CONVERSATION_TYPE.GROUP;return r.a.createElement(r.a.Fragment,null,r.a.createElement(ne.a,{style:lo.root},(e=>{const{loggedInUserId:i}=s;return r.a.createElement(re.b,{style:lo.copy},e?ro:oo({senderName:Object(y.i)(t,i).name}))})(A),(e=>{const{loggedInUserId:i}=s;return r.a.createElement(Xr.a,null,(({windowWidth:a})=>{const s=a<=z.a.theme.breakpoints.small;return r.a.createElement(ne.a,{style:lo.actionsContainer},g&&r.a.createElement(ct.a,{onPress:C,size:"medium",style:[lo.actionFullWidth,lo.actionMarginBottom],type:"primaryOutlined"},so),r.a.createElement(ne.a,{style:s?lo.actionFullWidth:[lo.actionHalfWidth,lo.actionMarginRight]},r.a.createElement(Zr.a.Consumer,null,(a=>r.a.createElement($r,{isGroup:e,onBlockClick:v,onReportClick:b,requestorScreenName:Object(y.i)(t,i).screenName})))),r.a.createElement(ct.a,{onPress:_,size:"medium",style:s?[lo.actionFullWidth,lo.actionMarginTop]:[lo.actionHalfWidth,lo.actionMarginLeft],type:"destructiveOutlined"},no),!g&&r.a.createElement(ct.a,{onPress:C,size:"medium",style:[lo.actionFullWidth,lo.actionMarginTop],type:"primaryOutlined"},so))}))})(A)),ar.b.isKaiOS()?r.a.createElement(Vr.a,{leftText:no,onLeftClick:_,onRightClick:C,rightText:so}):null,c?r.a.createElement(ot.a,{confirmButtonLabel:co.confirmButtonLabel,confirmButtonType:"destructiveFilled",headline:co.headline,onCancel:f,onConfirm:S,text:co.text}):null,p?(()=>{const{loggedInUserId:e}=s,{idStr:i,screenName:a}=Object(y.i)(t,e);return Object(io.j)({confirmation:Object(io.f)(a),onClose:E,handleConfirm:w(i)})})():null)}))),ho=i("rFBM"),uo=i("jTgF");const mo=r.a.createElement(xt.a,null),go=De.a.badb01a0,bo=De.a.e3275464,_o=De.a.d6b11d9c,vo=De.a.i7ca1446,fo=e=>e&&(e.tweet||e.media),yo=({gifMetadata:e={},tweetAttachment:t,media:i})=>{let a;return t?a={tweet:t}:i?i.mediaFile?a={media:i}:i.externalMediaDetails&&(a={media:i,provider:e.provider,gifUrl:e.url}):a=null,a};class Eo extends r.a.PureComponent{constructor(e,t){super(e,t),s()(this,"_composer",r.a.createRef()),s()(this,"_handleLivePipelineUpdate",(()=>{this._fetchUpdatesIfNeeded(),this._updatePolling&&this._updatePolling.restart()})),s()(this,"_fetchUpdatesIfNeeded",(()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchUpdatesIfNeeded:i,isDmReceiptSettingEnabled:a}=this.props;i(a?{active_conversation_id:e,dm_users:!0}:{}).catch(t())})),s()(this,"_handleInitialFetch",(()=>{this._initialFetch()})),s()(this,"_initialFetch",(()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchInboxIfNeeded:i,fetchUpdatesIfNeeded:a}=this.props;return i().then((()=>{if(e)return this._fetchConversation(e).then((()=>this._requestWelcomeMessage(e)))})).then((()=>a())).catch(t()).finally((()=>{this._updatePolling&&this._updatePolling.start()}))})),s()(this,"_isUntrustedConversation",(e=>{const{isNewGroupConversation:t}=this.props;return!(null!=e&&e.trusted||t)})),s()(this,"_leaveConversation",(e=>{const{createLocalApiErrorHandler:t,leaveConversation:i}=this.props;i(e).catch(t({showToast:!0}))})),s()(this,"_acceptConversation",(e=>{const{acceptConversation:t,createLocalApiErrorHandler:i}=this.props;t(e).then((()=>{ar.b.isMobileOS()&&this._fetchConversation(e)})).catch(i({showToast:!0}))})),s()(this,"_renderActions",(()=>{const{conversation:e,conversationId:t,inboxType:i,scribeAction:a}=this.props;return e&&this._isUntrustedConversation(e)?e.read_only?null:t&&r.a.createElement(po,{acceptConversation:this._acceptConversation,conversation:e,conversationId:t,inboxType:i,leaveConversation:this._leaveConversation,scribeAction:a}):r.a.createElement(r.a.Fragment,null,this._renderComposerBar(),ar.b.isKaiOS()?r.a.createElement(Vr.a,{leftText:vo,onLeftClick:this._handleInfoClick,onRightClick:this._handleComposeClick,rightText:go}):null)})),s()(this,"_render",(()=>{const{conversation:e,conversationId:t,drawerHeader:i,inboxType:a,isWide:s,perspective:n,scribeNamespace:o}=this.props,{attachment:c,composerHeight:l}=this.state;return r.a.createElement(Ds,{key:t},r.a.createElement(ho.a,{allowDragDrop:!fo(c),onFilesAdded:this._handleDragDrop,style:So.dragDrop},r.a.createElement(Hn.a,{style:[So.scrollView,!Object(Wr.a)()&&!this._isUntrustedConversation(e)&&{paddingBottom:l}]},n&&e?r.a.createElement(Mr,{conversation:e,drawerHeader:i,inboxType:a,isWide:s,onHistoryRequest:this._handleHistoryRequest,perspective:n,scribeNamespace:o,style:So.activity}):null),this._renderActions()))})),s()(this,"_handleNavHeightChange",(e=>{this.setState({composerHeight:`${e}px`})})),s()(this,"_handleTyping",(()=>{this._throttleSaveDraftText(),this._throttleUpdateTyping()})),s()(this,"_throttleUpdateTyping",Object(rr.a)((()=>{const{conversationId:e,createLocalApiErrorHandler:t,updateTyping:i}=this.props;e&&i({conversationId:e}).catch(t())}),2e3,{trailing:!1})),s()(this,"_throttleSaveDraftText",Object(rr.a)((()=>{const{conversationId:e}=this.props;e&&this._handleSaveDraftText()}),1e3,{leading:!1})),s()(this,"_handleDragDrop",(e=>{this._currentComposer&&this._currentComposer.handleAddMediaFiles(e)})),s()(this,"_handleHistoryRequest",(()=>{const{conversationId:e,createLocalApiErrorHandler:t,fetchConversationHistory:i}=this.props;i({conversationId:e}).catch(t())})),s()(this,"_handleSendMessage",((e,t)=>{var i,a;const{addToast:s,cardUrl:n,conversation:r,conversationId:o,createLocalApiErrorHandler:c,gifMetadata:d,history:p,location:h,newConversationParticipants:u,perspective:m,scribeAction:g,scribeNamespace:b,sendMessage:_,tweetAttachment:v}=this.props,{attachment:f}=this.state,y=f&&f.media,E=null!=r&&r.participants?Object.keys(r.participants).length:0,S=(null==r?void 0:r.type)===l.CONVERSATION_TYPE.GROUP;let R="unknown";if(e.quickReply||y||(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),d)R="gif";else if(n)R="card";else if(v)R="tweet";else{var C;const e=null==f||null===(C=f.media)||void 0===C?void 0:C.mediaFile,i=null!=e&&e.isVideo?"video":null!=e&&e.isGif?"gif":"photo",a=t?"text":"unknown";R=e?i:a}if(o&&g({...b,element:R,action:"send_dm"},{conversation_id:o,conversation_participant_count:E,conversation_type:S?Qe.g.GROUP:Qe.g.ONE_TO_ONE}),this.setState({isSending:!0}),!o){return _({senderId:m,recipients:u&&u.map((({data:e})=>e.id_str)),text:t,tweetAttachment:v}).then((e=>{g({...b,element:R,action:"send_dm"},{conversation_id:e,conversation_participant_count:u?u.length+1:0,conversation_type:Qe.g.GROUP}),this.setState({attachment:null,isSending:!1}),p.replace(`/messages/${e}`)}),c(Nr.b)),Promise.resolve()}return!this.state.attachment||null!==(i=this.state.attachment)&&void 0!==i&&null!==(a=i.media)&&void 0!==a&&a.uploading||(this.setState({attachment:null}),p.replace(h.pathname)),_({senderId:m,cardUrl:n,conversationId:o,text:t,tweetAttachment:v,...e&&e.quickReply&&{quickReply:e.quickReply}}).then((()=>{!e.quickReply&&y&&(this._currentComposer&&this._currentComposer.clear(),this._currentComposer&&this._currentComposer.focus()),this.setState({isSending:!1})})).catch((e=>{if(this.setState({isSending:!1}),!Object(uo.d)(e)||e.code!==Br.b.CANCELED)if(Object(uo.d)(e)){const t=Object(uo.b)(e,_o);t&&s(t)}else c(Nr.b)(e)}))})),s()(this,"_handlePopOutConvo",(()=>{const{conversationId:e,popOutConversation:t}=this.props;t(e)})),s()(this,"_handleInfoClick",(()=>{const{conversationId:e,history:t}=this.props;e&&t.push(`/messages/${e}/info`)})),s()(this,"_handleComposeClick",(()=>{this._currentComposer&&this._currentComposer.focus()})),s()(this,"_handleSaveDraftText",(()=>{const{conversationId:e,saveText:t}=this.props;e&&this._currentComposer&&t(e,this._currentComposer.value())})),this.state={attachment:yo(e),composerHeight:z.a.theme.componentDimensions.appBarHeight,isSending:!1}}componentDidMount(){const{googleAnalyticsPageView:e,scribeNamespace:t,scribePageImpression:i,updateTweetDetailNav:a}=this.props;return i(t),a(t),e(t),this._initializePolling({interval:3e3}),this._initializeLivePipeline(),this._focusComposerIfNeeded(),this._initialFetch()}_focusComposerIfNeeded(){Hr()((()=>Object(Lr.a)().then((({KEYBOARD:e,MOUSE:t,detectedType:i})=>{const a=this.props.quickReplyOptions;(i(e)||i(t))&&!a&&this._currentComposer&&this._currentComposer.focus()}))))}_initializeLivePipeline(){const{conversationId:e}=this.props;Object(o.h)().then((({LivePipeline:t})=>{e&&t.isSupportedAndReady(this.context.featureSwitches)&&this.context.featureSwitches.isTrue("livepipeline_dm_features_enabled")&&!this._livePipelineSubscription&&(this._livePipelineSubscription=t.get().subscribeTopic(`/dm_update/${e}`,this._handleLivePipelineUpdate),this._initializePolling({interval:1e4}))}))}_initializePolling({interval:e}){this._updatePolling&&this._updatePolling.stop(),this._updatePolling=new zr.a(this._fetchUpdatesIfNeeded,{interval:e})}componentWillUnmount(){const{conversation:e,conversationId:t,removeConversation:i}=this.props,a=(null==e?void 0:e.entries)||[];this._updatePolling&&this._updatePolling.stop(),this._updatePolling=void 0,this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),0===a.length&&i(t),1===a.length&&"welcome_message_create"===a[0].type&&i(t)}componentDidUpdate(e,t){const{conversation:i,conversationId:a,fetchStatus:s,isUploading:n,quickReplyOptions:r,updateConversationReadState:o}=this.props;var c;a!==e.conversationId?(a&&this._fetchConversation(a),this._focusComposerIfNeeded(),this._livePipelineSubscription&&this._livePipelineSubscription.teardown(),this._initializeLivePipeline()):((null==i?void 0:i.sort_event_id)!==(null===(c=e.conversation)||void 0===c?void 0:c.sort_event_id)&&o(a),n||!e.isUploading||r||this._currentComposer&&this._currentComposer.focus(),e.fetchStatus===m.a.LOADED&&s!==m.a.LOADED&&a&&this._fetchConversation(a))}UNSAFE_componentWillReceiveProps(e){const{media:t}=this.props,{media:i}=e;Object(se.a)(t,i)||this.setState({attachment:yo(e)})}render(){const{fetchStatus:e}=this.props;return r.a.createElement(xr.a,{style:[So.root,ar.b.isKaiOS()&&So.kaiOSFix]},r.a.createElement(Dr.a,{fetchStatus:e,onRequestRetry:this._handleInitialFetch,render:this._render}))}_renderComposerBar(){const{addMedia:e,cardUrl:t,conversation:i,conversationId:a,dataSaverMode:s,draftText:n,dtabBarInfo:o,history:c,isUploading:l,mediaUploadProgress:d,quickReplyOptions:p,removeMedia:h,richTextInputContext:u,scribeNamespace:m,typeaheadWrapper:g}=this.props,{attachment:b,isSending:_}=this.state,v=this.props.prefillText||n;return null!=i&&i.read_only?null:r.a.createElement(Pr.a,{attachment:b,conversationId:a,disabled:l,dtabBarInfo:o,history:c,isCardPreviewTombstoned:Object(Fr.a)(t),isSending:_,isUploading:l,key:a,mediaUploadProgress:d,onAddMedia:e,onBlur:this._handleSaveDraftText,onHeightChange:this._handleNavHeightChange,onPrimaryAction:this._handleSendMessage,onTyping:s?this._throttleSaveDraftText:this._handleTyping,prefillText:"string"==typeof v?v:void 0,primaryActionIcon:mo,primaryActionLabel:bo,quickReplyOptions:p,ref:this._composer,removeMedia:h,richTextInputContext:u,scribeNamespace:m,typeaheadWrapper:g})}get _currentComposer(){return this._composer.current}_fetchConversation(e){const{createLocalApiErrorHandler:t,fetchConversationIfNeeded:i,updateConversationReadState:a}=this.props;return i({conversationId:e}).then((()=>a(e))).catch(t(Object(T.a)(e)))}_requestWelcomeMessage(e){const{addWelcomeMessageToConversation:t,conversation:i,createLocalApiErrorHandler:a,location:s}=this.props,{text:n}=s.query,r=Array.isArray(s.query.welcome_message_id)?s.query.welcome_message_id[0]:s.query.welcome_message_id,o=!!this.state.attachment||!(!n||r),c=!i||!i.type||i.type===l.CONVERSATION_TYPE.GROUP,d=i&&i.participants&&Object.keys(i.participants).length<=1;return o||c||d?Promise.resolve():t(e,r).catch(a({showToast:!1}))}}s()(Eo,"contextType",U.a),s()(Eo,"defaultProps",{isNewGroupConversation:!1,typeaheadWrapper:jr.a});const So=z.a.create((e=>({root:{flexGrow:1},activity:{flexBasis:e.spacesPx.space1,flexGrow:1,height:"100%"},kaiOSFix:{paddingBottom:e.spaces.space20},dragDrop:{flexGrow:1},scrollView:{flexGrow:1}})));t.a=Object(to.c)()(A(Eo))},RJrc:function(e,t,i){"use strict";var a=i("ERkP"),s=i.n(a),n=i("3XMw"),r=i.n(n),o=i("MWbm"),c=i("Qwev"),l=i("rHpw");const d=r.a.ffde2fdb,p=l.a.create((e=>({spinner:{alignItems:"center",marginVertical:"30px"}})));t.a=()=>s.a.createElement(o.a,{style:p.spinner},s.a.createElement(c.a,{accessibilityLabel:d}))},"V/6K":function(e,t,i){"use strict";var a=i("ERkP");const s=i.n(a).a.createContext({isDrawer:!1});t.a=s},"X/yg":function(e,t,i){"use strict";i.d(t,"n",(function(){return c})),i.d(t,"m",(function(){return l})),i.d(t,"l",(function(){return d})),i.d(t,"c",(function(){return p})),i.d(t,"h",(function(){return h})),i.d(t,"j",(function(){return u})),i.d(t,"k",(function(){return m})),i.d(t,"f",(function(){return g})),i.d(t,"i",(function(){return b})),i.d(t,"g",(function(){return _})),i.d(t,"e",(function(){return v})),i.d(t,"a",(function(){return f})),i.d(t,"b",(function(){return y})),i.d(t,"d",(function(){return E}));var a=i("CDB5"),s=i("Myq3"),n=i("XnpN"),r=i("AQ79"),o=i("pHkl");const c=(e,t)=>t.location&&t.location.state&&t.location.state.tweetAttachment,l=(e,t)=>t.location&&t.location.state&&t.location.state.participants,d=(e,t)=>t.location&&t.location.state&&t.location.state.isNewGroupConversation,p=e=>{const{message_data:t}=e;let i=o.d.UNKNOWN;const a=t&&t.attachment||{};return a.tweet?i=o.d.TWEET:a.photo?i=o.d.PHOTO:a.animated_gif?i=o.d.GIF:a.video?i=a.video.audio_only?o.d.VOICE:o.d.VIDEO:a.card?i=o.d.CARD:null!=t&&t.text&&(i=o.d.TEXT),i};function h(e){return e===r.d.SECONDARY?o.c.REQUESTS:e===r.d.TERTIARY?o.c.LOW_QUALITY:o.c.PRIMARY}function u(e){return e.isTrue("dm_voice_rendering_enabled")}function m(e,t){return!!(e&&e.video&&u(t))&&!!e.video.audio_only}function g(e,t,i,a){return{pathname:`/i/report/dm_conversation/${e}`,state:{clientReferer:t,inboxType:a,scribeNamespace:i}}}function b(e,t){if(!e)return{name:"",screenName:"",idStr:""};const i=Object(n.a)(e,t).map((({user:e})=>e)),a=i&&i[0];return{name:a&&a.name||"",screenName:a&&a.screen_name||"",idStr:a&&a.id_str||""}}const _=e=>e===r.d.TERTIARY?"low_quality_timeline":e===r.d.SECONDARY?"requests_timeline":"inbox_timeline",v=e=>e===r.d.TERTIARY?"/messages/requests/additional":e===r.d.SECONDARY?"/messages/requests":"/messages",f=e=>()=>a.b(e),y=e=>t=>a.c(e,t),E=(e,t)=>{const i=Object(s.a)(e,(e=>!!e.message_data&&(e.message_data&&e.message_data.recipient_id===t)));return i&&i.message_data&&i.message_data.quick_reply&&i.message_data.quick_reply&&"options"===i.message_data.quick_reply.type?i.message_data.quick_reply:void 0}},XnpN:function(e,t,i){"use strict";var a=i("aWyx"),s=i("t0aI");const n=(e=0)=>new Date(Number(e)),r=(e,t)=>n(e.join_time)-n(t.join_time),o=({user:e},{user:t})=>Object(s.a)(e.id_str,t.id_str);var c=i("tn7R"),l=i("VIKJ");t.a=(e,t)=>{const{created_by_user_id:i,participants:s,type:n}=e,d=Object(c.a)(s),[p,h]=Object(l.a)(d,(({user:e})=>e.id_str===t));return h.length?n===a.a.GROUP&&1===h.length?[...p,...h]:i?h.sort(((...e)=>(t,i)=>e.map((e=>e(t,i))).filter((e=>!!e))[0]||0)((e=>({user:t},{user:i})=>{switch(e){case t.id_str:return-1;case i.id_str:return 1;default:return 0}})(i),r,o)):h:p}},aA19:function(e,t,i){"use strict";var a=i("ERkP"),s=i.n(a),n=i("aWyx"),r=i("XnpN"),o=i("3XMw"),c=i.n(o),l=i("rHpw"),d=i("TIdA"),p=i("A91F"),h=i("jhWN"),u=i("9Xij"),m=i("Znyr"),g=i("cm6r"),b=i("U+bB"),_=i("MWbm");const v=c.a.fd48249b,f=l.a.create((e=>({circle:{borderRadius:e.borderRadii.infinite,overflow:"hidden"},container:{height:"auto",width:"100%"},itemAccessory:{top:-e.spacesPx.space24,right:-e.spacesPx.space24},userDecoration:{fontSize:e.fontSizes.subtext3,position:"absolute",backgroundColor:e.colors.gray100,marginLeft:e.spaces.space8,boxSizing:"border-box",width:e.spaces.space24,height:e.spaces.space24}}))),y=l.a.create((e=>({container:{flexDirection:"row"},left:{flex:1},right:{flex:1,marginLeft:e.borderWidths.small,marginRight:`calc(-1 * ${e.borderWidths.small})`}}))),E=l.a.create((e=>({container:{flexDirection:"column"},top:{flex:1,marginBottom:e.borderWidths.small},bottom:{flex:1}}))),S=({left:e,right:t})=>s.a.createElement(_.a,{style:y.container},s.a.createElement(_.a,{style:y.left},e),s.a.createElement(_.a,{style:y.right},t)),R=({bottom:e,top:t})=>s.a.createElement(_.a,{style:E.container},s.a.createElement(_.a,{style:E.top},t),s.a.createElement(_.a,{style:E.bottom},e));t.a=e=>{const t=t=>{const{size:i,withVDLRefresh:a}=e,n=a?"xxxLarge":"xxLarge";return s.a.createElement(_.a,{key:t.id_str,style:f.container},s.a.createElement(h.a,{size:i||n,uri:t.profile_image_url_https}))},i=e=>{const t=e.length,i=e.map(((e,i)=>{const a=2===t||3===t&&0===i?.5:1;return s.a.createElement(_.a,{key:e.id_str,style:f.container},s.a.createElement(h.a,{aspectRatio:a,shape:"none",size:"custom",uri:e.profile_image_url_https}))}));if(2===t)return s.a.createElement(u.a,{ratio:1},s.a.createElement(S,{left:i[1],right:i[0]}));{const e=s.a.createElement(R,{bottom:i[2],top:i[1]}),t=i[0];return s.a.createElement(S,{left:e,right:t})}},{conversation:a,link:o,perspective:c,withBadge:y}=e,E=a&&a.avatar_image_https,C=a?Object(r.a)(a,c).map((({user:e})=>e)):[],w=C.slice(0,3),x=(e=>{const t=e&&e.avatar&&e.avatar.image&&e.avatar.image.original_info;return t?s.a.createElement(d.a,{accessibilityLabel:"",aspectMode:p.a.SQUARE,backgroundColor:l.a.theme.colors.gray50,image:t,rounded:!0}):null})(a)||(e=>e?s.a.createElement(b.a,{source:e}):null)(E)||(e=>{const a=e.length;return 0===a?null:1===a?t(e[0]):s.a.createElement(_.a,{style:f.circle},i(e))})(w),A=o||((e,t)=>{if(e)return e.type===n.a.GROUP?`/messages/${e.conversation_id}/participants`:e.type===n.a.ONE_TO_ONE?`/${t[0].screen_name}`:void 0})(a,C),T=y&&null!=a&&a.participants?Object.keys(a.participants).length-1:0;return x?s.a.createElement(s.a.Fragment,null,s.a.createElement(u.a,{ratio:1},A?s.a.createElement(g.a,{interactiveStyles:null,link:A},x):x),T?(({badgeCount:e})=>s.a.createElement(_.a,{style:f.itemAccessory},s.a.createElement(m.a,{count:e,standalone:!0,style:f.userDecoration,textColor:"normal",truncatedCountFormatter:()=>"",unreadCountLabel:v,withTruncatedCount:!1})))({badgeCount:T}):null):null}},b9JY:function(e,t,i){"use strict";i.d(t,"b",(function(){return s})),i.d(t,"e",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"c",(function(){return o})),i.d(t,"a",(function(){return l}));var a=i("aWyx");const s=e=>e&&e.type===a.b.MESSAGE,n=e=>e&&e.type===a.b.WELCOME_MESSAGE,r=e=>e&&e.type===a.b.TRUST_CONVERSATION,o=e=>e&&e.type===a.b.REACTION_CREATE,c=[a.b.CONVERSATION_AVATAR_UPDATE,a.b.CONVERSATION_NAME_UPDATE,a.b.JOIN_CONVERSATION,a.b.PARTICIPANTS_JOIN,a.b.PARTICIPANTS_LEAVE],l=e=>e&&c.indexOf(e.type)>-1},cFyg:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var a=i("ZUOq"),s=i("rHpw");const n={durationMs:300},r=s.a.create((e=>({root:{alignSelf:"flex-end",backgroundColor:e.colors.navigationBackground,borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge,boxShadow:e.boxShadows.medium,marginRight:e.spaces.space20,minWidth:a.a.dmDrawerWidth.min,maxWidth:a.a.dmDrawerWidth.max},expandable:{transition:`all ${n.durationMs}ms ease`},expanded:{maxHeight:a.a.dmDrawerHeight.expanded,height:"80vh"},drawerHeaderRadius:{borderTopLeftRadius:e.borderRadii.xLarge,borderTopRightRadius:e.borderRadii.xLarge}})));t.b=r},dPJJ:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return l}));var a=i("6/RC");const s=new Set,n=new Set;let r=!1;function o(){if(a.canUseDOM&&!r){const e=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"];["webkitfullscreenchange","mozfullscreenchange","fullscreenchange","msfullscreenchange"].forEach((t=>{document.addEventListener(t,(()=>{const t=e.map((e=>document[e])).filter(Boolean)[0];t?s.forEach((e=>e(t))):n.forEach((e=>e()))}))}))}r=!0}const c=e=>(r||o(),s.add(e),()=>s.delete(e)),l=e=>(r||o(),n.add(e),()=>n.delete(e))},"ejT/":function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return s}));const a=e=>({id:e,distanceToViewportTop:0}),s=e=>({id:e,distanceToViewportBottom:0})},g54k:function(e,t,i){"use strict";i.d(t,"b",(function(){return c}));var a=i("hqKg"),s=i("s1N3");var n=e=>{const{sender_id:t,by_user_id:i,participants:a=[]}=e;return Object(s.a)(a.map((({user_id:e})=>e)).concat([t,i]).filter(Boolean))},r=i("G6rE"),o=i("oEGd");const c=(e,t)=>({users:n(t).reduce(((t,i)=>(t[i]=e[i],t)),{})}),l=Object(a.createSelector)(r.e.selectAll,((e,t)=>t.entry),c);t.a=Object(o.c)(l)},gbD7:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"c",(function(){return c}));i("ERkP");var a=i("aWyx");const s=(e,t)=>({entry:{id:t,time:"",type:e},isActive:!1,isRapidFire:!1,isFirstRapidFire:!1,isLastRapidFire:!1,type:e}),n=s(a.b.CONVERSATION_PROFILE_INFO_HEADER,"conversationProfileInfoHeader"),r="typingIndicator",o=s(a.b.TYPING_INDICATOR,r),c=s(a.b.READ_ONLY_INDICATOR,"readOnlyIndicator")},jHwr:function(e,t,i){"use strict";t.a=(e,t)=>{let i=null;const a=()=>{i=null,e()};return()=>(i||(i=t(a)),i)}},kgfz:function(e,t){function i(e){var t=[];for(var i in e)t.push(i);return t}(e.exports="function"==typeof Object.keys?Object.keys:i).shim=i},p9G8:function(e,t,i){"use strict";i.d(t,"b",(function(){return p}));var a=i("Xrkv"),s=i("aWyx"),n=i("XnpN"),r=i("3XMw"),o=i.n(r);const c=o.a.b5b7fb93,l=o.a.g755fcde,d=o.a.f6b1ff81;t.a=(e,t,i)=>{const{type:a,name:r,participants:o={}}=e;if(a===s.a.GROUP&&r)return r;if(!Object.keys(o).length)return;if(a===s.a.GROUP&&i)return c;const l=Object(n.a)(e,t).map((({user:e})=>e));return p(l,t,a)};const p=(e=[],t,i=s.a.GROUP)=>{const n=e.filter((e=>e.id_str!==t)).map((e=>e.name));switch(n.length){case 0:return l;case 1:{const[e]=n;return i===s.a.GROUP?d({name:e}):e}default:{const e=!0;return Object(a.a)(n,e)}}}},prG5:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var a=i("97Jx"),s=i.n(a),n=i("KEM+"),r=i.n(n),o=i("ERkP"),c=i.n(o),l=i("nT9l"),d=i("3XMw"),p=i.n(d),h="image",u=i("TIdA"),m=i("a6qo");const g=p.a.f93bb3ee;class b extends c.a.Component{constructor(...e){super(...e),r()(this,"_renderContent",(({resourceSelectionHandler:e,useMinimumData:t})=>{const{accessibilityLabel:i,hideAcceptOverlay:a,shouldShowAltLabel:n,...r}=this.props;return c.a.createElement(c.a.Fragment,null,c.a.createElement(u.a,s()({},r,{accessibilityLabel:i,onVariantSelection:e,previewMode:t,testID:h})),n?c.a.createElement(m.a,{align:"left",altLabel:i}):null)}))}render(){const{hideAcceptOverlay:e,image:t}=this.props;return c.a.createElement(l.a,{acceptLabel:g,hideAcceptOverlay:e,renderContent:this._renderContent,resourceId:"string"==typeof t?t:t.url})}}},tZH3:function(e,t,i){"use strict";var a=i("ERkP"),s=i.n(a),n=i("3XMw"),r=i.n(n),o=i("MWbm"),c=i("CKsB"),l=i("/yvb"),d=i("rHpw"),p=i("hiGS"),h=i("pu5c"),u=i("zIWA");const m=r.a.fcd4d489,g=r.a.gbed8594,b=r.a.g9074da4,_=r.a.ad63377d,v=r.a.h09b49f7,f=r.a.i6b19b07,y=r.a.j7bb1a42,E=r.a.ea200ba6,S=r.a.cfd2f35d,R=({dismiss:e,flatBorders:t,isGroup:i,onBlockClick:a,onDeleteClick:n,onReportClick:r,requestorScreenName:d,showBlock:R,showCancel:w,showDelete:x})=>{const A=s.a.useCallback((()=>{r&&r(),e()}),[e,r]),T=s.a.useCallback((()=>{a&&a(),e()}),[e,a]),I=s.a.useCallback((()=>{n&&n(),e()}),[e,n]);return s.a.createElement(o.a,{accessibilityRole:"dialog",style:t?C.flatCorners:C.roundCorners},x?s.a.createElement(c.a,{Icon:p.a,actionSubText:v,actionText:i?b:_,onClick:I,textColor:"red500"}):null,R?s.a.createElement(c.a,{Icon:h.a,actionSubText:g,actionText:m({screenName:d}),onClick:T}):null,s.a.createElement(c.a,{Icon:u.a,actionSubText:E,actionText:i?f:y({screenName:d}),onClick:A}),w?s.a.createElement(l.a,{onPress:e,style:C.cancelButton,type:"primaryOutlined"},S):null)};R.defaultProps={isGroup:!1,flatBorders:!1,showBlock:!1,showCancel:!1,showDelete:!1};const C=d.a.create((e=>({roundCorners:{borderRadius:e.borderRadii.xLarge},flatCorners:{borderRadius:e.borderRadii.none},cancelButton:{marginHorizontal:e.spaces.space16,marginVertical:e.spaces.space16}})));t.a=R},uB9N:function(e,t,i){"use strict";var a=i("97Jx"),s=i.n(a),n=i("KEM+"),r=i.n(n),o=i("ERkP"),c=i.n(o),l=i("1YZw"),d=i("zh9S"),p=i("P1r1"),h=i("AspN"),u=i("rxPX"),m=Object(u.a)().propsFromState((()=>({dataSaverMode:p.k}))).propsFromActions((()=>({addMedia:h.b,addToast:l.b,processMultipleMedia:h.g,removeMediaUpload:h.i,scribeAction:d.c,preUploadMedia:h.e}))),g=i("wpu3"),b=i("cOB2"),_=i("MWbm"),v=i("0FVZ"),f=i("Oe3h"),y=i("rHpw");var E=function(e){const{accessibilityLabel:t,accessibilityRole:i,children:a,onLayout:n,sideNavPresent:r,style:o}=e,l=c.a.useContext(b.a);return r?c.a.createElement(c.a.Fragment,null,c.a.createElement(_.a,{accessibilityLabel:t,accessibilityRole:i,onLayout:n,style:o},a)):c.a.createElement(v.a.BottomComposer,null,c.a.createElement(f.a,{id:"DMComposerWrapper"},((e,r)=>c.a.createElement(_.a,s()({ref:e()},r({accessibilityLabel:t,accessibilityRole:i,onLayout:n,style:o})),a,c.a.createElement(_.a,{style:!1===l.keyboardVisible&&S.offsetBottom})))))};const S=y.a.create((()=>({offsetBottom:{paddingBottom:y.a.iPhoneOffsetBottom}})));var R=i("HPNB"),C=i("htQn"),w=i("t62R");class x extends c.a.Component{constructor(...e){super(...e),r()(this,"_handleClick",(()=>{const{id:e,label:t,onClick:i}=this.props;i({id:e,label:t})}))}render(){const{description:e,isWide:t,label:i}=this.props;return c.a.createElement(C.a,{accessibilityRole:"button",onClick:this._handleClick,style:[A.root,t&&A.isWide,!t&&A.isNarrow]},c.a.createElement(w.b,{weight:"bold"},i),c.a.createElement(w.b,{color:"gray700",size:"subtext2"},e))}}const A=y.a.create((e=>({root:{backgroundColor:e.colors.cellBackground,borderColor:e.colors.borderColor,borderStyle:"solid",paddingLeft:"1rem",paddingVertical:"1rem"},isWide:{borderRadius:e.borderRadii.xLarge,paddingVertical:"0.5rem",borderWidth:e.borderWidths.small},isNarrow:{borderTopWidth:e.borderWidths.small}})));var T=x,I=i("cHvH"),O=i("mw9i");class M extends c.a.Component{constructor(...e){super(...e),r()(this,"_handleOptionChoose",(e=>{const{onOptionChoose:t,quickReplyOptions:{id:i}}=this.props;return t(i,e)}))}render(){const{quickReplyOptions:{options:e}}=this.props,t=1===e.length;return c.a.createElement(I.a,null,(({windowWidth:i})=>{const a=R.a.isTwoColumnLayout(i),s=[a&&k.isWide,a&&t&&k.oneButtonOnly,!a&&k.isNarrow];return c.a.createElement(O.a,{style:s,withGutter:a},e.map((e=>this.renderOption(e,a))))}))}renderOption(e,t){return c.a.createElement(T,{description:e.description,id:e.id,isWide:t,key:e.id,label:e.label,onClick:this._handleOptionChoose})}}const k=y.a.create((e=>({oneButtonOnly:{gridTemplateColumns:"1fr"},isWide:{backgroundColor:e.colors.gray0,display:"grid",gridColumnGap:e.spaces.space12,gridRowGap:e.spaces.space12,gridTemplateColumns:"1fr 1fr",paddingVertical:e.spaces.space12},isNarrow:{maxHeight:"168px",overflow:"auto"}})));var P=M,D=i("krmn"),L=i("cIoY"),F=i("w3n3"),B=i("MLl7"),j=i("3XMw"),N=i.n(j),U=i("J2UM"),H=i("VPdC"),W=i("pKoL"),V=i("eyty"),z=i("oQhu"),q=i("JYMr");const G=[{waitMs:1e3,progress:.1},{waitMs:1400,progress:.3},{waitMs:1800,progress:.5},{waitMs:2400,progress:.6},{waitMs:3e3,progress:.9}];class K extends c.a.Component{constructor(...e){super(...e),r()(this,"state",{currentStepIndex:-1})}componentDidMount(){this._scheduleNextStep(0)}componentWillUnmount(){this._currentTimeoutId&&clearTimeout(this._currentTimeoutId)}render(){const{currentStepIndex:e}=this.state,t=e>=0&&e<G.length?G[e].progress:0;return c.a.createElement(q.a,{progress:t})}_scheduleNextStep(e){e<G.length&&(this._currentTimeoutId=setTimeout((()=>{this._currentTimeoutId=void 0,this.setState({currentStepIndex:e}),this._scheduleNextStep(e+1)}),G[e].waitMs))}}class Q extends c.a.PureComponent{render(){const{isSending:e,isUploading:t,progress:i}=this.props;return e&&!t?c.a.createElement(K,null):c.a.createElement(q.a,{progress:e?Math.max(i,.02):0})}}var $=Q,Y=i("Dtul"),J=i("Es6L"),X="dmComposerAttachments",Z="dmComposerTextInput",ee="dmComposerSendButton",te=i("GZwR"),ie=i("aITJ"),ae=i("6OUF"),se=i("9Xij"),ne=i("/yvb"),re=i("v6aA"),oe=i("gpVt"),ce=i("Lsrn"),le=i("k/Ka");const de=(e={})=>Object(le.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[ce.a.root,e.style],viewBox:"0 0 24 24"},c.a.createElement("g",null,c.a.createElement("path",{d:"M19 13.5H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0 6H5c-.828 0-1.5-.672-1.5-1.5s.672-1.5 1.5-1.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5zm0-12H5c-.828 0-1.5-.672-1.5-1.5S4.172 4.5 5 4.5h14c.828 0 1.5.672 1.5 1.5s-.672 1.5-1.5 1.5z"})));de.metadata={width:24,height:24};var pe=de;const he=(e={})=>Object(le.a)("svg",{...e,accessibilityHidden:void 0===e.accessibilityLabel,style:[ce.a.root,e.style],viewBox:"0 0 24 24"},c.a.createElement("g",null,c.a.createElement("path",{d:"M19 13H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0 6H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1zm0-12H5c-.553 0-1-.447-1-1s.447-1 1-1h14c.553 0 1 .447 1 1s-.447 1-1 1z"})));he.metadata={width:24,height:24};var ue=he,me=i("iySH");const ge=N.a.ee230734,be=N.a.ca0ce0e4,_e=N.a.cdcebd22,ve=N.a.ic8c615d,fe=N.a.a04077c4,ye=e=>!(!e||!e.media),Ee=Object(g.b)({maxNumberOfPhotos:1});class Se extends c.a.Component{constructor(e,t){var i,a;super(e,t),r()(this,"_handleLayout",(e=>{const{onHeightChange:t}=this.props,{mediaButtonsCollapsible:i}=this.state,a=e.nativeEvent.layout;a&&(Object(J.a)()||t&&t(a.height),a.width<=y.a.theme.breakpoints.small&&!i?this.setState({mediaButtonsCollapsible:!0}):a.width>y.a.theme.breakpoints.small&&i&&this.setState({mediaButtonsCollapsible:!1}))})),r()(this,"_renderQuickReplyPicker",(()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t}=this.state;return e&&t?c.a.createElement(P,{onOptionChoose:this._handleQROptionSelection,quickReplyOptions:e}):null})),r()(this,"_renderComposeBox",(()=>c.a.createElement(_.a,{style:Re.composeBoxContainer},this._renderMainContent()))),r()(this,"_renderMainContent",(()=>{const{richTextInputContext:e,typeaheadWrapper:t}=this.props,{value:i}=this.state,a=t;return a?c.a.createElement(a,{contextText:i,isInline:!0,onTextUpdated:e?this._handleRichTextChange:this._handlePlainTextChange,onTypeaheadStateChange:this._handleTypeaheadStateChange,source:te.d.ComposeMessage},this._renderFieldTextInput):this._renderFieldTextInput()})),r()(this,"_renderFieldTextInput",(e=>{const{disabled:t,placeholderText:i,richTextInputContext:a}=this.props,n=ie.b.isKaiOS()?_e:i||be,{editorState:r,mediaButtonsCollapsible:o,value:l}=this.state,d=!!a,p=a?{editorState:r,element:a.element}:void 0,h=a?{onChange:this._getHandleRichTextChange(e),richTextInputContext:{editorState:r,element:a.element}}:{onChange:this._getHandlePlainTextChange(e),richTextInputContext:void 0};return c.a.createElement(ae.a,s()({contentAbove:this._renderAttachments(),editable:!t,emojiPickerButton:this._renderEmojiPicker(),handleReturn:d?this._handleReturn:void 0,isCompact:!0,leftAligned:!0,maxNumberOfLines:d?8:4,multiline:!0,numberOfLines:1,onBlur:this._handleOnBlur,onFilesAdded:this._handleAddMediaFiles,onFocus:this._handleTextInputFocus,onKeyPress:d?void 0:this._handleReturn,placeholder:n,ref:this._setTextInputRef,richTextInputContext:t?void 0:p,style:Re.composeInput,testID:Z,useCacheForDOMMeasurements:!this._isSendDisabled()&&!o,value:l},h))})),r()(this,"_getHandleRichTextChange",Object(z.a)((e=>t=>{null==e||e(t),this._handleRichTextChange(t)}))),r()(this,"_getHandlePlainTextChange",Object(z.a)((e=>t=>{null==e||e(t),this._handlePlainTextChange(t)}))),r()(this,"_handleTypeaheadStateChange",(e=>{this.setState({isTypeaheadActive:e})})),r()(this,"_renderAttachments",(()=>{const{attachment:e,conversationId:t,isCardPreviewTombstoned:i,isShareViaDM:a,isUploading:s}=this.props,{value:n}=this.state,{height:r,width:o}=e&&(e.media&&e.media.mediaFile||e.provider&&e.media&&e.media.externalMediaDetails)||{},l=null==e?void 0:e.media,d=null==l?void 0:l.mediaMetadata,p=null==d?void 0:d.altText,h=null==d?void 0:d.defaultAltText,u=Object(oe.b)(n);return c.a.createElement(c.a.Fragment,null,l?c.a.createElement(_.a,{style:Re.attachmentContainer,testID:X},c.a.createElement(se.a,{ratio:o/r,style:Re.aspectContainer},c.a.createElement(_.a,{style:Re.mediaPreviewContainer},c.a.createElement(W.a,{accessibilityLabel:p||h,mediaItem:l,onClick:this._canEditImage?this._handleClickMediaDetail:void 0,onEdit:this._canEditImage||this._canEditVideo?this._handleClickMediaDetail:void 0,onRemove:this._handleRemoveMedia(l.id),resizeIfNeeded:"width",style:Re.mediaPreview,withAltTextLabel:!!p,withCloseButton:!s,withEditButton:(this._canEditImage||this._canEditVideo)&&!s,withEditIcon:!0}))),e&&e.provider&&e.gifUrl&&c.a.createElement(_.a,{style:Re.gifAttribution},c.a.createElement(L.a,{gifUrl:e.gifUrl,provider:e.provider}))):u&&!a?c.a.createElement(oe.a,{conversationId:t,isCardPreviewTombstoned:i,style:Re.cardPreviewContainer,urls:u}):null)})),r()(this,"_renderEmojiPicker",(()=>{const{withEmojiPicker:e}=this.props;return e&&ie.b.isDesktopOS()?c.a.createElement(D.a,{disabled:this.props.disabled,onEmojiSelect:this._handleEmojiSelect,onPress:this._handleTextInputFocus,size:"small",textInputRef:this._textInput||void 0}):null})),r()(this,"_renderPrimaryActionButton",(e=>{const{primaryActionIcon:t,primaryActionLabel:i,quickReplyOptions:a}=this.props,s=this._hasMessageText();return!a||s||e?c.a.createElement(ne.a,{accessibilityLabel:i,disabled:this._isSendDisabled(),hoverLabel:{label:i},icon:t||void 0,onPress:this._handlePrimaryAction,size:"medium",style:Re.actionButton,testID:ee,type:t?"brandText":"brandFilled"},t?null:i):this._renderQRToggleButton()})),r()(this,"_renderSecondaryActionButton",(()=>{const{secondaryActionLabel:e,shouldEnableSecondaryActionFunc:t,shouldShowSecondaryActionFunc:i}=this.props;if(i&&!i()||!e)return null;const a=!t||t();return c.a.createElement(ne.a,{accessibilityLabel:e,disabled:!a,onPress:this._handleSecondaryAction,style:Re.actionButton,type:"primaryOutlined"},this.props.secondaryActionLabel)})),r()(this,"_renderQRToggleButton",(()=>{const{isQuickReplyOpen:e}=this.state;return c.a.createElement(ne.a,{accessibilityLabel:ve,icon:e?c.a.createElement(pe,null):c.a.createElement(ue,null),onPress:this._handleQuickReplyPickerToggle,size:"medium",style:Re.actionButton,type:"brandText"})})),r()(this,"_renderComposer",(()=>{const{attachment:e}=this.props,t=ye(e),i=this._renderComposeBox(),a=this._renderPrimaryActionButton(t),s=this._renderSecondaryActionButton();return c.a.createElement(_.a,{style:[Re.composer,t&&Re.composerWithAttachment]},t?null:this._renderMediaButtons(),i,s,a)})),r()(this,"_renderMediaButtons",(()=>{const{withGifPicker:e,withMediaPicker:t}=this.props,{mediaButtonsCollapsed:i,mediaButtonsCollapsible:a}=this.state,s=a&&i;return c.a.createElement(_.a,{style:Re.uploadButtons},s?c.a.createElement(ne.a,{accessibilityLabel:ge,icon:c.a.createElement(me.a,null),onMouseDown:this._handleShowMediaControlsMouseDown,type:"brandText"}):null,t&&!s?this._renderMediaPicker():null,e&&!s?this._renderGifButton():null)})),r()(this,"_handleShowMediaControlsMouseDown",(()=>{const{scribeAction:e,scribeNamespace:t}=this.props;this.setState({mediaButtonsCollapsed:!1}),e({...t,component:"dm_composer",element:"toggle",action:"expand"})})),r()(this,"_handleReturn",(e=>{const{nativeEvent:{ctrlKey:t,key:i,metaKey:a,shiftKey:s}}=e,n="Enter"===i,{isTypeaheadActive:r}=this.state;return!r&&n&&this._keyboardOrMouseDetected&&!(s||a||t)?(e.preventDefault(),this._handlePrimaryAction(e),"handled"):"not-handled"})),r()(this,"_handleClickMediaDetail",(()=>{const{attachment:e,conversationId:t,history:i}=this.props;if(this._canEditImage||this._canEditVideo){const a=e&&e.media?e.media.id:0,s=this._canEditVideo?"trimmer":"crop";i.push("/messages/compose/media",{mediaId:a,conversationId:t,tab:s})}})),r()(this,"_handleAddMediaFiles",(e=>{const{addMedia:t,addToast:i,dataSaverMode:a,onAddMedia:s,preUploadMedia:n,processMultipleMedia:r,removeMedia:o,removeMediaUpload:c}=this.props;t(e,{location:V.d.Dm}).then((e=>{const t=e.map((e=>e.id));this._validateMedia(e)?(s&&s(t),r(e,{onFailure:o}).then((e=>{a||n(e.map((e=>e.id)))}))):(i({text:fe}),c(t))}))})),r()(this,"_handleEmojiSelect",(e=>{const{editorState:t}=this.state,{richTextInputContext:i}=this.props;if(!i||!t)return;const a=i.insertTextAtCursor(t,e.text);this._handleRichTextChange(a)})),r()(this,"_handleRemoveMedia",(e=>()=>{this.props.removeMedia&&this.props.removeMedia(e)})),r()(this,"_handlePrimaryAction",(e=>{if(!this._isSendDisabled()){const{onPrimaryAction:e}=this.props;this._textInput&&this._textInput.applyFinalValue((t=>{e({type:"richText"},t)})),this._closeQuickReplyPicker()}})),r()(this,"_handleSecondaryAction",(e=>{const{onSecondaryAction:t}=this.props;this._textInput&&this._textInput.applyFinalValue((e=>{t&&t({type:"richText"},e)}))})),r()(this,"_handleRichTextChange",(e=>{const{onTyping:t,richTextInputContext:i}=this.props,{value:a}=this.state,s=e.getCurrentContent().getPlainText(),n=i?i.convertEmojiToEntities(e):null;this.setState({editorState:n,value:s}),a!==s&&(null==t||t())})),r()(this,"_handlePlainTextChange",(e=>{const{onTyping:t}=this.props,{value:i}=this.state,a=e.target.value;this.setState({value:a}),i!==a&&(null==t||t())})),r()(this,"_handleOnBlur",(()=>{const{onBlur:e}=this.props,{mediaButtonsCollapsible:t}=this.state;e&&e(),t&&this.setState({mediaButtonsCollapsed:!1})})),r()(this,"_handleTextInputFocus",(()=>{const{quickReplyOptions:e}=this.props,{isQuickReplyOpen:t,mediaButtonsCollapsible:i}=this.state;e&&t&&this._closeQuickReplyPicker(),i&&this.setState({mediaButtonsCollapsed:!0})})),r()(this,"_handleQROptionSelection",((e,t)=>{const{disabled:i,onPrimaryAction:a}=this.props;i||(a({quickReply:{id:e,selected_id:t.id}},t.label),this._closeQuickReplyPicker())})),r()(this,"_handleQuickReplyPickerToggle",(()=>{this.setState({isQuickReplyOpen:!this.state.isQuickReplyOpen})})),r()(this,"_validateMedia",(e=>!ye(this.props.attachment)&&Ee(e))),r()(this,"_detectKeyboardOrMouse",(e=>{const{KEYBOARD:t,MOUSE:i,registerSome:a}=e;a((()=>{this._keyboardOrMouseDetected=!0}),[t,i])})),r()(this,"_isSendDisabled",(()=>{const{attachment:e,canSendEmptyMessage:t,disabled:i,isUploading:a}=this.props,s=ye(e),n=this._hasMessageText()||t,r=!(!e||!e.media)&&(e.media.needsProcessing||a);return i||!n&&!s||r||a})),r()(this,"_hasMessageText",(()=>!!(this.state.value||"").trim())),r()(this,"_closeQuickReplyPicker",(()=>{this.setState({isQuickReplyOpen:!1})})),r()(this,"handleAddMediaFiles",(e=>this._handleAddMediaFiles(e))),r()(this,"_setTextInputRef",(e=>{this._textInput=e}));const{prefillText:n,richTextInputContext:o}=e;this.state={isQuickReplyOpen:!0,value:n,editorState:null!==(i=null==o||null===(a=o.initEditorState)||void 0===a?void 0:a.call(o,n))&&void 0!==i?i:null,isTypeaheadActive:!1,mediaButtonsCollapsed:!1,mediaButtonsCollapsible:!1}}componentDidMount(){Object(U.a)().then(this._detectKeyboardOrMouse),this._unlockReload=Y.a.acquire()}componentWillUnmount(){this._unlockReload()}componentDidUpdate(){this.props.quickReplyOptions&&this.state.isQuickReplyOpen&&this._textInput&&this._textInput.blur()}UNSAFE_componentWillReceiveProps(e){const t=this.props.quickReplyOptions,i=e.quickReplyOptions;t&&!i?this.setState({isQuickReplyOpen:!1}):(!t&&i||t&&i&&t.id!==i.id)&&this.setState({isQuickReplyOpen:!0}),this.props.conversationId!==e.conversationId&&this.clear()}render(){const{dtabBarInfo:e,isSending:t,isUploading:i,mediaUploadProgress:a,placeholderText:s,style:n}=this.props,r=s||be,o=Object(J.a)(),l=o&&e&&(e.dtabAll||e.ttsToken)&&!e.hide;return c.a.createElement(E,{accessibilityLabel:r,accessibilityRole:"complementary",onLayout:this._handleLayout,sideNavPresent:o,style:[Re.root,l&&Re.dtabOffset,n]},c.a.createElement($,{isSending:t,isUploading:i,progress:t?Math.max(a,.02):0}),this._renderComposer(),this._renderQuickReplyPicker())}_renderMediaPicker(){return c.a.createElement(H.a,{onChange:this._handleAddMediaFiles,style:Re.mediaPicker,type:"brandText"})}_renderGifButton(){const{conversationId:e,history:t}=this.props;return c.a.createElement(F.a,{dmConversationId:e,enabled:!0,gifSearchKeySource:B.a.DMComposition,history:t})}get _canEditImage(){var e,t,i;return!(null===(e=this.props.attachment)||void 0===e||null===(t=e.media)||void 0===t||null===(i=t.mediaFile)||void 0===i||!i.isImage)}get _canEditVideo(){var e,t;const{attachment:i}=this.props;let a=null==i||null===(e=i.media)||void 0===e||null===(t=e.mediaFile)||void 0===t?void 0:t.isVideo;return a&&(this._videoTrimmerEnabled=this.context.featureSwitches.isTrue("responsive_web_video_trimmer_enabled"),a=this._videoTrimmerEnabled),!!a}clear(){const{richTextInputContext:e}=this.props;if(e){const{initEditorState:t}=e||{};this.setState({value:"",editorState:t&&t("")})}else this.setState({value:""})}focus(){this._textInput&&this._textInput.focus()}value(){return this.state.value}}r()(Se,"contextType",re.a),r()(Se,"defaultProps",{prefillText:"",withEmojiPicker:!0,withGifPicker:!0,withMediaPicker:!0});const Re=y.a.create((e=>({root:{backgroundColor:e.colors.navigationBackground,borderTopColor:e.colors.borderColor,borderTopWidth:e.borderWidths.small},attachmentContainer:{maxHeight:"10rem",margin:e.spaces.space12},aspectContainer:{flexShrink:1},cardPreviewContainer:{margin:e.spaces.space12},dtabOffset:{marginBottom:e.spaces.space40},gifAttribution:{flexDirection:"row",marginVertical:e.spaces.space4,marginHorizontal:0},mediaPicker:{margin:0},icon:{color:e.colors.primary,fontSize:"1.5em"},composeBoxContainer:{flexGrow:1,flexShrink:1,alignSelf:"center"},composeInput:{width:"100%"},mediaPreviewContainer:{flexDirection:"row",height:"100%"},mediaPreview:{borderRadius:e.borderRadii.xLarge,overflow:"hidden",minWidth:"10em"},composer:{alignItems:"center",flexDirection:"row",padding:e.spaces.space4,width:"100%"},composerWithAttachment:{paddingLeft:e.spaces.space12},actionButton:{marginLeft:e.spaces.space4},uploadButtons:{flexDirection:"row",marginRight:e.spaces.space4}})));t.a=m.forwardRef(Se)},zQEV:function(e,t,i){"use strict";i.d(t,"b",(function(){return u})),i.d(t,"a",(function(){return g}));var a=i("ERkP"),s=i.n(a),n=i("t62R"),r=i("aWyx"),o=i("3XMw"),c=i.n(o);const l=c.a.c1d4ac83,d=c.a.abc7b032,p=c.a.i263b293,h=({children:e,conversationId:t})=>s.a.createElement(n.b,{link:`/messages/${t}/participants`},e),u=(e,t)=>e>=2?s.a.createElement(c.a.I18NFormatMessage,{$i18n:"e3534476"},s.a.createElement(h,{conversationId:t},c.a.d1242bcc({count:e}))):s.a.createElement(c.a.I18NFormatMessage,{$i18n:"b6656850",count:e}),m=({entry:e,users:t})=>e.participants?s.a.createElement("span",null,e.participants.map((({user_id:e},i)=>{const a=t[e];return a?s.a.createElement("span",{key:i},i>0?", ":null,s.a.createElement(n.b,null,a.name)):null}))):null,g=(e,t,i,a)=>{const o=i===e.by_user_id;let h;switch(t){case r.b.CONVERSATION_AVATAR_UPDATE:return h=e.by_user_id&&a[e.by_user_id]&&a[e.by_user_id].name,h?o?l:(e=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"bff29c94"},s.a.createElement(n.b,null,e)))(h):d;case r.b.CONVERSATION_NAME_UPDATE:{const t=s.a.createElement(n.b,null,e.conversation_name);return h=e.by_user_id&&a[e.by_user_id]&&a[e.by_user_id].name,h?o?(e=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"b16e4d45"},e))(t):((e,t)=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"c5760698"},s.a.createElement(n.b,null,e),t))(h,t):(e=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"a72730a0"},e))(t)}case r.b.JOIN_CONVERSATION:return h=e.sender_id&&a[e.sender_id]&&a[e.sender_id].name,h?(e=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"fa95b019"},s.a.createElement(n.b,null,e)))(h):p;case r.b.PARTICIPANTS_LEAVE:return(e=>s.a.createElement(c.a.I18NFormatMessage,{$i18n:"fc10875e"},e))(s.a.createElement(m,{entry:e,users:a}));case r.b.PARTICIPANTS_JOIN:h=e.sender_id&&a[e.sender_id]&&a[e.sender_id].name;return((e,t)=>e?s.a.createElement(c.a.I18NFormatMessage,{$i18n:"a4bc88c2"},s.a.createElement(n.b,null,e),t):s.a.createElement(c.a.I18NFormatMessage,{$i18n:"bfdff0c3"},t))(h,s.a.createElement(m,{entry:e,users:a}));default:return""}}}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/shared~loader.DMDrawer~bundle.DirectMessages~bundle.DMRichTextCompose.c9e112f5.js.map